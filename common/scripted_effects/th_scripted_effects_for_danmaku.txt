th_set_default_danmaku_class = {
	set_global_flag = th_danmaku_class_default_$class$
}

th_set_default_danmaku_type = {
	set_global_flag = th_danmaku_creature_type_default_$type$
}

#health
#mana
#action_points
th_gui_update_danmaku_bar = {
	set_variable = { which = th_danmaku_$type$_var which = th_danmaku_$type$ }
	if = {
		limit = { check_variable = { which = th_danmaku_max_$type$ value = 0.001 } }
		divide_variable = {
			which = th_danmaku_$type$_var
			which = th_danmaku_max_$type$
		}
	}
	multiply_variable = { which = th_danmaku_$type$_var value = 100 }
}
th_gui_update_danmaku_bar_enemy_character = {
	set_variable = { which = th_danmaku_enemy_$type$_var which = th_enemy_character_current_$type$ }
	if = {
		limit = { check_variable = { which = th_enemy_character_max_$type$ value = 0.001 } }
		divide_variable = {
			which = th_danmaku_enemy_$type$_var
			which = th_enemy_character_max_$type$
		}
	}
	multiply_variable = { which = th_danmaku_enemy_$type$_var value = 100 }
}
th_gui_update_exp_bar = {
	set_variable = { which = th_danmaku_exp_var which = th_danmaku_current_exp }
	if = {
		limit = { check_variable = { which = th_danmaku_exp_threshold value = 0.001 } }
		divide_variable = {
			which = th_danmaku_exp_var
			which = th_danmaku_exp_threshold
		}
	}
	multiply_variable = { which = th_danmaku_exp_var value = 100 }
}

th_gui_change_item_page_previous = {
	subtract_variable = {
		which = th_gui_$items$_page
		value = 1
	}
}
th_gui_change_item_page_next = {
	change_variable = {
		which = th_gui_$items$_page
		value = 1
	}
}
th_gui_change_item_page = {
	th_gui_change_item_page_$page$ = { items = $items$ }
}

th_clear_previous_selections = {
	clr_country_flag = th_selected_weapon_iron_sword
	clr_country_flag = th_has_selcted_item_of_weapon
}
th_select_item = {
	th_clear_previous_selections = yes
	set_country_flag = th_selected_$type$_$item$
	set_country_flag = th_has_selcted_item_of_$type$
}

#gold
#power
th_update_gain_modifier = {
	set_variable = {
		which = th_danmaku_$type$_gain_show
		which = th_danmaku_$type$_gain
	}
	multiply_variable = {
		which = th_danmaku_$type$_gain_show
		value = 100
	}
}

th_set_default_danmaku_stats = {
	1 = {
		set_variable = { which = th_danmaku_default_max_health_transfer 					which = th_danmaku_default_max_health }
		set_variable = { which = th_danmaku_default_max_mana_transfer						which = th_danmaku_default_max_mana }
		set_variable = { which = th_danmaku_default_max_action_points_transfer				which = th_danmaku_default_max_action_points }
		set_variable = { which = th_danmaku_default_hpm_transfer							which = th_danmaku_default_hpm }
		set_variable = { which = th_danmaku_default_mpm_transfer							which = th_danmaku_default_mpm }
		set_variable = { which = th_danmaku_default_ini_bonus_transfer						which = th_danmaku_default_ini_bonus }
		set_variable = { which = th_danmaku_default_hit_bonus_transfer						which = th_danmaku_default_hit_bonus }
		set_variable = { which = th_danmaku_default_physical_attack_bonus_transfer			which = th_danmaku_default_physical_attack_bonus }
		set_variable = { which = th_danmaku_default_physical_attack_die_transfer			which = th_danmaku_default_physical_attack_die }
		set_variable = { which = th_danmaku_default_physical_attack_die_num_transfer		which = th_danmaku_default_physical_attack_die_num }
		set_variable = { which = th_danmaku_default_physical_crit_roll_needed_transfer		which = th_danmaku_default_physical_crit_roll_needed }
		set_variable = { which = th_danmaku_default_magical_attack_bonus_transfer			which = th_danmaku_default_magical_attack_bonus }
		set_variable = { which = th_danmaku_default_magical_attack_die_transfer				which = th_danmaku_default_magical_attack_die }
		set_variable = { which = th_danmaku_default_magical_attack_die_num_transfer			which = th_danmaku_default_magical_attack_die_num }
		set_variable = { which = th_danmaku_default_magical_crit_roll_needed_transfer		which = th_danmaku_default_magical_crit_roll_needed }
		set_variable = { which = th_danmaku_default_psionic_attack_bonus_transfer			which = th_danmaku_default_psionic_attack_bonus }
		set_variable = { which = th_danmaku_default_psionic_attack_die_transfer				which = th_danmaku_default_psionic_attack_die }
		set_variable = { which = th_danmaku_default_psionic_attack_die_num_transfer			which = th_danmaku_default_psionic_attack_die_num }
		set_variable = { which = th_danmaku_default_psionic_crit_roll_needed_transfer		which = th_danmaku_default_psionic_crit_roll_needed }
		set_variable = { which = th_danmaku_default_crit_roll_damage_multipler_transfer		which = th_danmaku_default_crit_damage_multiplier }

		set_variable = { which = th_danmaku_default_physical_damage_modifier_transfer		which = th_danmaku_default_physical_damage_modifier }
		set_variable = { which = th_danmaku_default_magical_damage_modifier_transfer		which = th_danmaku_default_magical_damage_modifier }
		set_variable = { which = th_danmaku_default_psionic_damage_modifier_transfer		which = th_danmaku_default_psionic_damage_modifier }
		set_variable = { which = th_danmaku_default_bludgeoning_damage_modifier_transfer	which = th_danmaku_default_bludgeoning_damage_modifier }
		set_variable = { which = th_danmaku_default_piercing_damage_modifier_transfer		which = th_danmaku_default_piercing_damage_modifier }
		set_variable = { which = th_danmaku_default_slashing_damage_modifier_transfer		which = th_danmaku_default_slashing_damage_modifier }
		set_variable = { which = th_danmaku_default_fire_damage_modifier_transfer			which = th_danmaku_default_fire_damage_modifier }
		set_variable = { which = th_danmaku_default_frost_damage_modifier_transfer			which = th_danmaku_default_frost_damage_modifier }
		set_variable = { which = th_danmaku_default_earth_damage_modifier_transfer			which = th_danmaku_default_earth_damage_modifier }
		set_variable = { which = th_danmaku_default_lightning_damage_modifier_transfer		which = th_danmaku_default_lightning_damage_modifier }
		set_variable = { which = th_danmaku_default_nature_damage_modifier_transfer			which = th_danmaku_default_nature_damage_modifier }
		set_variable = { which = th_danmaku_default_holy_damage_modifier_transfer			which = th_danmaku_default_holy_damage_modifier }
		set_variable = { which = th_danmaku_default_shadow_damage_modifier_transfer			which = th_danmaku_default_shadow_damage_modifier }
		set_variable = { which = th_danmaku_default_necrotic_damage_modifier_transfer		which = th_danmaku_default_necrotic_damage_modifier }
		set_variable = { which = th_danmaku_default_arcane_damage_modifier_transfer			which = th_danmaku_default_arcane_damage_modifier }
		set_variable = { which = th_danmaku_default_infernal_damage_modifier_transfer		which = th_danmaku_default_infernal_damage_modifier }

		set_variable = { which = th_danmaku_default_physical_resistance_transfer			which = th_danmaku_default_physical_resistance }
		set_variable = { which = th_danmaku_default_magical_resistance_transfer				which = th_danmaku_default_magical_resistance }
		set_variable = { which = th_danmaku_default_psionic_resistance_transfer				which = th_danmaku_default_psionic_resistance }
		set_variable = { which = th_danmaku_default_bludgeoning_resistance_transfer			which = th_danmaku_default_bludgeoning_resistance }
		set_variable = { which = th_danmaku_default_piercing_resistance_transfer			which = th_danmaku_default_piercing_resistance }
		set_variable = { which = th_danmaku_default_slashing_resistance_transfer			which = th_danmaku_default_slashing_resistance }
		set_variable = { which = th_danmaku_default_fire_resistance_transfer				which = th_danmaku_default_fire_resistance }
		set_variable = { which = th_danmaku_default_frost_resistance_transfer				which = th_danmaku_default_frost_resistance }
		set_variable = { which = th_danmaku_default_earth_resistance_transfer				which = th_danmaku_default_earth_resistance }
		set_variable = { which = th_danmaku_default_lightning_resistance_transfer			which = th_danmaku_default_lightning_resistance }
		set_variable = { which = th_danmaku_default_nature_resistance_transfer				which = th_danmaku_default_nature_resistance }
		set_variable = { which = th_danmaku_default_holy_resistance_transfer				which = th_danmaku_default_holy_resistance }
		set_variable = { which = th_danmaku_default_shadow_resistance_transfer				which = th_danmaku_default_shadow_resistance }
		set_variable = { which = th_danmaku_default_necrotic_resistance_transfer			which = th_danmaku_default_necrotic_resistance }
		set_variable = { which = th_danmaku_default_arcane_resistance_transfer				which = th_danmaku_default_arcane_resistance }
		set_variable = { which = th_danmaku_default_infernal_resistance_transfer			which = th_danmaku_default_infernal_resistance }

		set_variable = { which = th_danmaku_default_healing_die_transfer					which = th_danmaku_default_healing_die }
		set_variable = { which = th_danmaku_default_healing_die_num_transfer				which = th_danmaku_default_healing_die_num }
		set_variable = { which = th_danmaku_default_healing_crit_roll_needed_transfer		which = th_danmaku_default_healing_crit_roll_needed }
		set_variable = { which = th_danmaku_default_healing_received_bonus_transfer			which = th_danmaku_default_healing_received_bonus }
		set_variable = { which = th_danmaku_default_healing_received_modifier_transfer		which = th_danmaku_default_healing_received_modifier }

		set_variable = { which = th_danmaku_default_armor_class_transfer					which = th_danmaku_default_armor_class }
		set_variable = { which = th_danmaku_default_saving_throw_die_transfer				which = th_danmaku_default_saving_throw_die }
		set_variable = { which = th_danmaku_default_resistance_transfer						which = th_danmaku_default_resistance }

		set_variable = { which = th_danmaku_default_gold_gain_transfer						which = th_danmaku_default_gold_gain }
		set_variable = { which = th_danmaku_default_power_gain_transfer						which = th_danmaku_default_power_gain }
		set_variable = { which = th_danmaku_default_start_level_transfer					which = th_danmaku_default_start_level }
		set_variable = { which = th_danmaku_default_level_1_exp_transfer					which = th_danmaku_default_level_1_exp }
		set_variable = { which = th_danmaku_default_start_exp_transfer						which = th_danmaku_default_start_exp }
		set_variable = { which = th_danmaku_default_start_skills_transfer					which = th_danmaku_default_starting_skill_points }
		PREV = {
			set_variable = { which = th_danmaku_default_max_health_transfer 					which = PREV }
			set_variable = { which = th_danmaku_default_max_mana_transfer						which = PREV }
			set_variable = { which = th_danmaku_default_max_action_points_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_hpm_transfer							which = PREV }
			set_variable = { which = th_danmaku_default_mpm_transfer							which = PREV }
			set_variable = { which = th_danmaku_default_ini_bonus_transfer						which = PREV }
			set_variable = { which = th_danmaku_default_hit_bonus_transfer						which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_bonus_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_die_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_die_num_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_physical_crit_roll_needed_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_bonus_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_die_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_die_num_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_magical_crit_roll_needed_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_bonus_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_die_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_die_num_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_psionic_crit_roll_needed_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_crit_roll_damage_multipler_transfer		which = PREV }

			set_variable = { which = th_danmaku_default_physical_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_magical_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_bludgeoning_damage_modifier_transfer	which = PREV }
			set_variable = { which = th_danmaku_default_piercing_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_slashing_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_fire_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_frost_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_earth_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_lightning_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_nature_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_holy_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_shadow_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_necrotic_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_arcane_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_infernal_damage_modifier_transfer		which = PREV }

			set_variable = { which = th_danmaku_default_physical_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_magical_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_psionic_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_bludgeoning_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_piercing_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_slashing_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_fire_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_frost_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_earth_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_lightning_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_nature_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_holy_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_shadow_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_necrotic_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_arcane_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_infernal_resistance_transfer			which = PREV }
			
			set_variable = { which = th_danmaku_default_healing_die_transfer					which = PREV }
			set_variable = { which = th_danmaku_default_healing_die_num_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_healing_crit_roll_needed_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_healing_received_bonus_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_healing_received_modifier_transfer		which = PREV }

			set_variable = { which = th_danmaku_default_armor_class_transfer					which = PREV }
			set_variable = { which = th_danmaku_default_saving_throw_die_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_resistance_transfer						which = PREV }

			set_variable = { which = th_danmaku_default_gold_gain_transfer						which = PREV }
			set_variable = { which = th_danmaku_default_power_gain_transfer						which = PREV }
			set_variable = { which = th_danmaku_default_start_level_transfer					which = PREV }
			set_variable = { which = th_danmaku_default_level_1_exp_transfer					which = PREV }
			set_variable = { which = th_danmaku_default_start_exp_transfer						which = PREV }
			set_variable = { which = th_danmaku_default_start_skills_transfer					which = PREV }
			
			set_variable = { which = th_danmaku_max_health 								which = th_danmaku_default_max_health_transfer }
			set_variable = { which = th_danmaku_health 									which = th_danmaku_default_max_health_transfer }
			set_variable = { which = th_danmaku_max_mana								which = th_danmaku_default_max_mana_transfer }
			set_variable = { which = th_danmaku_mana									which = th_danmaku_default_max_mana_transfer }
			set_variable = { which = th_danmaku_max_action_points 						which = th_danmaku_default_max_action_points_transfer }
			set_variable = { which = th_danmaku_action_points 							which = th_danmaku_default_max_action_points_transfer }
			set_variable = { which = th_danmaku_hpm										which = th_danmaku_default_hpm_transfer }
			set_variable = { which = th_danmaku_mpm										which = th_danmaku_default_mpm_transfer }
			set_variable = { which = th_danmaku_ini_bonus								which = th_danmaku_default_ini_bonus_transfer }
			set_variable = { which = th_danmaku_hit_bonus								which = th_danmaku_default_hit_bonus_transfer }
			set_variable = { which = th_danmaku_physical_attack_bonus					which = th_danmaku_default_physical_attack_bonus_transfer }
			set_variable = { which = th_danmaku_physical_attack_die						which = th_danmaku_default_physical_attack_die_transfer }
			set_variable = { which = th_danmaku_physical_attack_die_num					which = th_danmaku_default_physical_attack_die_num_transfer }
			set_variable = { which = th_danmaku_physical_crit_roll_needed				which = th_danmaku_default_physical_crit_roll_needed_transfer }
			set_variable = { which = th_danmaku_physical_crit_roll_damage_multiplier	which = th_danmaku_default_crit_roll_damage_multipler_transfer }
			set_variable = { which = th_danmaku_magical_attack_bonus					which = th_danmaku_default_magical_attack_bonus_transfer }
			set_variable = { which = th_danmaku_magical_attack_die						which = th_danmaku_default_magical_attack_die_transfer }
			set_variable = { which = th_danmaku_magical_attack_die_num					which = th_danmaku_default_magical_attack_die_num_transfer }
			set_variable = { which = th_danmaku_magical_crit_roll_needed				which = th_danmaku_default_magical_crit_roll_needed_transfer }
			set_variable = { which = th_danmaku_magical_crit_roll_damage_multiplier		which = th_danmaku_default_crit_roll_damage_multipler_transfer }
			set_variable = { which = th_danmaku_psionic_attack_bonus					which = th_danmaku_default_psionic_attack_bonus_transfer }
			set_variable = { which = th_danmaku_psionic_attack_die						which = th_danmaku_default_psionic_attack_die_transfer }
			set_variable = { which = th_danmaku_psionic_attack_die_num					which = th_danmaku_default_psionic_attack_die_num_transfer }
			set_variable = { which = th_danmaku_psionic_crit_roll_needed				which = th_danmaku_default_psionic_crit_roll_needed_transfer }
			set_variable = { which = th_danmaku_psionic_crit_roll_damage_multiplier		which = th_danmaku_default_crit_roll_damage_multipler_transfer }

			set_variable = { which = th_danmaku_physical_damage_modifier				which = th_danmaku_default_physical_damage_modifier_transfer }
			set_variable = { which = th_danmaku_magical_damage_modifier					which = th_danmaku_default_magical_damage_modifier_transfer }
			set_variable = { which = th_danmaku_psionic_damage_modifier					which = th_danmaku_default_psionic_damage_modifier_transfer }
			set_variable = { which = th_danmaku_bludgeoning_damage_modifier				which = th_danmaku_default_bludgeoning_damage_modifier_transfer }
			set_variable = { which = th_danmaku_piercing_damage_modifier				which = th_danmaku_default_piercing_damage_modifier_transfer }
			set_variable = { which = th_danmaku_slashing_damage_modifier				which = th_danmaku_default_slashing_damage_modifier_transfer }
			set_variable = { which = th_danmaku_fire_damage_modifier					which = th_danmaku_default_fire_damage_modifier_transfer }
			set_variable = { which = th_danmaku_frost_damage_modifier					which = th_danmaku_default_frost_damage_modifier_transfer }
			set_variable = { which = th_danmaku_earth_damage_modifier					which = th_danmaku_default_earth_damage_modifier_transfer }
			set_variable = { which = th_danmaku_lightning_damage_modifier				which = th_danmaku_default_lightning_damage_modifier_transfer }
			set_variable = { which = th_danmaku_nature_damage_modifier					which = th_danmaku_default_nature_damage_modifier_transfer }
			set_variable = { which = th_danmaku_holy_damage_modifier					which = th_danmaku_default_holy_damage_modifier_transfer }
			set_variable = { which = th_danmaku_shadow_damage_modifier					which = th_danmaku_default_shadow_damage_modifier_transfer }
			set_variable = { which = th_danmaku_necrotic_damage_modifier				which = th_danmaku_default_necrotic_damage_modifier_transfer }
			set_variable = { which = th_danmaku_arcane_damage_modifier					which = th_danmaku_default_arcane_damage_modifier_transfer }
			set_variable = { which = th_danmaku_infernal_damage_modifier				which = th_danmaku_default_infernal_damage_modifier_transfer }
			set_variable = { which = th_danmaku_physical_resistance						which = th_danmaku_default_physical_resistance_transfer }
			set_variable = { which = th_danmaku_magical_resistance						which = th_danmaku_default_magical_resistance_transfer }
			set_variable = { which = th_danmaku_psionic_resistance						which = th_danmaku_default_psionic_resistance_transfer }
			set_variable = { which = th_danmaku_bludgeoning_resistance					which = th_danmaku_default_bludgeoning_resistance_transfer }
			set_variable = { which = th_danmaku_piercing_resistance						which = th_danmaku_default_piercing_resistance_transfer }
			set_variable = { which = th_danmaku_slashing_resistance						which = th_danmaku_default_slashing_resistance_transfer }
			set_variable = { which = th_danmaku_fire_resistance							which = th_danmaku_default_fire_resistance_transfer }
			set_variable = { which = th_danmaku_frost_resistance						which = th_danmaku_default_frost_resistance_transfer }
			set_variable = { which = th_danmaku_earth_resistance						which = th_danmaku_default_earth_resistance_transfer }
			set_variable = { which = th_danmaku_lightning_resistance					which = th_danmaku_default_lightning_resistance_transfer }
			set_variable = { which = th_danmaku_nature_resistance						which = th_danmaku_default_nature_resistance_transfer }
			set_variable = { which = th_danmaku_holy_resistance							which = th_danmaku_default_holy_resistance_transfer }
			set_variable = { which = th_danmaku_shadow_resistance						which = th_danmaku_default_shadow_resistance_transfer }
			set_variable = { which = th_danmaku_necrotic_resistance						which = th_danmaku_default_necrotic_resistance_transfer }
			set_variable = { which = th_danmaku_arcane_resistance						which = th_danmaku_default_arcane_resistance_transfer }
			set_variable = { which = th_danmaku_infernal_resistance						which = th_danmaku_default_infernal_resistance_transfer }
			
			set_variable = { which = th_danmaku_healing_die								which = th_danmaku_default_healing_die_transfer }
			set_variable = { which = th_danmaku_healing_die_num							which = th_danmaku_default_healing_die_num_transfer }
			set_variable = { which = th_danmaku_healing_crit_roll_needed				which = th_danmaku_default_healing_crit_roll_needed_transfer }
			set_variable = { which = th_danmaku_healing_received_bonus					which = th_danmaku_default_healing_received_bonus_transfer }
			set_variable = { which = th_danmaku_healing_received_modifier				which = th_danmaku_default_healing_received_modifier_transfer }

			set_variable = { which = th_danmaku_armor_class								which = th_danmaku_default_armor_class_transfer }
			set_variable = { which = th_danmaku_saving_throw_die						which = th_danmaku_default_saving_throw_die_transfer }
			set_variable = { which = th_danmaku_resistance								which = th_danmaku_default_resistance_transfer }

			set_variable = { which = th_danmaku_gold_gain								which = th_danmaku_default_gold_gain_transfer }
			set_variable = { which = th_danmaku_power_gain								which = th_danmaku_default_power_gain_transfer }
			set_variable = { which = th_ruler_danmaku_level								which = th_danmaku_default_start_level_transfer }
			set_variable = { which = th_danmaku_exp_threshold							which = th_danmaku_default_level_1_exp_transfer }
			set_variable = { which = th_danmaku_current_exp								which = th_danmaku_default_start_exp_transfer }
			set_variable = { which = th_danmaku_available_skill_points					which = th_danmaku_default_start_skills_transfer }
			set_variable = { which = th_danmaku_default_max_level						which = PREV }	#Utilizes same variable name
		}
	}
	#Set all the show variables
	th_gui_update_danmaku_bar = { type = health }
	th_gui_update_danmaku_bar = { type = mana }
	th_gui_update_danmaku_bar = { type = exp }
	th_gui_update_danmaku_bar = { type = action_points }
	th_update_gain_modifier = { type = gold }
	th_update_gain_modifier = { type = power }
}

th_transfer_default_stats_to_target_vars = {
	1 = {
		set_variable = { which = th_danmaku_default_max_health_transfer 				which = th_danmaku_default_max_health }
		set_variable = { which = th_danmaku_default_max_mana_transfer					which = th_danmaku_default_max_mana }
		set_variable = { which = th_danmaku_default_max_action_points_transfer			which = th_danmaku_default_max_action_points }
		set_variable = { which = th_danmaku_default_ini_bonus_transfer					which = th_danmaku_default_ini_bonus }
		set_variable = { which = th_danmaku_default_hit_bonus_transfer					which = th_danmaku_default_hit_bonus }

		set_variable = { which = th_danmaku_default_physical_attack_bonus_transfer		which = th_danmaku_default_physical_attack_bonus }
		set_variable = { which = th_danmaku_default_physical_attack_die_transfer		which = th_danmaku_default_physical_attack_die }
		set_variable = { which = th_danmaku_default_physical_attack_die_num_transfer	which = th_danmaku_default_physical_attack_die_num }
		set_variable = { which = th_danmaku_default_physical_crit_roll_needed_transfer	which = th_danmaku_default_physical_crit_roll_needed }
		set_variable = { which = th_danmaku_default_magical_attack_bonus_transfer		which = th_danmaku_default_magical_attack_bonus }
		set_variable = { which = th_danmaku_default_magical_attack_die_transfer			which = th_danmaku_default_magical_attack_die }
		set_variable = { which = th_danmaku_default_magical_attack_die_num_transfer		which = th_danmaku_default_magical_attack_die_num }
		set_variable = { which = th_danmaku_default_magical_crit_roll_needed_transfer	which = th_danmaku_default_magical_crit_roll_needed }
		set_variable = { which = th_danmaku_default_psionic_attack_bonus_transfer		which = th_danmaku_default_psionic_attack_bonus }
		set_variable = { which = th_danmaku_default_psionic_attack_die_transfer			which = th_danmaku_default_psionic_attack_die }
		set_variable = { which = th_danmaku_default_psionic_attack_die_num_transfer		which = th_danmaku_default_psionic_attack_die_num }
		set_variable = { which = th_danmaku_default_psionic_crit_roll_needed_transfer	which = th_danmaku_default_psionic_crit_roll_needed }
		set_variable = { which = th_danmaku_default_crit_roll_damage_multipler_transfer	which = th_danmaku_default_crit_damage_multiplier }

		set_variable = { which = th_danmaku_default_physical_damage_modifier_transfer		which = th_danmaku_default_physical_damage_modifier }
		set_variable = { which = th_danmaku_default_magical_damage_modifier_transfer		which = th_danmaku_default_magical_damage_modifier }
		set_variable = { which = th_danmaku_default_psionic_damage_modifier_transfer		which = th_danmaku_default_psionic_damage_modifier }
		set_variable = { which = th_danmaku_default_bludgeoning_damage_modifier_transfer	which = th_danmaku_default_bludgeoning_damage_modifier }
		set_variable = { which = th_danmaku_default_piercing_damage_modifier_transfer		which = th_danmaku_default_piercing_damage_modifier }
		set_variable = { which = th_danmaku_default_slashing_damage_modifier_transfer		which = th_danmaku_default_slashing_damage_modifier }
		set_variable = { which = th_danmaku_default_fire_damage_modifier_transfer			which = th_danmaku_default_fire_damage_modifier }
		set_variable = { which = th_danmaku_default_frost_damage_modifier_transfer			which = th_danmaku_default_frost_damage_modifier }
		set_variable = { which = th_danmaku_default_earth_damage_modifier_transfer			which = th_danmaku_default_earth_damage_modifier }
		set_variable = { which = th_danmaku_default_lightning_damage_modifier_transfer		which = th_danmaku_default_lightning_damage_modifier }
		set_variable = { which = th_danmaku_default_nature_damage_modifier_transfer			which = th_danmaku_default_nature_damage_modifier }
		set_variable = { which = th_danmaku_default_holy_damage_modifier_transfer			which = th_danmaku_default_holy_damage_modifier }
		set_variable = { which = th_danmaku_default_shadow_damage_modifier_transfer			which = th_danmaku_default_shadow_damage_modifier }
		set_variable = { which = th_danmaku_default_necrotic_damage_modifier_transfer		which = th_danmaku_default_necrotic_damage_modifier }
		set_variable = { which = th_danmaku_default_arcane_damage_modifier_transfer			which = th_danmaku_default_arcane_damage_modifier }
		set_variable = { which = th_danmaku_default_infernal_damage_modifier_transfer		which = th_danmaku_default_infernal_damage_modifier }
		set_variable = { which = th_danmaku_default_physical_resistance_transfer			which = th_danmaku_default_physical_resistance }
		set_variable = { which = th_danmaku_default_magical_resistance_transfer				which = th_danmaku_default_magical_resistance }
		set_variable = { which = th_danmaku_default_psionic_resistance_transfer				which = th_danmaku_default_psionic_resistance }
		set_variable = { which = th_danmaku_default_bludgeoning_resistance_transfer			which = th_danmaku_default_bludgeoning_resistance }
		set_variable = { which = th_danmaku_default_piercing_resistance_transfer			which = th_danmaku_default_piercing_resistance }
		set_variable = { which = th_danmaku_default_slashing_resistance_transfer			which = th_danmaku_default_slashing_resistance }
		set_variable = { which = th_danmaku_default_fire_resistance_transfer				which = th_danmaku_default_fire_resistance }
		set_variable = { which = th_danmaku_default_frost_resistance_transfer				which = th_danmaku_default_frost_resistance }
		set_variable = { which = th_danmaku_default_earth_resistance_transfer				which = th_danmaku_default_earth_resistance }
		set_variable = { which = th_danmaku_default_lightning_resistance_transfer			which = th_danmaku_default_lightning_resistance }
		set_variable = { which = th_danmaku_default_nature_resistance_transfer				which = th_danmaku_default_nature_resistance }
		set_variable = { which = th_danmaku_default_holy_resistance_transfer				which = th_danmaku_default_holy_resistance }
		set_variable = { which = th_danmaku_default_shadow_resistance_transfer				which = th_danmaku_default_shadow_resistance }
		set_variable = { which = th_danmaku_default_necrotic_resistance_transfer			which = th_danmaku_default_necrotic_resistance }
		set_variable = { which = th_danmaku_default_arcane_resistance_transfer				which = th_danmaku_default_arcane_resistance }
		set_variable = { which = th_danmaku_default_infernal_resistance_transfer			which = th_danmaku_default_infernal_resistance }

		set_variable = { which = th_danmaku_default_healing_die_transfer					which = th_danmaku_default_healing_die }
		set_variable = { which = th_danmaku_default_healing_die_num_transfer				which = th_danmaku_default_healing_die_num }
		set_variable = { which = th_danmaku_default_healing_crit_roll_needed_transfer		which = th_danmaku_default_healing_crit_roll_needed }
		set_variable = { which = th_danmaku_default_healing_received_bonus_transfer			which = th_danmaku_default_healing_received_bonus }
		set_variable = { which = th_danmaku_default_healing_received_modifier_transfer		which = th_danmaku_default_healing_received_modifier }

		set_variable = { which = th_danmaku_default_armor_class_transfer					which = th_danmaku_default_armor_class }
		set_variable = { which = th_danmaku_default_saving_throw_die_transfer				which = th_danmaku_default_saving_throw_die }
		set_variable = { which = th_danmaku_default_resistance_transfer						which = th_danmaku_default_resistance }

		set_variable = { which = th_danmaku_default_start_level_transfer					which = th_danmaku_default_start_level }
		PREV = {
			set_variable = { which = th_danmaku_default_max_health_transfer 				which = PREV }
			set_variable = { which = th_danmaku_default_max_mana_transfer					which = PREV }
			set_variable = { which = th_danmaku_default_max_action_points_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_ini_bonus_transfer					which = PREV }
			set_variable = { which = th_danmaku_default_hit_bonus_transfer					which = PREV }
			
			set_variable = { which = th_danmaku_default_physical_attack_bonus_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_die_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_physical_attack_die_num_transfer	which = PREV }
			set_variable = { which = th_danmaku_default_physical_crit_roll_needed_transfer	which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_bonus_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_die_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_magical_attack_die_num_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_magical_crit_roll_needed_transfer	which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_bonus_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_die_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_psionic_attack_die_num_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_crit_roll_needed_transfer	which = PREV }
			set_variable = { which = th_danmaku_default_crit_roll_damage_multipler_transfer	which = PREV }

			set_variable = { which = th_danmaku_default_physical_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_magical_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_psionic_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_bludgeoning_damage_modifier_transfer	which = PREV }
			set_variable = { which = th_danmaku_default_piercing_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_slashing_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_fire_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_frost_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_earth_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_lightning_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_nature_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_holy_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_shadow_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_necrotic_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_arcane_damage_modifier_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_infernal_damage_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_physical_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_magical_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_psionic_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_bludgeoning_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_piercing_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_slashing_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_fire_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_frost_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_earth_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_lightning_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_nature_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_holy_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_shadow_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_necrotic_resistance_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_arcane_resistance_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_infernal_resistance_transfer			which = PREV }

			set_variable = { which = th_danmaku_default_healing_die_transfer					which = PREV }
			set_variable = { which = th_danmaku_default_healing_die_num_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_healing_crit_roll_needed_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_healing_received_bonus_transfer			which = PREV }
			set_variable = { which = th_danmaku_default_healing_received_modifier_transfer		which = PREV }
			set_variable = { which = th_danmaku_default_armor_class_transfer					which = PREV }
			set_variable = { which = th_danmaku_default_saving_throw_die_transfer				which = PREV }
			set_variable = { which = th_danmaku_default_resistance_transfer						which = PREV }

			set_variable = { which = th_danmaku_default_start_level_transfer				which = PREV }

			set_variable = { which = $max_hp_var$								which = th_danmaku_default_max_health_transfer					}
			set_variable = { which = $max_mp_var$								which = th_danmaku_default_max_mana_transfer					}
			set_variable = { which = $max_ap_var$								which = th_danmaku_default_max_action_points_transfer			}
			set_variable = { which = $initiative_bonus_var$						which = th_danmaku_default_ini_bonus_transfer					}
			set_variable = { which = $hit_bonus_var$							which = th_danmaku_default_hit_bonus_transfer					}

			set_variable = { which = $physical_attack_bonus_var$				which = th_danmaku_default_physical_attack_bonus_transfer		}
			set_variable = { which = $physical_attack_die_var$					which = th_danmaku_default_physical_attack_die_transfer			}
			set_variable = { which = $physical_attack_die_num_var$				which = th_danmaku_default_physical_attack_die_num_transfer		}
			set_variable = { which = $physical_crit_roll_needed_var$			which = th_danmaku_default_physical_crit_roll_needed_transfer	}
			set_variable = { which = $physical_crit_roll_multiplier_var$		which = th_danmaku_default_crit_roll_damage_multipler_transfer	}
			set_variable = { which = $magical_attack_bonus_var$					which = th_danmaku_default_magical_attack_bonus_transfer		}
			set_variable = { which = $magical_attack_die_var$					which = th_danmaku_default_magical_attack_die_transfer			}
			set_variable = { which = $magical_attack_die_num_var$				which = th_danmaku_default_magical_attack_die_num_transfer		}
			set_variable = { which = $magical_crit_roll_needed_var$				which = th_danmaku_default_magical_crit_roll_needed_transfer	}
			set_variable = { which = $magical_crit_roll_multiplier_var$			which = th_danmaku_default_crit_roll_damage_multipler_transfer	}
			set_variable = { which = $psionic_attack_bonus_var$					which = th_danmaku_default_psionic_attack_bonus_transfer		}
			set_variable = { which = $psionic_attack_die_var$					which = th_danmaku_default_psionic_attack_die_transfer			}
			set_variable = { which = $psionic_attack_die_num_var$				which = th_danmaku_default_psionic_attack_die_num_transfer		}
			set_variable = { which = $psionic_crit_roll_needed_var$				which = th_danmaku_default_psionic_crit_roll_needed_transfer	}
			set_variable = { which = $psionic_crit_roll_multiplier_var$			which = th_danmaku_default_crit_roll_damage_multipler_transfer	}

			set_variable = { which = $physical_damage_modifier_var$					which = th_danmaku_default_physical_damage_modifier_transfer	}
			set_variable = { which = $magical_damage_modifier_var$					which = th_danmaku_default_magical_damage_modifier_transfer		}
			set_variable = { which = $psionic_damage_modifier_var$					which = th_danmaku_default_psionic_damage_modifier_transfer		}
			set_variable = { which = $bludgeoning_damage_modifier_var$				which = th_danmaku_default_bludgeoning_damage_modifier_transfer	}
			set_variable = { which = $piercing_damage_modifier_var$					which = th_danmaku_default_piercing_damage_modifier_transfer	}
			set_variable = { which = $slashing_damage_modifier_var$					which = th_danmaku_default_slashing_damage_modifier_transfer	}
			set_variable = { which = $fire_damage_modifier_var$						which = th_danmaku_default_fire_damage_modifier_transfer		}
			set_variable = { which = $frost_damage_modifier_var$					which = th_danmaku_default_frost_damage_modifier_transfer		}
			set_variable = { which = $earth_damage_modifier_var$					which = th_danmaku_default_earth_damage_modifier_transfer		}
			set_variable = { which = $lightning_damage_modifier_var$				which = th_danmaku_default_lightning_damage_modifier_transfer	}
			set_variable = { which = $nature_damage_modifier_var$					which = th_danmaku_default_nature_damage_modifier_transfer		}
			set_variable = { which = $holy_damage_modifier_var$						which = th_danmaku_default_holy_damage_modifier_transfer		}
			set_variable = { which = $shadow_damage_modifier_var$					which = th_danmaku_default_shadow_damage_modifier_transfer		}
			set_variable = { which = $necrotic_damage_modifier_var$					which = th_danmaku_default_necrotic_damage_modifier_transfer	}
			set_variable = { which = $arcane_damage_modifier_var$					which = th_danmaku_default_arcane_damage_modifier_transfer		}
			set_variable = { which = $infernal_damage_modifier_var$					which = th_danmaku_default_infernal_damage_modifier_transfer	}
			set_variable = { which = $physical_resistance_var$						which = th_danmaku_default_physical_resistance_transfer			}
			set_variable = { which = $magical_resistance_var$						which = th_danmaku_default_magical_resistance_transfer			}
			set_variable = { which = $psionic_resistance_var$						which = th_danmaku_default_psionic_resistance_transfer			}
			set_variable = { which = $bludgeoning_resistance_var$					which = th_danmaku_default_bludgeoning_resistance_transfer		}
			set_variable = { which = $piercing_resistance_var$						which = th_danmaku_default_piercing_resistance_transfer			}
			set_variable = { which = $slashing_resistance_var$						which = th_danmaku_default_slashing_resistance_transfer			}
			set_variable = { which = $fire_resistance_var$							which = th_danmaku_default_fire_resistance_transfer				}
			set_variable = { which = $frost_resistance_var$							which = th_danmaku_default_frost_resistance_transfer			}
			set_variable = { which = $earth_resistance_var$							which = th_danmaku_default_earth_resistance_transfer			}
			set_variable = { which = $lightning_resistance_var$						which = th_danmaku_default_lightning_resistance_transfer		}
			set_variable = { which = $nature_resistance_var$						which = th_danmaku_default_nature_resistance_transfer			}
			set_variable = { which = $holy_resistance_var$							which = th_danmaku_default_holy_resistance_transfer				}
			set_variable = { which = $shadow_resistance_var$						which = th_danmaku_default_shadow_resistance_transfer			}
			set_variable = { which = $necrotic_resistance_var$						which = th_danmaku_default_necrotic_resistance_transfer			}
			set_variable = { which = $arcane_resistance_var$						which = th_danmaku_default_arcane_resistance_transfer			}
			set_variable = { which = $infernal_resistance_var$						which = th_danmaku_default_infernal_resistance_transfer			}

			set_variable = { which = $healing_die_var$								which = th_danmaku_default_healing_die_transfer					}
			set_variable = { which = $healing_die_num_var$							which = th_danmaku_default_healing_die_num_transfer				}
			set_variable = { which = $healing_crit_roll_needed_var$					which = th_danmaku_default_healing_crit_roll_needed_transfer	}
			set_variable = { which = $healing_received_bonus_var$					which = th_danmaku_default_healing_received_bonus_transfer		}
			set_variable = { which = $healing_received_modifier_var$				which = th_danmaku_default_healing_received_modifier_transfer	}
			set_variable = { which = $armor_class_var$								which = th_danmaku_default_armor_class_transfer					}
			set_variable = { which = $saving_throw_die_var$							which = th_danmaku_default_saving_throw_die_transfer			}
			set_variable = { which = $resistance_var$								which = th_danmaku_default_resistance_transfer					}

			set_variable = { which = $level_var$								which = th_danmaku_default_start_level_transfer					}
		}
	}
}

th_set_default_danmaku_class = {
	custom_tooltip = th_set_danmaku_class_warrior_tt
	hidden_effect = {
		set_ruler_flag = th_danmaku_class_warrior
	}
	th_set_danmaku_class_warrior = yes
}


th_set_danmaku_ruler = {
	th_set_default_danmaku_stats = yes
	th_set_danmaku_ruler_$who$ = yes
	set_ruler_flag = th_danmaku_ruler_is_set
	set_ruler_flag = th_danmaku_ruler_$who$
}
th_set_danmaku_heir = {
	set_heir_flag = th_danmaku_ruler_$who$
}

th_add_experience_variable = {
	if = {
		limit = { NOT = { check_variable = { which = th_ruler_danmaku_level which = th_danmaku_default_max_level } } }
		custom_tooltip = th_add_experience_tt
		hidden_effect = {
			change_variable = {
				which = th_danmaku_current_exp
				which = $input$
			}
			th_gui_update_exp_bar = yes
			while = {
				limit = { check_variable = { which = th_danmaku_current_exp which = th_danmaku_exp_threshold } }
				th_level_up = yes
			}
		}
	}
}

th_add_experience_value = {
	if = {
		limit = { NOT = { check_variable = { which = th_ruler_danmaku_level which = th_danmaku_default_max_level } } }
		custom_tooltip = th_add_experience_tt
		hidden_effect = {
			change_variable = {
				which = th_danmaku_current_exp
				value = $input$
			}
			th_gui_update_exp_bar = yes
			while = {
				limit = { check_variable = { which = th_danmaku_current_exp which = th_danmaku_exp_threshold } }
				th_level_up = yes
			}
		}
	}
}

th_add_experience = {
	th_add_experience_$type$ = { input = $value$ }
}

th_level_up = {
	if = {
		limit = { NOT = { check_variable = { which = th_ruler_danmaku_level which = th_danmaku_default_max_level } } }
		custom_tooltip = th_level_up_tt
		hidden_effect = {
			change_variable = {
				which = th_ruler_danmaku_level
				value = 1
			}
			if = {
				limit = { NOT = { check_variable = { which = th_ruler_danmaku_level which = th_danmaku_default_max_level } } }
				subtract_variable = {
					which = th_danmaku_current_exp
					which = th_danmaku_exp_threshold
				}
				1 = {
					set_variable = {
						which = th_danmaku_default_skill_points_per_level_transfer
						which = th_danmaku_default_skill_points_per_level
					}
					set_variable = {
						which = th_danmaku_default_exp_increase_transfer
						which = th_danmaku_default_exp_increase
					}
					PREV = {
						set_variable = {
							which = th_danmaku_default_skill_points_per_level_transfer
							which = PREV
						}
						set_variable = {
							which = th_danmaku_default_exp_increase_transfer
							which = PREV
						}
					}
				}
				change_variable = {
					which = th_danmaku_available_skill_points
					which = th_danmaku_default_skill_points_per_level_transfer
				}
				#set_variable = {
				#	which = th_danmaku_exp_threshold_old
				#	which = th_danmaku_exp_threshold
				#}
				change_variable = {
					which = th_danmaku_exp_threshold
					which = th_danmaku_default_exp_increase_transfer
				}
				#change_variable = {
				#	which = th_danmaku_exp_threshold
				#	which = th_danmaku_exp_threshold_old
				#}
			}
			else = {
				set_variable = {
					which = th_danmaku_current_exp
					value = 1
				}
				set_variable = {
					which = th_danmaku_exp_threshold
					value = 1
				}
				set_ruler_flag = th_reached_max_level
			}
			th_gui_update_exp_bar = yes
		}
	}
}


th_monthly_country_danmaku_duel_update = {
	if = {
		limit = { th_is_not_in_a_danmaku_duel = yes }
		#Health regeneration
		change_variable = { which = th_danmaku_health which = th_danmaku_hpm }
		if = {
			limit = { check_variable = { which = th_danmaku_health which = th_danmaku_max_health } }
			set_variable = { which = th_danmaku_health which = th_danmaku_max_health }
		}
		if = {
			limit = { NOT = { check_variable = { which = th_danmaku_health value = 0 } } }
			set_variable = { which = th_danmaku_health value = 0 }
		}
		th_gui_update_danmaku_bar = { type = health }
		#Mana regeneration
		change_variable = { which = th_danmaku_mana which = th_danmaku_mpm }
		if = {
			limit = { check_variable = { which = th_danmaku_mana which = th_danmaku_max_mana } }
			set_variable = { which = th_danmaku_mana which = th_danmaku_max_mana }
		}
		if = {
			limit = { NOT = { check_variable = { which = th_danmaku_mana value = 0 } } }
			set_variable = { which = th_danmaku_mana value = 0 }
		}
		th_gui_update_danmaku_bar = { type = mana }
	}
	if = {
		limit = { th_is_duelling_an_unlanded_character = yes }
		th_monthly_danmaku_duel_unlanded_duration_reduction = yes
	}
}


th_define_exp_reward_base = {
	1 = {
		set_variable = {
			which = th_danmaku_default_exp_reward_base_transfer
			which = th_danmaku_default_exp_reward_base
		}
		set_variable = {
			which = th_danmaku_default_exp_scale_transfer
			which = th_danmaku_default_exp_scale
		}
		PREV = {
			set_variable = {
				which = th_danmaku_default_exp_reward_base_transfer
				which = PREV
			}
			set_variable = {
				which = th_danmaku_default_exp_scale_transfer
				which = PREV
			}
		}
	}
	set_variable = {
		which = th_total_exp_gain
		which = th_danmaku_default_exp_reward_base_transfer
	}
	if = {
		limit = { th_is_duelling_an_unlanded_character = yes }
		set_variable = {
			which = th_ruler_danmaku_level_transfer
			which = th_enemy_character_level
		}
	}
	else = {
		event_target:enemy_duelist = {
			set_variable = {
				which = th_ruler_danmaku_level_transfer
				which = th_ruler_danmaku_level
			}
			PREV = {
				set_variable = {
					which = th_ruler_danmaku_level_transfer
					which = PREV
				}
			}
		}
	}
	multiply_variable = {
		which = th_danmaku_default_exp_scale_transfer
		which = th_ruler_danmaku_level_transfer
	}
	change_variable = {
		which = th_total_exp_gain
		which = th_danmaku_default_exp_scale_transfer
	}
}
th_define_exp_reward_win = {
	th_define_exp_reward_base = yes
	1 = {
		set_variable = {
			which = th_danmaku_default_exp_reward_win_transfer
			which = th_danmaku_default_exp_reward_win
		}
		set_variable = {
			which = th_danmaku_default_exp_win_modifier_transfer
			which = th_danmaku_default_exp_win_modifier
		}
		PREV = {
			set_variable = {
				which = th_danmaku_default_exp_reward_win_transfer
				which = PREV
			}
			set_variable = {
				which = th_danmaku_default_exp_win_modifier_transfer
				which = PREV
			}
		}
	}
	change_variable = {
		which = th_total_exp_gain
		which = th_danmaku_default_exp_reward_win
	}
	multiply_variable = {
		which = th_danmaku_default_exp_reward_win_transfer
		which = th_ruler_danmaku_level_transfer
	}
	change_variable = {
		which = th_total_exp_gain
		which = th_danmaku_default_exp_reward_win_transfer
	}
}
th_define_exp_reward = {
	if = {
		limit = { NOT = { check_variable = { which = th_ruler_danmaku_level which = th_danmaku_default_max_level } } }
		th_define_exp_reward_$type$ = yes
	}
}

th_define_danmaku_gold_reward = {
	if = {
		limit = { 1 = { check_variable = { which = th_danmaku_default_gold_gain_activated value = 1 } } }
		1 = {
			set_variable = {
				which = th_danmaku_base_gold_reward_transfer
				which = th_danmaku_default_gold_reward_base
			}
			if = {
				limit = { check_variable = { which = th_danmaku_default_gold_reward_scale_active value = 1 } }
				set_variable = {
					which = th_danmaku_scale_gold_reward_transfer
					which = th_danmaku_default_gold_reward_scale
				}
			}
			else = {
				set_variable = {
					which = th_danmaku_scale_gold_reward_transfer
					value = 0
				}
			}
			PREV = {
				set_variable = {
					which = th_danmaku_base_gold_reward_transfer
					which = PREV
				}
				set_variable = {
					which = th_danmaku_scale_gold_reward_transfer
					which = PREV
				}
			}
		}
		set_variable = {
			which = th_total_gold_gain
			which = th_danmaku_base_gold_reward_transfer
		}
		if = {
			limit = { th_is_duelling_an_unlanded_character = yes }
			set_variable = {
				which = th_ruler_danmaku_level_transfer
				which = th_enemy_character_level
			}
		}
		else = {
			event_target:enemy_duelist = {
				set_variable = {
					which = th_ruler_danmaku_level_transfer
					which = th_ruler_danmaku_level
				}
				PREV = {
					set_variable = {
						which = th_ruler_danmaku_level_transfer
						which = PREV
					}
				}
			}
		}
		multiply_variable = {
			which = th_danmaku_scale_gold_reward_transfer
			which = th_ruler_danmaku_level_transfer
		}
		change_variable = {
			which = th_total_gold_gain
			which = th_danmaku_scale_gold_reward_transfer
		}
		set_variable = {
			which = th_gold_gain_modifier
			which = th_danmaku_gold_gain
		}
		change_variable = {
			which = th_gold_gain_modifier
			value = 1
		}
		multiply_variable = {
			which = th_total_gold_gain
			which = th_gold_gain_modifier
		}
	}
}

th_define_danmaku_power_reward = {
	if = {
		limit = { 1 = { check_variable = { which = th_danmaku_default_power_gain_activated value = 1 } } }
		1 = {
			set_variable = {
				which = th_danmaku_base_power_reward_transfer
				which = th_danmaku_default_power_reward_base
			}
			if = {
				limit = { check_variable = { which = th_danmaku_default_power_reward_scale_active value = 1 } }
				set_variable = {
					which = th_danmaku_scale_power_reward_transfer
					which = th_danmaku_default_power_reward_scale
				}
			}
			else = {
				set_variable = {
					which = th_danmaku_scale_power_reward_transfer
					value = 0
				}
			}
			PREV = {
				set_variable = {
					which = th_danmaku_base_power_reward_transfer
					which = PREV
				}
				set_variable = {
					which = th_danmaku_scale_power_reward_transfer
					which = PREV
				}
			}
		}
		set_variable = {
			which = th_total_power_gain
			which = th_danmaku_base_power_reward_transfer
		}
		if = {
			limit = { th_is_duelling_an_unlanded_character = yes }
			set_variable = {
				which = th_ruler_danmaku_level_transfer
				which = th_enemy_character_level
			}
		}
		else = {
			event_target:enemy_duelist = {
				set_variable = {
					which = th_ruler_danmaku_level_transfer
					which = th_ruler_danmaku_level
				}
				PREV = {
					set_variable = {
						which = th_ruler_danmaku_level_transfer
						which = PREV
					}
				}
			}
		}
		multiply_variable = {
			which = th_danmaku_scale_power_reward_transfer
			which = th_ruler_danmaku_level_transfer
		}
		change_variable = {
			which = th_total_power_gain
			which = th_danmaku_scale_power_reward_transfer
		}
		set_variable = {
			which = th_power_gain_modifier
			which = th_danmaku_power_gain
		}
		change_variable = {
			which = th_power_gain_modifier
			value = 1
		}
		multiply_variable = {
			which = th_total_power_gain
			which = th_power_gain_modifier
		}
		if = {
			limit = { 1 = { is_variable_equal = { which = th_danmaku_default_power_type value = 4 } } }
			set_country_flag = th_danmaku_power_reward_all
		}
		else_if = {
			limit = { 1 = { is_variable_equal = { which = th_danmaku_default_power_type value = 3 } } }
			set_country_flag = th_danmaku_power_reward_mil
		}
		else_if = {
			limit = { 1 = { is_variable_equal = { which = th_danmaku_default_power_type value = 2 } } }
			set_country_flag = th_danmaku_power_reward_dip
		}
		else_if = {
			limit = { 1 = { is_variable_equal = { which = th_danmaku_default_power_type value = 1 } } }
			set_country_flag = th_danmaku_power_reward_adm
		}
		else = {
			set_country_flag = th_danmaku_power_reward_random
			set_variable = {
				which = th_rng_roll
				value = 0
			}
			th_roll_die_no_variable = {
				die_type = 3
				die_amount = 1
				bonus_per_roll = 0
				result = th_rng_roll
			}
			if = {
				limit = { is_variable_equal = { which = th_rng_roll value = 1 } }
				set_country_flag = th_rng_rolled_adm
			}
			else_if = {
				limit = { is_variable_equal = { which = th_rng_roll value = 2 } }
				set_country_flag = th_rng_rolled_dip
			}
			else = {
				set_country_flag = th_rng_rolled_mil
			}
		}
	}
}

# gold
# power
# exp
th_reward_multiplier = {
	multiply_variable = {
		which = th_total_$type$_gain
		value = $factor$
	}
}

#Suppoorts:
# victory
# draw
th_add_danmaku_exp_reward = {
	if = {
		limit = { NOT = { check_variable = { which = th_ruler_danmaku_level which = th_danmaku_default_max_level } } }
		custom_tooltip = th_add_danmaku_exp_reward_$type$_tt
		hidden_effect = {
			th_add_experience = { type = variable value = th_total_exp_gain }
		}
	}
}
th_add_danmaku_gold_reward = {
	if = {
		limit = { 1 = { check_variable = { which = th_danmaku_default_gold_gain_activated value = 1 } } }
		custom_tooltip = th_add_danmaku_gold_reward_$type$_tt
		hidden_effect = {
			while = {
				limit = { check_variable = { which = th_total_gold_gain value = 1 } }
				add_treasury = 1
				subtract_variable = { which = th_total_gold_gain value = 1 }
			}
			multiply_variable = { which = th_total_gold_gain value = 100 }
			while = {
				limit = { check_variable = { which = th_total_gold_gain value = 1 } }
				add_treasury = 0.01
				subtract_variable = { which = th_total_gold_gain value = 1 }
			}
		}
	}
}
th_add_danmaku_power_reward = {
	if = {
		limit = { 1 = { check_variable = { which = th_danmaku_default_power_gain_activated value = 1 } } }
		if = { limit = { has_country_flag = th_danmaku_power_reward_all } custom_tooltip = th_add_danmaku_all_power_reward_$type$_tt }
		if = { limit = { OR = { has_country_flag = th_danmaku_power_reward_adm has_country_flag = th_rng_rolled_adm } } custom_tooltip = th_add_danmaku_adm_power_reward_$type$_tt }
		if = { limit = { OR = { has_country_flag = th_danmaku_power_reward_dip has_country_flag = th_rng_rolled_dip } } custom_tooltip = th_add_danmaku_dip_power_reward_$type$_tt }
		if = { limit = { OR = { has_country_flag = th_danmaku_power_reward_mil has_country_flag = th_rng_rolled_mil } } custom_tooltip = th_add_danmaku_mil_power_reward_$type$_tt }
		hidden_effect = {
			while = {
				limit = { check_variable = { which = th_total_power_gain value = 1 } }
				trigger_switch = {
					on_trigger = has_country_flag
					th_danmaku_power_reward_all = {
						add_adm_power = 1 add_dip_power = 1 add_mil_power = 1
					}
					th_danmaku_power_reward_adm = { add_adm_power = 1 }
					th_danmaku_power_reward_dip = { add_dip_power = 1 }
					th_danmaku_power_reward_mil = { add_mil_power = 1 }
					th_danmaku_power_reward_random = {
						trigger_switch = {
							on_trigger = has_country_flag
							th_rng_rolled_adm = { add_adm_power = 1 }
							th_rng_rolled_dip = { add_dip_power = 1 }
							th_rng_rolled_mil = { add_mil_power = 1 }
						}
					}
				}
				subtract_variable = { which = th_total_power_gain value = 1 }
			}
			clr_country_flag = th_danmaku_power_reward_all
			clr_country_flag = th_danmaku_power_reward_mil
			clr_country_flag = th_danmaku_power_reward_dip
			clr_country_flag = th_danmaku_power_reward_adm
			clr_country_flag = th_danmaku_power_reward_random
			clr_country_flag = th_rng_rolled_adm
			clr_country_flag = th_rng_rolled_dip
			clr_country_flag = th_rng_rolled_mil
		}
	}
}

th_danmaku_lose_effect = {
	if = {
		limit = { 1 = { check_variable = { which = th_danmaku_default_setting_ruler_death value = 1 } } }
		kill_ruler = yes
	}
	else = {
		add_ruler_modifier = {
			name = th_danmaku_incapacitated
			duration = 730
		}
		custom_tooltip = th_danmaku_incapacitated_tt
		th_add_danmaku_exp_reward = { type = defeat }
	}
}

################################################################################

#Get the extra buffs from the danmaku modifiers
th_additional_danmaku_buff = {
	export_to_variable = {
		variable_name = th_additional_danmaku_power
		value = modifier:danmaku_power_constant
		who = ROOT
	}
	export_to_variable = {
		variable_name = th_danmaku_power_modifier
		value = modifier:danmaku_power_factor
		who = ROOT
	}
	set_variable = {
		which = th_danmaku_combat_power
		value = roll_power_gain
	}
	change_variable = {
		which = th_danmaku_power_modifier
		value = 1
	}
	if = {
		limit = {
			NOT = {
				check_variable = {
					which = th_danmaku_power_modifier
					value = 0
				}
			}
		}
		set_variable = {
			which = th_danmaku_power_modifier
			value = 0
		}
	}
	change_variable = {
		which = $fighting_variable$
		which = th_additional_danmaku_power
	}
	multiply_variable = {
		which = $fighting_variable$
		which = th_danmaku_power_modifier
	}
}

#Uses "type"
#Supports the following types:
# incident			- used for all incident related fights
# lesser_incident	- used for all smaller scope incidents related fights
# normal			- used for all the other fights
th_getruler_fighting_skill = {
	#Players Fighting Skills
	#modifiers were moved to modifier:danmaku_power_constant, which is controlled by th_additional_danmaku_buff
	set_variable = {
		which = th_current_fighting_skills_$type$
		value = $skill_boni$
	}
	export_to_variable = {
		variable_name = th_fighting_danmaku_power
		value = modifier:fighting_danmaku_power_constant
		who = ROOT
	}
	change_variable = {
		which = th_current_fighting_skills_$type$
		which = th_fighting_danmaku_power
	}
	#export_to_variable = {
	#	variable_name = th_current_military_skill
	#	value = MIL
	#	who = ROOT
	#}
	#export_to_variable = {
	#	variable_name = th_current_army_tradition_skill
	#	value = army_tradition
	#	who = ROOT
	#}
	#export_to_variable = {
	#	variable_name = th_current_religious_unity_skill
	#	value = religious_unity
	#	who = ROOT
	#}
	#export_to_variable = {
	#	variable_name = th_current_tolerance_to_the_true_faith_skill
	#	value = modifier:tolerance_own
	#	who = ROOT
	#}
	set_variable = {
		which = th_danmaku_combat_power
		value = roll_power_gain
	}

	#multiply_variable = {
	#	which = th_current_military_skill
	#	value = 100
	#}
	
	#multiply_variable = {
	#	which = th_current_army_tradition_skill
	#	value = 3
	#}
			
	#multiply_variable = {
	#	which = th_current_religious_unity_skill
	#	value = 50
	#}
			
	#multiply_variable = {
	#	which = th_current_tolerance_to_the_true_faith_skill
	#	value = 100
	#}
	
	set_variable = {
		which = th_current_fighting_skills_$type$
		value = 0
	}
	change_variable = {
		which = th_current_fighting_skills_$type$
		which = th_additional_fighting_boni
	}
	#change_variable = {
	#	which = th_current_fighting_skills_$type$
	#	which = th_current_military_skill
	#}
	#change_variable = {
	#	which = th_current_fighting_skills_$type$
	#	which = th_current_army_tradition_skill
	#}
	#change_variable = {
	#	which = th_current_fighting_skills_$type$
	#	which = th_current_religious_unity_skill
	#}
	#change_variable = {
	#	which = th_current_fighting_skills_$type$
	#	which = th_current_tolerance_to_the_true_faith_skill
	#}
	change_variable = {
		which = th_current_fighting_skills_$type$
		which = roll_power_gain
	}
	th_additional_danmaku_buff = {
		fighting_variable = th_current_fighting_skills_$type$
	}
}

th_getruler_diplomatic_skill = {
	#Players Fighting Skills
	set_variable = {
		which = th_current_diplo_skills
		value = $skill_boni$
	}
	export_to_variable = {
		variable_name = th_diplomatic_danmaku_power
		value = modifier:diplomatic_danmaku_power_constant
		who = ROOT
	}
	export_to_variable = {
		variable_name = th_diplomatic_danmaku_power_modifier
		value = modifier:diplomatic_danmaku_power_factor
		who = ROOT
	}
	change_variable = {
		which = th_current_diplo_skills
		which = th_diplomatic_danmaku_power
	}
	######
	# For subject count
	export_to_variable = {
		variable_name = th_current_subjects_skill
		value = trigger_value:num_of_subjects
		who = ROOT
	}
	multiply_variable = {
		which = th_current_subjects_skill
		value = 50
	}
	change_variable = {
		which = th_current_diplo_skills
		which = th_current_subjects_skill
	}
	#Add default buff
	th_additional_danmaku_buff = {
		fighting_variable = th_current_diplo_skills
	}
}

#Is used for danmaku fights through diplomatic action
th_danmaku_set_compare_variable = {
	set_variable = {
		which = th_current_fighting_skills_counter
		which = th_current_fighting_skills_$type$
	}
}

#Supports the following types:
# incident			- used for all incident related fights
# lesser_incident	- used for all smaller incidents related fights
# normal			- used for all the other fights
# diplomatic		- used for diplo fights only
th_defineopponent_fighting_skill = {
	#Draw Zone
	set_variable = {
		which = th_enemy_lower_border_draw_$type$
		value = 0
	}
	set_variable = {
		which = th_enemy_upper_border_draw_$type$
		value = 0
	}
	set_variable = {
		which = th_enemy_lower_border_draw_$type$
		which = $variable$
	}
	set_variable = {
		which = th_enemy_upper_border_draw_$type$
		which = $variable$
	}
			
	change_variable = {
		which = th_enemy_upper_border_draw_$type$
		value = 50
	}
	subtract_variable = {
		which = th_enemy_lower_border_draw_$type$
		value = 50
	}
			
	#Victory Zone
	set_variable = {
		which = th_enemy_border_great_victory_$type$
		value = 0
	}
	set_variable = {
		which = th_enemy_border_great_victory_$type$
		which = th_enemy_upper_border_draw_$type$
	}
			
	change_variable = {
		which = th_enemy_border_great_victory_$type$
		value = 125
	}
			
	#Defeat Zone
	set_variable = {
		which = th_enemy_border_great_defeat_$type$
		value = 0
	}
	set_variable = {
		which = th_enemy_border_great_defeat_$type$
		which = th_enemy_lower_border_draw_$type$
	}
	subtract_variable = {
		which = th_enemy_border_great_defeat_$type$
		value = 125
	}

	#Show Variable
	set_variable = {
		which = th_danmaku_duel_show_variable_$type$
		which = $variable$
	}
}

th_danmaku_incident_fight_ruler_and_opponent = {
	custom_tooltip = th_danmaku_incident_fight_ruler_and_opponent_tt
	#Player is waaaay stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_incident
				which = th_enemy_border_great_victory_incident
			}
			NOT = {
				check_variable = {
					which = th_enemy_upper_border_draw_incident
					which = th_current_fighting_skills_incident
				}
			}
		}
		random_list = {
			60 = {
				country_event = {
					id = th_danmaku_event.3
					days = 1
				}
			}
			40 = {
				country_event = {
					id = th_danmaku_event.2
					days = 1
				}	
			}
		}
	}
	#Player is stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_incident
				which = th_enemy_upper_border_draw_incident
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_incident
					which = th_enemy_border_great_victory_incident
				}
			}
		}
		random_list = {
			75 = {
				country_event = {
					id = th_danmaku_event.3
					days = 1
				}
			}
			15 = {
				country_event = {
					id = th_danmaku_event.2
					days = 1
				}			
			}
			10 = {
				country_event = {
					id = th_danmaku_event.4
					days = 1
				}			
			}
		}
	}
	#Opponent and Player are equal strong
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_incident
				which = th_enemy_lower_border_draw_incident
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_incident
					which = th_enemy_upper_border_draw_incident
				}
			}
		}
		random_list = {
			65 = {
				country_event = {
					id = th_danmaku_event.4
					days = 1
				}
			}
			25 = {
				country_event = {
					id = th_danmaku_event.3
					days = 1
				}			
			}
			10 = {
				country_event = {
					id = th_danmaku_event.5
					days = 1
				}			
			}
		}
	}
	#Opponent is stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_incident
				which = th_enemy_border_great_defeat_incident
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_incident
					which = th_enemy_lower_border_draw_incident
				}
			}
		}
		random_list = {
			20 = {
				country_event = {
					id = th_danmaku_event.6
					days = 1
				}
			}
			60 = {
				country_event = {
					id = th_danmaku_event.5
					days = 1
				}			
			}
			20 = {
				country_event = {
					id = th_danmaku_event.4
					days = 1
				}			
			}
		}
	}
	#Opponent is waaaay stronger
	if = {
		limit = {
			check_variable = {
				which = th_enemy_border_great_defeat_incident
				which = th_current_fighting_skills_incident
			}
		}
		random_list = {
			50 = {
				country_event = {
					id = th_danmaku_event.6
					days = 1
				}
			}
			40 = {
				country_event = {
					id = th_danmaku_event.5
					days = 1
				}			
			}
			10 = {
				country_event = {
					id = th_danmaku_event.4
					days = 1
				}			
			}
		}
	}
}

#Use th_empty_event.1 for win/draw/lose events if you don't have any additional events following the fight
th_danmaku_lesser_incident_fight_ruler_and_opponent = {
	custom_tooltip = th_danmaku_lesser_incident_fight_ruler_and_opponent_tt
	#Player is waaaay stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_lesser_incident
				which = th_enemy_border_great_victory_lesser_incident
			}
			NOT = {
				check_variable = {
					which = th_enemy_upper_border_draw_lesser_incident
					which = th_current_fighting_skills_lesser_incident
				}
			}
		}
		random_list = {
			60 = {
				country_event = {
					id = th_danmaku_event.9
					days = 1
				}
			}
			40 = {
				country_event = {
					id = th_danmaku_event.8
					days = 1
				}	
			}
		}
		hidden_effect = {
			country_event = {
				id = $win_event$
				days = $days$
			}
		}
	}
	#Player is stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_lesser_incident
				which = th_enemy_upper_border_draw_lesser_incident
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_lesser_incident
					which = th_enemy_border_great_victory_lesser_incident
				}
			}
		}
		random_list = {
			75 = {
				country_event = {
					id = th_danmaku_event.9
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}
			}
			15 = {
				country_event = {
					id = th_danmaku_event.8
					days = 1
				}	
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}		
			}
			10 = {
				country_event = {
					id = th_danmaku_event.10
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
	#Opponent and Player are equal strong
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_lesser_incident
				which = th_enemy_lower_border_draw_lesser_incident
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_lesser_incident
					which = th_enemy_upper_border_draw_lesser_incident
				}
			}
		}
		random_list = {
			65 = {
				country_event = {
					id = th_danmaku_event.10
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
			25 = {
				country_event = {
					id = th_danmaku_event.9
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}
			}
			10 = {
				country_event = {
					id = th_danmaku_event.11
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}	
			}
		}
	}
	#Opponent is stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_lesser_incident
				which = th_enemy_border_great_defeat_lesser_incident
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_lesser_incident
					which = th_enemy_lower_border_draw_lesser_incident
				}
			}
		}
		random_list = {
			20 = {
				country_event = {
					id = th_danmaku_event.12
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}	
			}
			60 = {
				country_event = {
					id = th_danmaku_event.11
					days = 1
				}	
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}			
			}
			20 = {
				country_event = {
					id = th_danmaku_event.10
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
	#Opponent is waaaay stronger
	if = {
		limit = {
			check_variable = {
				which = th_enemy_border_great_defeat_lesser_incident
				which = th_current_fighting_skills_lesser_incident
			}
		}
		random_list = {
			50 = {
				country_event = {
					id = th_danmaku_event.12
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}	
			}
			40 = {
				country_event = {
					id = th_danmaku_event.11
					days = 1
				}	
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}			
			}
			10 = {
				country_event = {
					id = th_danmaku_event.10
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
}

#Use th_empty_event.1 for win/draw/lose events if you don't have any additional events following the fight
th_danmaku_normal_fight_ruler_and_opponent = {
	custom_tooltip = th_danmaku_normal_fight_ruler_and_opponent_tt
	#Player is waaaay stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_normal
				which = th_enemy_border_great_victory_normal
			}
			NOT = {
				check_variable = {
					which = th_enemy_upper_border_draw_normal
					which = th_current_fighting_skills_normal
				}
			}
		}
		random_list = {
			60 = {
				country_event = {
					id = th_danmaku_event.9
					days = 1
				}
			}
			40 = {
				country_event = {
					id = th_danmaku_event.8
					days = 1
				}	
			}
		}
		hidden_effect = {
			country_event = {
				id = $win_event$
				days = $days$
			}
		}
	}
	#Player is stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_normal
				which = th_enemy_upper_border_draw_normal
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_normal
					which = th_enemy_border_great_victory_normal
				}
			}
		}
		random_list = {
			75 = {
				country_event = {
					id = th_danmaku_event.9
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}
			}
			15 = {
				country_event = {
					id = th_danmaku_event.8
					days = 1
				}	
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}		
			}
			10 = {
				country_event = {
					id = th_danmaku_event.10
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
	#Opponent and Player are equal strong
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_normal
				which = th_enemy_lower_border_draw_normal
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_normal
					which = th_enemy_upper_border_draw_normal
				}
			}
		}
		random_list = {
			65 = {
				country_event = {
					id = th_danmaku_event.10
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
			25 = {
				country_event = {
					id = th_danmaku_event.9
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}
			}
			10 = {
				country_event = {
					id = th_danmaku_event.11
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}	
			}
		}
	}
	#Opponent is stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_fighting_skills_normal
				which = th_enemy_border_great_defeat_normal
			}
			NOT = {
				check_variable = {
					which = th_current_fighting_skills_normal
					which = th_enemy_lower_border_draw_normal
				}
			}
		}
		random_list = {
			20 = {
				country_event = {
					id = th_danmaku_event.12
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}	
			}
			60 = {
				country_event = {
					id = th_danmaku_event.11
					days = 1
				}	
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}			
			}
			20 = {
				country_event = {
					id = th_danmaku_event.10
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
	#Opponent is waaaay stronger
	if = {
		limit = {
			check_variable = {
				which = th_enemy_border_great_defeat_normal
				which = th_current_fighting_skills_normal
			}
		}
		random_list = {
			50 = {
				country_event = {
					id = th_danmaku_event.12
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}	
			}
			40 = {
				country_event = {
					id = th_danmaku_event.11
					days = 1
				}	
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}			
			}
			10 = {
				country_event = {
					id = th_danmaku_event.10
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
}

th_danmaku_diplo_fight_ruler_and_opponent = {
	custom_tooltip = th_danmaku_diplo_fight_ruler_and_opponent_tt
	#Player is waaaay stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_diplo_skills
				which = th_enemy_border_great_victory_normal
			}
			NOT = {
				check_variable = {
					which = th_enemy_upper_border_draw_normal
					which = th_current_diplo_skills
				}
			}
		}
		random_list = {
			60 = {
				country_event = {
					id = th_danmaku_event.22
					days = 1
				}
			}
			40 = {
				country_event = {
					id = th_danmaku_event.21
					days = 1
				}	
			}
		}
		hidden_effect = {
			country_event = {
				id = $win_event$
				days = $days$
			}
		}
	}
	#Player is stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_diplo_skills
				which = th_enemy_upper_border_draw_normal
			}
			NOT = {
				check_variable = {
					which = th_current_diplo_skills
					which = th_enemy_border_great_victory_normal
				}
			}
		}
		random_list = {
			75 = {
				country_event = {
					id = th_danmaku_event.22
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}
			}
			15 = {
				country_event = {
					id = th_danmaku_event.21
					days = 1
				}			
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}
			}
			10 = {
				country_event = {
					id = th_danmaku_event.23
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
	#Opponent and Player are equal strong
	if = {
		limit = {
			check_variable = {
				which = th_current_diplo_skills
				which = th_enemy_lower_border_draw_normal
			}
			NOT = {
				check_variable = {
					which = th_current_diplo_skills
					which = th_enemy_upper_border_draw_normal
				}
			}
		}
		random_list = {
			65 = {
				country_event = {
					id = th_danmaku_event.23
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
			25 = {
				country_event = {
					id = th_danmaku_event.22
					days = 1
				}			
				hidden_effect = {
					country_event = {
						id = $win_event$
						days = $days$
					}
				}
			}
			10 = {
				country_event = {
					id = th_danmaku_event.24
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}
			}
		}
	}
	#Opponent is stronger
	if = {
		limit = {
			check_variable = {
				which = th_current_diplo_skills
				which = th_enemy_border_great_defeat_normal
			}
			NOT = {
				check_variable = {
					which = th_enemy_lower_border_draw_normal
					which = th_enemy_border_great_defeat_normal
				}
			}
		}
		random_list = {
			20 = {
				country_event = {
					id = th_danmaku_event.25
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}
			}
			60 = {
				country_event = {
					id = th_danmaku_event.24
					days = 1
				}		
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}	
			}
			20 = {
				country_event = {
					id = th_danmaku_event.23
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
	#Opponent is waaaay stronger
	if = {
		limit = {
			check_variable = {
				which = th_enemy_border_great_defeat_normal
				which = th_current_diplo_skills
			}
		}
		random_list = {
			50 = {
				country_event = {
					id = th_danmaku_event.25
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}
			}
			40 = {
				country_event = {
					id = th_danmaku_event.24
					days = 1
				}	
				hidden_effect = {
					country_event = {
						id = $defeat_event$
						days = $days$
					}
				}		
			}
			10 = {
				country_event = {
					id = th_danmaku_event.23
					days = 1
				}
				hidden_effect = {
					country_event = {
						id = $draw_event$
						days = $days$
					}
				}
			}
		}
	}
}

#Increases the counter for the danmaku fights the country has won
th_danmaku_won_a_danmaku_fight = {
	hidden_effect = {
		if = {
			limit = { has_country_flag = th_danmaku_counts_won_danmaku_fights }
			change_variable = {
				which = th_danmaku_won_danmaku_fights
				value = 1
			}
		}
		else = {
			set_country_flag = th_danmaku_counts_won_danmaku_fights
			set_variable = {
				which = th_danmaku_won_danmaku_fights
				value = 1
			}
		}
	}
}