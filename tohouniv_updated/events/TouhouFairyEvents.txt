namespace = fairy_events

#Initialize the variables for Fairy nations
country_event = {
    id = fairy_events.1
    title = fairy_events.1.t
    desc = fairy_events.1.desc
    picture = CIRNO_eventPicture

    trigger = {
        has_government_attribute = fairy_respawn_mechanic
        NOT = { has_country_flag = th_has_initialized_fairy_stats }
        has_ruler_flag = touhou_original_ruler
        is_lesser_in_union = no
    }

    mean_time_to_happen = { 
        days = 1
    }

    hidden = yes

    immediate = {
        set_country_flag = th_has_initialized_fairy_stats
        export_to_variable = {
            variable_name = th_fairy_adm_stat
            value = ADM
            who = ROOT
        }
        export_to_variable = {
            variable_name = th_fairy_dip_stat
            value = DIP
            who = ROOT
        }
        export_to_variable = {
            variable_name = th_fairy_mil_stat
            value = MIL
            who = ROOT
        }
        if = {
            limit = {
                has_heir = yes
                has_heir_flag = touhou_original_heir
            }
            export_to_variable = {
                variable_name = th_fairy_heir_adm_stat
                value = heir_adm
                who = ROOT
            }
            export_to_variable = {
                variable_name = th_fairy_heir_dip_stat
                value = heir_dip
                who = ROOT
            }
            export_to_variable = {
                variable_name = th_fairy_heir_mil_stat
                value = heir_mil
                who = ROOT
            }
        }
    }

    option = {
        name = fairy_events.1.a
        set_variable = {
            which = th_fairy_total_power
            value = 0
        }
        change_variable = {
            which = th_fairy_total_power
            which = th_fairy_adm_stat
        }
        change_variable = {
            which = th_fairy_total_power
            which = th_fairy_dip_stat
        }
        change_variable = {
            which = th_fairy_total_power
            which = th_fairy_mil_stat
        }
        if = {
            limit = {
                has_heir = yes
                has_heir_flag = touhou_original_heir
            }
            set_variable = {
                which = th_fairy_heir_total_power
                value = 0
            }
            change_variable = {
                which = th_fairy_heir_total_power
                which = th_fairy_heir_adm_stat
            }
            change_variable = {
                which = th_fairy_heir_total_power
                which = th_fairy_heir_dip_stat
            }
            change_variable = {
                which = th_fairy_heir_total_power
                which = th_fairy_heir_mil_stat
            }
        }
        
        ai_chance = {
            factor = 100
        }
    }
}

#Respawn Fairy
country_event = {
    id = fairy_events.2
    title = fairy_events.2.t
    desc = fairy_events.2.desc
    picture = CIRNO_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            set_country_flag = th_has_respawning_event
            clr_country_flag = th_fairy_respawned_ruler_recently
        }
    }

    option = {
        name = fairy_events.2.a
        th_respawn_fairy_ruler_effect = yes
        
        ai_chance = {
            factor = 100
        }
    }

    after = {
        hidden_effect = {
            clr_country_flag = th_has_respawning_event
            set_country_flag = th_fairy_respawned_ruler_recently
        }
    }
}

#Respawn Fairy Heir
country_event = {
    id = fairy_events.3
    title = fairy_events.3.t
    desc = fairy_events.3.desc
    picture = CIRNO_eventPicture
    
    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            set_country_flag = th_has_respawning_event
            clr_country_flag = th_fairy_respawned_heir_recently
        }
    }

    option = {
        name = fairy_events.3.a
        th_respawn_fairy_heir_effect = yes
        
        ai_chance = {
            factor = 100
        }
    }

    after = {
        hidden_effect = {
            clr_country_flag = th_has_respawning_event
            set_country_flag = th_fairy_respawned_heir_recently
        }
    }
}