########################################
# Incident Events
########################################

namespace = th_incidents_scarletmists

#Scarlet Mist Incident - 1.Check any possible investigator country	- HIDDEN
country_event = {
	id = th_incidents_scarletmists.1
	title = "th_incidents_scarletmists.1.t"
	desc = "th_incidents_scarletmists.1.desc"
	picture = REMILIAVICTORY_eventPicture

	trigger = {
		if = {
			limit = {
				has_global_flag = th_random_incident_active
			}
			has_global_flag = th_picked_rng_incident_sdm
		}
		else = {
			is_year = 1450
		}
		NOT = { has_global_flag = th_active_incident }
		NOT = { has_global_flag = th_scarlet_mists_incident_solved }
		NOT = { has_global_flag = th_deactivated_incidents }
		OR = {
			NOT = { has_global_flag = th_recently_solved_incident_flag }
			had_global_flag = { flag = th_recently_solved_incident_flag days = 1825 }
		}
		capital_scope = {
			superregion = gensokyo_superregion
		}
	}
	
	fire_only_once = yes
	hidden = yes	
	
	mean_time_to_happen = {
		months = 12

		modifier = {
			factor = 0.8
			OR = {
				exists = SCR
				exists = SCD
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				SCR = {
					is_at_war = yes
				}
				SCD = {
					is_at_war = yes
				}
			}
		}
	}

	immediate = {
		if = {
			limit = {
				exists = SCR
			}
			SCR = {
				th_incident_forbids_to_become_investigator = yes
			}
		}
		if = {
			limit = {
				exists = SCD
			}
			SCD = {
				th_incident_forbids_to_become_investigator = yes
			}
		}
		if = {
			limit = {
				exists = CIN
			}
			CIN = {
				th_incident_forbids_to_become_investigator = yes
			}
		}
		if = {
			limit = {
				exists = FLR
			}
			FLR = {
				th_incident_forbids_to_become_investigator = yes
			}
		}
		if = {
			limit = {
				exists = HNG
			}
			HNG = {
				th_incident_forbids_to_become_investigator = yes
			}
		}
		every_known_country = {
			limit = {
				OR = {
					was_tag = SCR
					was_tag = SCD
					was_tag = CIN
					was_tag = FLR
					was_tag = HNG
				}
				NOT = { tag = SCR }
				NOT = { tag = SCD }
				NOT = { tag = CIN }
				NOT = { tag = FLR }
				NOT = { tag = HNG }
			}
			th_incident_forbids_to_become_investigator = yes
		}
		set_global_flag = th_SDM_inci_setup_flag
	}

	option = {		#Check any possible investigator country
		name = "th_incidents_scarletmists.1.a"
		th_incident_search_for_eligible_investigator = yes
		ai_chance = { 
			factor = 100
		}
	}

	after = {
		if = {
			limit = {
				has_global_flag = th_biased_incident_active
			}
			th_incident_pick_random_player_for_biased_investigator = yes
		}
	}
}

#Scarlet Mist Incident - 2.Incident starts,add debuffs	- HIDDEN
country_event = {
	id = th_incidents_scarletmists.200
	title = "th_incidents_scarletmists.200.t"
	desc = "th_incidents_scarletmists.200.desc"
	picture = REMILIAVICTORY_eventPicture

	trigger = {
		th_incident_can_become_investigator = yes
		has_global_flag = th_SDM_inci_setup_flag
	}

	fire_only_once = yes
	hidden = yes	

	immediate = {
		hidden_effect = {
			th_incident_set_terminate_flag = yes
			gensokyo_superregion = {
				limit = {
					owner = {
						NOT = { tag = SCR }
						NOT = { tag = SCD }
						NOT = { was_tag = SCR }
						NOT = { was_tag = SCD }
						NOT = { is_subject_of = SCR }
						NOT = { is_subject_of = SCD }
					}
					NOT = { has_province_modifier = th_plagued_by_the_scarlet_mist }
				}
				add_province_modifier = { 
					name = th_plagued_by_the_scarlet_mist
					duration = -1  
					desc = th_incident_duration_tt
				}
			}
			random_province = {
				limit = {
					superregion = gensokyo_superregion
					owner = {
						NOT = { tag = SCR }
						NOT = { tag = SCD }
						NOT = { was_tag = SCR }
						NOT = { was_tag = SCD }
						NOT = { is_subject_of = SCR }
						NOT = { is_subject_of = SCD }
					}
					NOT = { has_province_modifier = th_plagued_by_the_scarlet_mist }
				}
				add_province_modifier = { 
					name = th_plagued_by_the_scarlet_mist
					duration = -1  
					desc = th_incident_duration_tt
				}
			}
			clr_global_flag = th_SDM_inci_setup_flag
			set_global_flag = th_active_incident
			clr_global_flag = th_incident_cleaned_all_flags
			set_global_flag = th_current_incident_scarlet_mists
			set_global_flag = th_SDM_inci_started
		}
	}

	mean_time_to_happen = {
		days = 30

		modifier = {
			factor = 0.1
			tag = HKR
		}
	}

	option = {		#Set the first investigator
		name = "th_incidents_scarletmists.200.a"
		custom_tooltip = th_incidents_scarletmists_200.a.tt
		country_event = {
			id = th_incidents_scarletmists.300
			days = 0
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Scarlet Mist Incident - 3.Set an investigator(use whenever there is need)	- HIDDEN
country_event = {
	id = th_incidents_scarletmists.300
	title = "th_incidents_scarletmists.300.t"
	desc = "th_incidents_scarletmists.300.desc"
	picture = REMILIAVICTORY_eventPicture

	is_triggered_only = yes
	hidden = yes

	option = {		#find an investigator
		name = "th_incidents_scarletmists.300.a"
		
		th_incident_setup_investigator = yes
		th_incident_introduction_event = {
			introduction_event = th_incidents_scarletmists.400
		}

		ai_chance = { 
			factor = 100
		}
	}
}

#Scarlet Mist Incident - 4.Introduction of incident
country_event = {
	id = th_incidents_scarletmists.400
	title = "th_incidents_scarletmists.400.t"
	desc = {
		trigger = {
			OR = {
				tag = SCR
				was_tag = SCR
				tag = SCD
				was_tag = SCD
			}
		}
		desc = "th_incidents_scarletmists.400.desc.1"
	}
	desc = {
		trigger = { 
			NOT = { tag = SCR }
			NOT = {	was_tag = SCR }
			NOT = { tag = SCD }
			NOT = {	was_tag = SCD }
		}
		desc = "th_incidents_scarletmists.400.desc.2"
	}
	picture = REMILIAVICTORY_eventPicture

	is_triggered_only = yes	

	option = {		#We should investigate this mysterious scarlet mist.
		name = "th_incidents_scarletmists.400.a"
		trigger = {
			th_incident_is_investigator = yes
		}
 		custom_tooltip = th_incidents_scarletmists.400.a.tt
		highlight = yes	
		add_adm_power = -25
		hidden_effect = {
			set_variable = {
				which = th_SDM_inci_goodbad_level
				value = 0
			}
			set_country_flag = th_SDM_inci_about_to_beat_rumia
			if = {
				limit = {
					NOT = { has_country_flag = th_incident_had_info }
				}
				country_event = {
					id = th_danmaku_event.1
					days = 1
				}
			}
		}

		ai_chance = {
			factor = 100
		}
	}
	
	option = {		#I don`t want to investigate the incident.For minor character who was chosen the first investigator
		name = "th_incidents_scarletmists.400.b"
		trigger = {
			th_incident_is_investigator = yes
			th_is_not_major_main_character = yes
			th_is_not_minor_main_character = yes
			any_known_country = {	#must have another eligible investigator country
				exists = yes
				th_incident_can_become_investigator = yes
			}
		}
		custom_tooltip = th_incidents_scarletmists.400.b.tt
		add_prestige = -25
		hidden_effect = {
			th_incident_clr_investigator = yes
			random_known_country = {	
				limit = {
					exists = yes
					th_incident_can_become_investigator = yes
				}	
				add_adm_power = -25
				th_incident_set_country_to_new_investigator = yes
			}
		}		
		ai_chance = {
			factor = 0
		}
	}
	
	option = {		#I shall be the first investigator!For main character player who was not chosen the first investigator
		name = "th_incidents_scarletmists.400.c"
		trigger = {
			th_incident_is_not_investigator = yes
			OR = {
				tag = HKR
				tag = FOM
				tag = MRY
				AND = {
					th_incident_is_biasedly_picked_investigator = yes
					ai = no
				}
			}
			th_incident_can_become_investigator = yes
		}
 		custom_tooltip = th_incidents_scarletmists.400.c.tt
		highlight = yes			
		add_adm_power = -25
		hidden_effect = {
			every_known_country = {
				limit = {
					th_incident_is_investigator = yes
				}
				th_incident_clr_investigator = yes
			}
			th_incident_set_country_to_new_investigator = yes
		}

		ai_chance = {
			factor = 0
		}
	}
	
	option = {		#Well, let it be.
		name = "th_incidents_scarletmists.400.d"	
		trigger = {
			th_incident_is_not_investigator = yes
			NOT = { tag = SCR }
			NOT = { tag = SCD }
			NOT = { was_tag = SCR }
			NOT = { was_tag = SCD  }
		}	
		custom_tooltip = th_incidents_scarletmists.400.d.tt

		ai_chance = {
			factor = 100
		}	
	}

	option = {		#Let the games begin!
		name = "th_incidents_scarletmists.400.e"
		trigger = {
			OR = {
				tag = SCR
				was_tag = SCR
				tag = SCD
				was_tag = SCD
			}
		}	
		custom_tooltip = th_incidents_scarletmists.400.e.tt
		highlight = yes	
		add_army_tradition = 15
		add_navy_tradition = 15
		add_treasury = 200

		ai_chance = {
			factor = 100
		}
	}
}


#Scarlet Mist Incident - Rumia Encounter
country_event = {
	id = th_incidents_scarletmists.2
	title = "th_incidents_scarletmists.2.t"
	desc = "th_incidents_scarletmists.2.desc"
	picture = RUMIA_eventPicture
	
	trigger = {
		had_country_flag = {
			flag = th_SDM_inci_about_to_beat_rumia
			days = 1095
		}
		th_incident_is_investigator = yes
		NOT = { has_global_flag = th_SDM_inci_rumia_encountered }
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			th_getruler_fighting_skill = {
				SKILL_BONI = 0
			}
			set_global_flag = th_SDM_inci_rumia_encountered
			clr_global_flag = th_SDM_inci_started
			clr_country_flag = th_SDM_inci_about_to_beat_rumia
			#Rumias Base Fighting Skills
			set_variable = {
				which = th_SDM_inci_rumias_combat_skills
				value = 950
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_SDM_inci_rumias_combat_skills
			}
		}
	}

	after = {
		if = {
			limit = {
				th_incident_is_investigator = yes
			}
			set_country_flag = th_SDM_inci_about_to_beat_cirno
		}
	}
	
	option = {		#She's in my way! I will have to fight her!
		name = "th_incidents_scarletmists.2.a"
		custom_tooltip = th_incidents_scarletmists.2.a.tt
		highlight = yes
		th_danmaku_incident_fight_ruler_and_opponent = yes
		
		ai_chance = { 
			factor = 40 
			modifier = {
				factor = 100
				th_winnable_fight_trigger = yes
			}
			modifier = {
				factor = 0
				th_unwinnable_fight_trigger = yes
			}
		}
	}
	
	option = {		#Well... nobody will be mad, if there are some fairies missing.
		name = "th_incidents_scarletmists.2.b"
		custom_tooltip = th_incidents_scarletmists.2.b.tt
		add_yearly_manpower = -0.5
		hidden_effect = {
			every_known_country = {
				limit = {
					any_owned_province = {
						range = ROOT
					}
				}
				add_opinion = {
					modifier = th_fed_fairies_to_rumia
					who = ROOT
				}
			}
		}
		th_incident_cruel_decision = yes
		th_incident_victory_bonus = yes	
		
		ai_chance = { 
			factor = 20 
			modifier = {
				factor = 100
				OR = {
					ruler_has_personality = malevolent_personality
					ruler_has_personality = cruel_personality
				}
			}
			modifier = {
				factor = 0
				ruler_has_personality = kind_hearted_personality
			}
		}
	}
	
	option = {		#My allies could deal with her.
		name = "th_incidents_scarletmists.2.c"
		custom_tooltip = th_incidents_scarletmists.2.c.tt
		trigger = {
			num_of_allies = 1
		}
		random_ally = {
			country_event = {
				id = th_incidents_scarletmists.13
			}
		}
		th_incident_minor_victory_bonus = yes
		
		ai_chance = { 
			factor = 20 
			modifier = {
				factor = 100
				any_ally = {
					trust = {
						who = ROOT
						value = 60
					}
				} 
			}
		}
	}
	
	option = {		#She's just a nuisance.
		name = "th_incidents_scarletmists.2.d"
		custom_tooltip = th_incidents_scarletmists.2.d.tt
		add_prestige = -5
		th_incident_minor_defeat_bonus = yes
		
		ai_chance = { 
			factor = 20
		}
	}
}

#Scarlet Mist Incident - Cirno Encounter
country_event = {
	id = th_incidents_scarletmists.3
	title = "th_incidents_scarletmists.3.t"
	desc = "th_incidents_scarletmists.3.desc"
	picture = CIRNO_eventPicture
	
	trigger = {
		had_country_flag = {
			flag = th_SDM_inci_about_to_beat_cirno
			days = 1095
		}
		th_incident_is_investigator = yes
		NOT = { has_global_flag = th_SDM_inci_cirno_encountered }
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			th_getruler_fighting_skill = {
				SKILL_BONI = 0
			}
			set_global_flag = th_SDM_inci_cirno_encountered
			clr_global_flag = th_SDM_inci_rumia_encountered
			clr_country_flag = th_SDM_inci_about_to_beat_cirno
			#Cirno's Base Fighting Skills
			set_variable = {
				which = th_SDM_inci_cirnos_combat_skills
				value = 999
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_SDM_inci_cirnos_combat_skills
			}	
		}
	}

	after = {
		if = {
			limit = {
				th_incident_is_investigator = yes
			}
			set_country_flag = th_SDM_inci_about_to_beat_meiling
		}
	}
	
	option = {		#Another target. Great, I'll got bored on this lake.
		name = "th_incidents_scarletmists.3.a"
		custom_tooltip = th_incidents_scarletmists.3.a.tt
		highlight = yes
		th_danmaku_incident_fight_ruler_and_opponent = yes
		
		ai_chance = { 
			factor = 40 
			modifier = {
				factor = 100
				th_winnable_fight_trigger = yes
			}
			modifier = {
				factor = 0
				th_unwinnable_fight_trigger = yes
			}
		}
	}
	
	option = {		#I don't have the time for this. Annoy someone else.
		name = "th_incidents_scarletmists.3.b"
		custom_tooltip = th_incidents_scarletmists.3.b.tt
		add_prestige = -5
		add_country_modifier = {
			name = th_SDM_inci_unchecked_cirno_rampage
			duration = 1825
		}
		th_incident_minor_victory_bonus = yes
		
		ai_chance = { 
			factor = 15
		}
	}
	
	option = {		#Cirno, go back to your realm.
		name = "th_incidents_scarletmists.3.c"
		trigger = {
			exists = CIN
			CIN = {
				is_subject_of = ROOT
			}
		}
		custom_tooltip = th_incidents_scarletmists.3.c.tt
		add_prestige = 25
		th_incident_major_victory_bonus = yes
		
		ai_chance = { 
			factor = 100
		}
	}
	
	option = {		#Allright, frost brain, look...
		name = "th_incidents_scarletmists.3.d"
		trigger = {
			adm = 3
			dip = 3
		}
		custom_tooltip = th_incidents_scarletmists.3.d.tt
		add_dip_power = -75
		random_list = {
			75 = {
				custom_tooltip = th_incidents_scarletmists.3.d.success
				add_prestige = 10
				th_incident_victory_bonus = yes
			}
			25 = {
				custom_tooltip = th_incidents_scarletmists.3.d.fail
				add_prestige = -5
				th_incident_minor_defeat_bonus = yes
			}
		}
		
		ai_chance = { 
			factor = 30
		}
	}
	
	option = {		#I will shake Cirno off in the fog
		name = "th_incidents_scarletmists.3.e"
		custom_tooltip = th_incidents_scarletmists.3.e.tt
		add_adm_power = 125
		th_incident_defeat_bonus = yes
		
		ai_chance = { 
			factor = 15
		}
	}
}

#Scarlet Mist Incident - Meiling Encounter
country_event = {
	id = th_incidents_scarletmists.4
	title = "th_incidents_scarletmists.4.t"
	desc = "th_incidents_scarletmists.4.desc"
	picture = MEILINGBOSS_eventPicture
	
	trigger = {
		had_country_flag = {
			flag = th_SDM_inci_about_to_beat_meiling
			days = 1095
		}
		th_incident_is_investigator = yes
		NOT = { has_global_flag = th_SDM_inci_meiling_encountered }
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			th_getruler_fighting_skill = {
				SKILL_BONI = 0
			}
			set_global_flag = th_SDM_inci_meiling_encountered
			clr_global_flag = th_SDM_inci_cirno_encountered
			clr_country_flag = th_SDM_inci_about_to_beat_meiling
			#Meiling's Base Fighting Skills
			set_variable = {
				which = th_SDM_inci_meilings_combat_skills
				value = 1125
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_SDM_inci_meilings_combat_skills
			}	
		}
	}

	after = {
		if = {
			limit = {
				th_incident_is_investigator = yes
			}
			set_country_flag = th_SDM_inci_about_to_beat_patchouli
		}
	}
	
	option = {		#A gatekeeper? Well, I want to know what is behind this gate.
		name = "th_incidents_scarletmists.4.a"
		custom_tooltip = th_incidents_scarletmists.4.a.tt
		highlight = yes
		th_danmaku_incident_fight_ruler_and_opponent = yes
		
		ai_chance = { 
			factor = 75 
			modifier = {
				factor = 100
				th_winnable_fight_trigger = yes
			}
			modifier = {
				factor = 0
				th_unwinnable_fight_trigger = yes
			}
		}
	}
	
	option = {		#At the wish of the Celestial Emperor, I demand to let me pass!
		name = "th_incidents_scarletmists.4.d"
		custom_tooltip = th_incidents_scarletmists.4.d.tt
		trigger = {
			OR = {
				is_emperor_of_china = yes 
				AND = {
					is_subject_of_type = tributary_state
					overlord = {
						is_emperor_of_china = yes
					}
				}
			}
		}
		add_prestige = 25
		th_incident_major_victory_bonus = yes
		
		ai_chance = { 
			factor = 100
		}
	}
	
	option = {		#I could sneak past her
		name = "th_incidents_scarletmists.4.e"
		custom_tooltip = th_incidents_scarletmists.4.e.tt
		add_adm_power = 25
		add_prestige = -25
		th_incident_defeat_bonus = yes
		
		ai_chance = { 
			factor = 25
			modifier = {
				factor = 0
				th_winnable_fight_trigger = yes
			}
			modifier = {
				factor = 100
				th_unwinnable_fight_trigger = yes
			}
		}
	}
}

#Scarlet Mist Incident - Patchoulis Encounter
country_event = {
	id = th_incidents_scarletmists.5
	title = "th_incidents_scarletmists.5.t"
	desc = "th_incidents_scarletmists.5.desc"
	picture = PATCHOULI_eventPicture
	
	trigger = {
		had_country_flag = {
			flag = th_SDM_inci_about_to_beat_patchouli
			days = 1095
		}
		th_incident_is_investigator = yes
		NOT = { has_global_flag = th_SDM_inci_patchouli_encountered }
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			th_getruler_fighting_skill = {
				SKILL_BONI = 0
			}
			set_global_flag = th_SDM_inci_patchouli_encountered
			clr_global_flag = th_SDM_inci_meiling_encountered
			clr_country_flag = th_SDM_inci_about_to_beat_patchouli
			#Patchouli's Base Fighting Skills
			set_variable = {
				which = th_SDM_inci_patchoulis_combat_skills
				value = 1250
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_SDM_inci_patchoulis_combat_skills
			}	
		}
	}

	after = {
		if = {
			limit = {
				th_incident_is_investigator = yes
			}
			set_country_flag = th_SDM_inci_about_to_beat_sakuya
		}
	}
	
	option = {		#Too bad for her, because I've got to fight her to pass the library
		name = "th_incidents_scarletmists.5.a"
		custom_tooltip = th_incidents_scarletmists.5.a.tt
		highlight = yes
		th_danmaku_incident_fight_ruler_and_opponent = yes
		
		ai_chance = { 
			factor = 75 
			modifier = {
				factor = 100
				th_winnable_fight_trigger = yes
			}
			modifier = {
				factor = 0
				th_unwinnable_fight_trigger = yes
			}
		}
	}
	
	option = {		#Soo... she just wants to study? Maybe Rinnosuke has some books left over...
		name = "th_incidents_scarletmists.5.b"
		custom_tooltip = th_incidents_scarletmists.5.b.tt
		add_adm_power = -50
		add_years_of_income = -0.5
		th_incident_minor_victory_bonus = yes
		
		ai_chance = { 
			factor = 25
			modifier = {
				factor = 0
				th_winnable_fight_trigger = yes
			}
			modifier = {
				factor = 100
				th_unwinnable_fight_trigger = yes
			}
		}
	}
	
	option = {		#In Marisa's home are surely some books left. Maybe she is willing to bring them back.
		name = "th_incidents_scarletmists.5.c"
		trigger = {
			OR = {
				AND = {
					alliance_with = FOM
					reverse_has_opinion = {
						who = FOM
						value = 150
					}
				}
				FOM = {
					is_subject_of = ROOT
				}
				tag = FOM
			}
		}
		custom_tooltip = th_incidents_scarletmists.5.c.tt
		add_adm_power = -50
		th_incident_victory_bonus = yes
		
		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0
				th_winnable_fight_trigger = yes
			}
		}
	}
}

#Scarlet Mist Incident - Sakuya Encounter
country_event = {
	id = th_incidents_scarletmists.6
	title = "th_incidents_scarletmists.6.t"
	desc = "th_incidents_scarletmists.6.desc"
	picture = SAKUYA_eventPicture
	
	trigger = {
		had_country_flag = {
			flag = th_SDM_inci_about_to_beat_sakuya
			days = 1095
		}
		th_incident_is_investigator = yes
		NOT = { has_global_flag = th_SDM_inci_sakuya_encountered }
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			th_getruler_fighting_skill = {
				SKILL_BONI = 0
			}
			set_global_flag = th_SDM_inci_sakuya_encountered
			clr_global_flag = th_SDM_inci_patchouli_encountered
			clr_country_flag = th_SDM_inci_about_to_beat_sakuya
			#Sakuya's Base Fighting Skills
			set_variable = {
				which = th_SDM_inci_sakuyas_combat_skills
				value = 1400
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_SDM_inci_sakuyas_combat_skills
			}	
		}
	}

	after = {
		if = {
			limit = {
				th_incident_is_investigator = yes
			}
			set_country_flag = th_SDM_inci_about_to_beat_remilia
		}
	}
	
	option = {		#I don't think she will let me through. I will have to defeat her.
		name = "th_incidents_scarletmists.6.a"
		custom_tooltip = th_incidents_scarletmists.6.a.tt
		highlight = yes
		th_danmaku_incident_fight_ruler_and_opponent = yes
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Scarlet Mist Incident - Remilia Encounter
country_event = {
	id = th_incidents_scarletmists.7
	title = "th_incidents_scarletmists.7.t"
	desc = "th_incidents_scarletmists.7.desc"
	picture = REMILIA_eventPicture
	
	trigger = {
		had_country_flag = {
			flag = th_SDM_inci_about_to_beat_remilia
			days = 1095
		}
		th_incident_is_investigator = yes
		NOT = { has_global_flag = th_SDM_inci_remilia_encountered }
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			th_getruler_fighting_skill = {
				SKILL_BONI = 0
			}
			set_global_flag = th_SDM_inci_remilia_encountered
			clr_global_flag = th_SDM_inci_sakuya_encountered
			clr_country_flag = th_SDM_inci_about_to_beat_remilia
			#Remilia's Base Fighting Skills
			set_variable = {
				which = th_SDM_inci_remilias_combat_skills
				value = 1500
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_SDM_inci_remilias_combat_skills
			}	
		}
	}

	after = {
		set_country_flag = th_SDM_inci_about_to_get_final
	}
	
	option = {		#I will have to defeat her myself
		name = "th_incidents_scarletmists.7.a"
		custom_tooltip = th_incidents_scarletmists.7.a.tt
		highlight = yes
		th_danmaku_incident_fight_ruler_and_opponent = yes
		hidden_effect = {
			if = {
				limit = {
					th_incident_is_investigator = yes
				}
				set_global_flag = th_SDM_incident_end
			}
		}
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Scarlet Mist Incident EXTRA - Flandre Encounter
country_event = {
	id = th_incidents_scarletmists.8
	title = "th_incidents_scarletmists.8.t"
	desc = "th_incidents_scarletmists.8.desc"
	picture = FLANDRE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			th_getruler_fighting_skill = {
				SKILL_BONI = 0
			}
			#Flandre's Base Fighting Skills
			set_variable = {
				which = th_SDM_inci_flandres_combat_skills
				value = 1600
			}
			th_defineopponent_fighting_skill = {
				VARIABLE = th_SDM_inci_flandres_combat_skills
			}	
		}
	}
	
	option = {		#She really wants to play danmaku...
		name = "th_incidents_scarletmists.8.a"
		custom_tooltip = th_incidents_scarletmists.8.a.tt
		highlight = yes
		th_danmaku_incident_fight_ruler_and_opponent = yes
		hidden_effect = {
			country_event = {
				id = th_incidents_scarletmists.12
				days = 90
			}
		}
		
		ai_chance = { 
			factor = 100
		}
	}
}



#Scarlet Mist Incident - Terrible Outcome because of dead ruler!
country_event = { #Nothing changes and Scarlett Realm Mists grow
	id = th_incidents_scarletmists.16
	title = "th_incidents_scarletmists.16.t"
	desc = "th_incidents_scarletmists.16.desc"
	picture = REMILIAVICTORY_eventPicture
	
	trigger = {
		has_global_flag = th_SDM_incident_end
		has_country_flag = th_incident_last_fight_terribly_lost
		th_incident_is_investigator = yes
		NOT = { has_global_flag = th_scarlet_mists_incident_solved }
		NOT = { has_country_flag = th_just_finished_danmaku_fight }
	}
	
	immediate = {
		hidden_effect = {
			th_incident_clr_terminate_flag = yes
			set_global_flag = th_scarlet_mists_incident_solved
			clr_global_flag = th_active_incident
		}
	}
	
	mean_time_to_happen = {
		months = 12
	}
	major = yes
	
	option = {		#Well, I've done what I could.
		name = "th_incidents_scarletmists.16.a"
		custom_tooltip = th_incidents_scarletmists.16.a.tt
		if = {
			limit = {
				exists = SCD
			}
			SCD = {
				add_country_modifier = {
					name = "th_SDM_inci_mist_spreading"
					duration = 1825
				}
			}
		}
		else_if = {
			limit = {
				exists = SCR
			}
			SCR = {
				add_country_modifier = {
					name = "th_SDM_inci_mist_spreading"
					duration = 1825
				}
			}
		}
		add_adm_power = 100
		add_prestige = -10
		add_devotion = -10
		custom_tooltip = th_incidents_scarletmists_scarlet_mist
		hidden_effect = {
			gensokyo_superregion = {
				limit = {
					NOT = { owned_by = SCR }
					NOT = { owned_by = SCD }
					NOT = { owned_by = FLR }
				}
				add_province_modifier = {
					name = th_the_scarlet_mist
					duration = 1825
				}
			}
		}
	}
}

#Scarlet Mist Incident - Bad Outcome
country_event = { #Nothing changes and Scarlett Realm Mists grow
	id = th_incidents_scarletmists.9
	title = "th_incidents_scarletmists.9.t"
	desc = "th_incidents_scarletmists.9.desc"
	picture = REMILIAVICTORY_eventPicture
	
	trigger = {
		has_global_flag = th_SDM_incident_end
		th_incident_is_investigator = yes
		NOT = { has_global_flag = th_scarlet_mists_incident_solved }
		check_variable = {
			which = th_SDM_inci_goodbad_level
			value = 0
		}
		NOT = {
			check_variable = {
				which = th_SDM_inci_goodbad_level
				value = 5
			}
		}
		NOT = { has_country_flag = th_incident_last_fight_terribly_lost }
		has_country_flag = th_SDM_inci_about_to_get_final
		NOT = { has_country_flag = th_just_finished_danmaku_fight }
	}
	
	immediate = {
		hidden_effect = {
			th_incident_clr_terminate_flag = yes
			set_global_flag = th_scarlet_mists_incident_solved
			clr_global_flag = th_active_incident
			clr_country_flag = th_SDM_inci_about_to_get_final
		}
	}
	
	mean_time_to_happen = {
		months = 12
	}
	major = yes
	
	option = {		#Well, I've done what I could.
		name = "th_incidents_scarletmists.9.a"
		custom_tooltip = th_incidents_scarletmists.9.a.tt
		if = {
			limit = {
				exists = SCD
			}
			SCD = {				
				add_country_modifier = {
					name = "th_SDM_inci_mist_spreading"
					duration = 1825
				}
			}
		}
		else_if = {
			limit = {
				exists = SCR
			}
			SCR = {				
				add_country_modifier = {
					name = "th_SDM_inci_mist_spreading"
					duration = 1825
				}
			}
		}
		add_adm_power = 100
		add_prestige = -10
		add_devotion = -10
		custom_tooltip = th_incidents_scarletmists_scarlet_mist
		hidden_effect = {
			gensokyo_superregion = {
				limit = {
					NOT = { owned_by = SCR }
					NOT = { owned_by = SCD }
					NOT = { owned_by = FLR }
				}
				add_province_modifier = {
					name = th_the_scarlet_mist
					duration = 1825
				}
			}
		}
	}
}

#Scarlet Mist Incident - OK Outcome
country_event = { 
	id = th_incidents_scarletmists.10
	title = "th_incidents_scarletmists.10.t"
	desc = "th_incidents_scarletmists.10.desc"
	picture = SHRINE_eventPicture
	
	trigger = {
		has_global_flag = th_SDM_incident_end
		th_incident_is_investigator = yes
		NOT = { has_country_flag = th_incident_last_fight_terribly_lost }
		NOT = { has_global_flag = th_scarlet_mists_incident_solved }
		check_variable = {
			which = th_SDM_inci_goodbad_level
			value = 5
		}
		NOT = {
			check_variable = {
				which = th_SDM_inci_goodbad_level
				value = 10
			}
		}
		has_country_flag = th_SDM_inci_about_to_get_final
		NOT = { has_country_flag = th_just_finished_danmaku_fight }
	}

	immediate = {
		hidden_effect = {
			th_incident_clr_terminate_flag = yes
			set_global_flag = th_scarlet_mists_incident_solved
			clr_global_flag = th_active_incident
			clr_country_flag = th_SDM_inci_about_to_get_final
			if = {
				limit = {
					has_country_flag = hkr_inci_setup
				}
				th_incident_increase_good_outcome_counter = yes
				set_country_flag = th_solved_sdm_inci
			}
			set_country_flag = th_solved_incident
		}
	}
	
	mean_time_to_happen = {
		months = 12
	}
	major = yes
	
	option = {		#Finally, it's over.
		name = "th_incidents_scarletmists.10.a"
		custom_tooltip = th_incidents_scarletmists.10.a.tt
		if = {
			limit = {
				OR = {
					was_tag = HKR
					tag = HKR
					was_tag = FOM
					tag = FOM
				}
			}
			add_country_modifier = {
				name = "th_SDM_inci_mist_stopped"
				duration = 9125
			}
		}
		else = {			
			add_country_modifier = {
				name = "th_SDM_inci_mist_stopped"
				duration = 3650
			}
		}
		add_adm_power = 100
		add_prestige = 25
		add_devotion = 10
	}
}

#Scarlet Mist Incident - Good Outcome
country_event = { #Remilia grumbles about her defeat, but disband the mists AND visits the shrine
	id = th_incidents_scarletmists.11
	title = "th_incidents_scarletmists.11.t"
	desc = "th_incidents_scarletmists.11.desc"
	picture = THFEST_eventPicture
	
	trigger = {
		has_global_flag = th_SDM_incident_end
		check_variable = {
			which = th_SDM_inci_goodbad_level
			value = 10
		}
		th_incident_is_investigator = yes
		NOT = { has_country_flag = th_incident_last_fight_terribly_lost }
		NOT = { has_global_flag = th_scarlet_mists_incident_solved }
		has_country_flag = th_SDM_inci_about_to_get_final
		NOT = { has_country_flag = th_just_finished_danmaku_fight }
	}
	
	immediate = {
		hidden_effect = {
			th_incident_clr_terminate_flag = yes
			set_global_flag = th_scarlet_mists_incident_solved
			clr_global_flag = th_active_incident
			clr_country_flag = th_SDM_inci_about_to_get_final
			if = {
				limit = {
					has_country_flag = hkr_inci_setup
				}
				th_incident_increase_good_outcome_counter = yes
			}
			set_country_flag = th_solved_incident
		}
	}
	
	mean_time_to_happen = {
		months = 12
	}
	major = yes
	
	option = {		#Well, we should investigate this, or Remilia will never go away.
		name = "th_incidents_scarletmists.11.b"
		custom_tooltip = th_incidents_scarletmists.11.b.tt
		highlight = yes
		add_adm_power = -25
		add_prestige = 35
		if = {
			limit = {
				OR = {
					was_tag = HKR
					tag = HKR
				}
			}
			add_country_modifier = {
				name = "th_SDM_inci_mist_stopped"
				duration = 9125
			}
			hidden_effect = {
				set_country_flag = th_solved_sdm_inci
			}
		}
		else_if = {
			limit = {
				OR = {
					was_tag = FOM
					tag = FOM
				}
			}
			add_country_modifier = {
				name = "th_SDM_inci_mist_stopped"
				duration = 9125
			}
		}
		else = {			
			add_country_modifier = {
				name = "th_SDM_inci_mist_stopped"
				duration = 3650
			}
		}
		hidden_effect = {
			country_event = {
				id = th_incidents_scarletmists.8
				days = 90
			}
		}
	}
	
	option = {		#The rain will stop eventually. She can stay here for awhile.
		name = "th_incidents_scarletmists.11.a"
		custom_tooltip = th_incidents_scarletmists.11.a.tt
		if = {
			limit = {
				OR = {
					was_tag = HKR
					tag = HKR
				}
			}
			add_country_modifier = {
				name = "th_SDM_inci_mist_stopped"
				duration = 9125
			}
			hidden_effect = {
				set_country_flag = th_solved_sdm_inci
			}
		}
		else_if = {
			limit = {
				OR = {
					was_tag = FOM
					tag = FOM
				}
			}
			add_country_modifier = {
				name = "th_SDM_inci_mist_stopped"
				duration = 9125
			}
		}
		else = {			
			add_country_modifier = {
				name = "th_SDM_inci_mist_stopped"
				duration = 3650
			}
		}
		add_adm_power = 150
		add_prestige = 25
		add_devotion = 10
	}
}

#Scarlet Mist Incident - EXTRA Outcome Good
country_event = { #Remilia and Flandre visit the shrine
	id = th_incidents_scarletmists.12
	title = "th_incidents_scarletmists.12.t"
	desc = "th_incidents_scarletmists.12.desc"
	picture = THFEST_eventPicture
	
	is_triggered_only = yes	
	major = yes
	
	option = {		#The rain will stop eventually. She can stay here for awhile.
		name = "th_incidents_scarletmists.12.a"	
		custom_tooltip = th_incidents_scarletmists.12.a.tt
		if = {
			limit = {
				OR = {
					was_tag = HKR
					tag = HKR
				}
			}
			add_country_modifier = {
				name = "th_SDM_inci_extra"
				duration = 9125
			}
			hidden_effect = {
				set_country_flag = th_solved_sdm_inci_extra
			}
		}
		else_if = {
			limit = {
				OR = {
					was_tag = FOM
					tag = FOM
				}
			}
			add_country_modifier = {
				name = "th_SDM_inci_extra"
				duration = 9125
			}
		}
		else = {			
			add_country_modifier = {
				name = "th_SDM_inci_extra"
				duration = 3650
			}
		}
		add_adm_power = 150
		if = {
			limit = {
				has_country_flag = th_increased_donations_from_events
			}
			add_years_of_income = 3
		}
		else = {
			add_years_of_income = 2
		}
		add_prestige = 50
		add_devotion = 10
	}
}



#Scarlet Mist Incident - Flavor Events - Ally has to deal with Rumia
country_event = {
	id = th_incidents_scarletmists.13
	title = "th_incidents_scarletmists.13.t"
	desc = "th_incidents_scarletmists.13.desc"
	picture = RUMIA_eventPicture
	
	is_triggered_only = yes
	
	option = {		#We shall trust our ally and deal with Rumia
		name = "th_incidents_scarletmists.13.a"
		add_mil_power = -75
		add_prestige = 15
		FROM = {
			country_event = {
				id = th_incidents_scarletmists.14
			}			
		}
		reverse_add_opinion = {
			who = FROM
			modifier = th_helped_us_to_deal_with_Rumia
		}
		
		ai_chance = { 
			factor = 60
			modifier = {
				factor = 100
				FROM = {
					trust = { 
						who = ROOT
						value = 75
					}
				}
			}
			modifier = {
				factor = 0
				NOT = {
					FROM = {
						trust = { 
							who = ROOT
							value = 60
						}
					}
				}
			}
		}
	}
	
	option = {		#No, this isn't our problem. Return to sender!
		name = "th_incidents_scarletmists.13.b"
		add_dip_power = -10
		add_mil_power = 100
		add_prestige = 15
		FROM = {
			country_event = {
				id = th_incidents_scarletmists.15
			}			
		}
		reverse_add_opinion = {
			who = FROM
			modifier = th_sent_Rumia_back
		}
		
		ai_chance = { 
			factor = 40
			modifier = {
				factor = 100
				NOT = {
					FROM = {
						trust = { 
							who = ROOT
							value = 60
						}
					}
				}
			}
			modifier = {
				factor = 0
				FROM = {
					trust = { 
						who = ROOT
						value = 75
					}
				}
			}
		}
	}
	
	option = {		#Waaiit, Rumia's skills would make her an excellent general!
		name = "th_incidents_scarletmists.13.c"
		trigger = {
			OR = {
				tag = SFF
				has_mil_advisor_3 = yes
				ruler_has_good_mil_personality = yes
			}
		}
		highlight = yes
		add_mil_power = -25
		add_prestige = 25
		define_general = {
			name = "Rumia"
			female = yes
			shock = 6
			fire = 4
			manuever = 0
			siege = 2
		}
		
		FROM = {
			country_event = {
				id = th_incidents_scarletmists.14
			}			
		}
		reverse_add_opinion = {
			who = FROM
			modifier = th_helped_us_to_deal_with_Rumia
		}
		
		ai_chance = { 
			factor = 100
		}
	}
}

#Scarlet Mist Incident - Flavor Events - Ally can handle Rumia
country_event = {
	id = th_incidents_scarletmists.14
	title = "th_incidents_scarletmists.14.t"
	desc = "th_incidents_scarletmists.14.desc"
	picture = RUMIA_eventPicture
	
	is_triggered_only = yes
	
	option = {		#I knew I could count on them
		name = "th_incidents_scarletmists.14.a"
		add_dip_power = 25
	}
}

#Scarlet Mist Incident - Flavor Events - Ally sent Rumia back
country_event = {
	id = th_incidents_scarletmists.15
	title = "th_incidents_scarletmists.15.t"
	desc = "th_incidents_scarletmists.15.desc"
	picture = RUMIA_eventPicture
	
	is_triggered_only = yes
	
	option = {		#Curses!
		name = "th_incidents_scarletmists.15.a"
		add_mil_power = -75
		add_stability = -1
	}
}

#Scarlet Mist Incident - Random Mists events - Create Claim on neighbour
country_event = {
	id = th_incidents_scarletmists.17
	title = "th_incidents_scarletmists.17.t"
	desc = "th_incidents_scarletmists.17.desc"
	picture = REMILIAVICTORY_eventPicture
	
	trigger = {
		is_free_or_tributary_trigger = yes
		any_neighbor_country = {
			any_owned_province = {
				NOT = { is_core = ROOT }
				NOT = { is_claim = ROOT }
				any_neighbor_province = {
					owned_by = ROOT
				}
			}
		}
		OR = {
			AND = {
				tag = SCR
				NOT = { exists = SCD }
			}
			tag = SCD
		}
		has_country_modifier = th_SDM_scarlet_night
	}
	
	mean_time_to_happen = {
		months = 12
	}
	
	option = {		#The Scarlet Mist is spreading
		name = "th_incidents_scarletmists.17.a"
		random_neighbor_country = {
			limit = {
				NOT = { alliance_with = ROOT }
				NOT = { is_subject_of = ROOT }
				any_owned_province = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
					any_neighbor_province = {
						owned_by = ROOT
					}
				}			
			}
			random_owned_province = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { is_claim = ROOT }
					any_neighbor_province = {
						owned_by = ROOT
					}
				}
				add_claim = ROOT
			}
		}
		add_prestige = 10
	}
}

#Scarlet Mist Incident - Random Mists events - Gets insane mists buff
country_event = {
	id = th_incidents_scarletmists.18
	title = "th_incidents_scarletmists.18.t"
	desc = "th_incidents_scarletmists.18.desc"
	picture = REMILIAVICTORY_eventPicture
	
	trigger = {
		OR = {
			AND = {
				tag = SCR
				NOT = { exists = SCD }
			}
			tag = SCD
		}
		has_global_flag = th_current_incident_scarlet_mists
	}
	
	fire_only_once = yes
	major = yes
	
	mean_time_to_happen = {
		months = 12
	}
	
	option = {		#The Scarlet Mist is spreading
		name = "th_incidents_scarletmists.18.a"
		add_country_modifier = {
			name = "th_SDM_scarlet_night"
			duration = 9125
		}
	}
}

#Scarlet Mist Incident - Random Mists events - Remilia demands her land back
province_event = {
	id = th_incidents_scarletmists.19
	title = "th_incidents_scarletmists.19.t"
	desc = "th_incidents_scarletmists.19.desc"
	picture = REMILIAVICTORY_eventPicture
	
	trigger = {
		owner = { ai = no }
		has_global_flag = th_current_incident_scarlet_mists
		NOT = { has_province_flag = scarlet_revolt }
		NOT = { local_autonomy = 1 }
		OR = {
			area = Scarlett_domain
			area = Scarlet_island
			area = Scarlet_mountain
		}
		culture = Scarlett
		owner = {
			NOT = { tag = SCR }
			NOT = { tag = SCD }
			is_free_or_tributary_trigger = yes
			num_of_cities = 4
		}
	}

	mean_time_to_happen = {
		months = 30
		modifier = {
			factor = 0.5
			any_neighbor_province = {
				has_province_flag = scarlet_revolt
			}
		}
		modifier = {
			factor = 0.5
			has_owner_religion = no
		}
		modifier = {
			factor = 0.5
			owner = {
				NOT = { culture_group = ROOT }
			}
		}
		modifier = {
			factor = 0.5
			owner = {
				NOT = { primary_culture = ROOT }
				NOT = { accepted_culture = ROOT }
			}
		}
		modifier = {
			factor = 0.5
			owner = { war_with = SCR }
		}
		modifier = {
			factor = 0.75
			unrest = 3
		}
		modifier = {
			factor = 0.75
			unrest = 5
		}
		modifier = {
			factor = 0.75
			unrest = 7
		}
		modifier = {
			factor = 0.75
			unrest = 9
		}
	}

	option = {
		name = "th_incidents_scarletmists.19.a"
		set_province_flag = scarlet_revolt
		spawn_rebels = {
			type = nationalist_rebels
			size = 1
			friend = SCR
		}
		
		ai_chance = { 
			factor = 90
		}
	}
	option = {
		name = "th_incidents_scarletmists.19.b"
		cede_province = SCR
		
		ai_chance = { 
			factor = 10
		}
	}
}

#Scarlet Mist Incident - Random Mists events - Remilia demands her independence back
country_event = {
	id = th_incidents_scarletmists.20
	title = "th_incidents_scarletmists.20.t"
	desc = "th_incidents_scarletmists.20.desc"
	picture = REMILIAVICTORY_eventPicture
	
	trigger = {
		has_global_flag = th_current_incident_scarlet_mists
		NOT = { has_country_flag = crd_appealed_remilia }	#Memo: add the same trigger but in reverse for SA incident
		overlord_of = SCR
		SCR = {
			NOT = { has_country_modifier = th_SDM_demands_independence }
			NOT = { has_country_modifier = th_inci_rebellious_subject }
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	option = {		#Nah
		name = "th_incidents_scarletmists.20.a"
		if = {
			limit = {
				th_is_or_was_tag = {
					tag = CRD
				}
			}
			SCR = {
				add_country_modifier = {
					name = "th_inci_rebellious_subject"
					duration = 5475
				}
			}
		}
		else = {
			SCR = {
				add_country_modifier = {
					name = "th_SDM_demands_independence"
					duration = 5475
				}
			}
		}
		
		ai_chance = { 
			factor = 90
		}
	}
	
	option = {		#The vampire is the stress not worth.
		name = "th_incidents_scarletmists.20.b"
		trigger = {
			NOT = { th_is_or_was_tag = { tag = CRD } }
		}
		SCR = {
			grant_independence = yes 
		}
		
		ai_chance = { 
			factor = 10
		}
	}
}

#Scarlet Mist Incident - Random Mists events - Cleaning the mists up
country_event = {
	id = th_incidents_scarletmists.21
	title = "th_incidents_scarletmists.21.t"
	desc = "th_incidents_scarletmists.21.desc"
	picture = SHRINE_eventPicture
	
	trigger = {
		has_global_flag = th_current_incident_scarlet_mists
		OR = {
			tag = HKR
			tag = MRY
			tag = FOM
			AND = {
				tag = GNK
				has_reform = Gensokyan_shrine_theocracy
			}
			th_incident_is_investigator = yes
		}
		any_known_country = { 
			any_owned_province = {
				has_province_modifier = th_plagued_by_the_scarlet_mist
			}
		}
	}
	
	mean_time_to_happen = {
		months = 24

		modifier = {
			factor = 0.5			
			NOT = {
				check_variable = {
					which = th_SDM_inci_goodbad_level
					value = 10
				}
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			random_known_country = {
				limit = {
					any_owned_province = {
						NOT = { has_province_flag = th_first_clean_dummy }
						NOT = { has_province_flag = th_second_clean_dummy }
						has_province_modifier = th_plagued_by_the_scarlet_mist
					}
				}
				random_owned_province = {
					limit = {
						has_province_modifier = th_plagued_by_the_scarlet_mist
					}
					set_province_flag = th_first_clean_dummy
				}
			}
			random_known_country = {
				limit = {
					any_owned_province = {
						NOT = { has_province_flag = th_first_clean_dummy }
						NOT = { has_province_flag = th_second_clean_dummy }
						has_province_modifier = th_plagued_by_the_scarlet_mist
					}
				}
				random_owned_province = {
					limit = {
						has_province_modifier = th_plagued_by_the_scarlet_mist
					}
					set_province_flag = th_second_clean_dummy
				}
			}
		}
	}

	after = {
		hidden_effect = {
			every_province = {
				limit = {
					has_province_flag = th_first_clean_dummy
				}
				clr_province_flag = th_first_clean_dummy
			}
			every_province = {
				limit = {
					has_province_flag = th_second_clean_dummy
				}
				clr_province_flag = th_second_clean_dummy
			}
		}
	}
	
	option = {		#Put more resources into the cleaning
		name = "th_incidents_scarletmists.21.a"
		add_years_of_income = -0.2
		add_adm_power = 25
		random_known_country = {
			limit = {
				any_owned_province = {
					has_province_modifier = th_plagued_by_the_scarlet_mist
					has_province_flag = th_first_clean_dummy
				}
			}
			random_owned_province = {
				limit = {
					has_province_modifier = th_plagued_by_the_scarlet_mist
					has_province_flag = th_first_clean_dummy
				}
				remove_province_modifier = th_plagued_by_the_scarlet_mist
				clr_province_flag = th_first_clean_dummy
			}
		}
		random_known_country = {
			limit = {
				any_owned_province = {
					has_province_modifier = th_plagued_by_the_scarlet_mist
					has_province_flag = th_second_clean_dummy
				}
			}
			random_owned_province = {
				limit = {
					has_province_modifier = th_plagued_by_the_scarlet_mist
					has_province_flag = th_second_clean_dummy
				}
				remove_province_modifier = th_plagued_by_the_scarlet_mist
				clr_province_flag = th_second_clean_dummy
			}
		}
		
		if = {
			limit = {
				th_incident_is_investigator = yes
			}
			custom_tooltip = th_incidents_scarletmists.21.a.tt
			th_incident_minor_victory_bonus = yes
		}
		
		ai_chance = { 
			factor = 75
			modifier = {
				factor = 0
				NOT = {  years_of_income = 0.3 }
			}
		}
	}
	
	option = {		#The normal mikos will clean it up
		name = "th_incidents_scarletmists.21.b"
		custom_tooltip = th_incidents_scarletmists.21.b.tt
		add_adm_power = 10
		random_known_country = {
			limit = {
				any_owned_province = {
					has_province_modifier = th_plagued_by_the_scarlet_mist
					has_province_flag = th_first_clean_dummy
				}
			}
			random_owned_province = {
				limit = {
					has_province_modifier = th_plagued_by_the_scarlet_mist
					has_province_flag = th_first_clean_dummy
				}
				remove_province_modifier = th_plagued_by_the_scarlet_mist
				clr_province_flag = th_first_clean_dummy
			}
		}
		
		ai_chance = { 
			factor = 25
			modifier = {
				factor = 100
				NOT = {  years_of_income = 0.3 }
			}
		}
	}
}

#Scarlet Mist Incident - Random Mists events - Province gets Scarlet Mists Modifier
province_event = {
	id = th_incidents_scarletmists.25
	title = "th_incidents_scarletmists.25.t"
	desc = "th_incidents_scarletmists.25.desc"
	picture = SCARLETT_eventPicture
	
	trigger = {
		NOT = { has_province_modifier = th_plagued_by_the_scarlet_mist }
		NOT = { has_province_modifier = th_just_cured_of_the_mist }
		has_global_flag = th_current_incident_scarlet_mists
		superregion = gensokyo_superregion
		NOT = { culture = Scarlett }
		owner = {
			NOT = { tag = SCR }
			NOT = { tag = SCD }
			NOT = {
				AND = {
					tag = CRD
					overlord_of = SCR 
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 60

		modifier = {
			factor = 0.25
			any_neighbor_province = {
				has_province_flag = scarlet_revolt
			}
		}
	}
	
	hidden = yes
	
	option = {		#Scarlet Mist plagues a province!
		name = "th_incidents_scarletmists.25.a"
		add_province_modifier = { 
			name = th_plagued_by_the_scarlet_mist
			duration = -1  
			desc = th_incident_duration_tt
		}
		
		ai_chance = { 
			factor = 100
		}		
	}
}

#Scarlet Mist Incident - Random Mists events - Clean own province
province_event = {
	id = th_incidents_scarletmists.24
	title = "th_incidents_scarletmists.24.t"
	desc = "th_incidents_scarletmists.24.desc"
	picture = SHRINE_eventPicture
	
	trigger = {
		has_province_modifier = th_plagued_by_the_scarlet_mist
		has_global_flag = th_current_incident_scarlet_mists
		superregion = gensokyo_superregion
	}
	
	mean_time_to_happen = {
		months = 24
	}

	is_mtth_scaled_to_size = 1

	immediate = {
		hidden_effect = {
			owner = {
				save_event_target_as = th_sdm_province_owner
			}
		}
	}
	
	option = {		#Clean the area up!
		name = "th_incidents_scarletmists.24.a"
		owner = {
			add_years_of_income = -0.25
		}
		every_province_in_state = {
			limit = {
				any_province_in_state = {
					province_id = ROOT
				}
				owned_by = event_target:th_sdm_province_owner
			}
			remove_province_modifier = th_plagued_by_the_scarlet_mist
			add_province_modifier = {
				name = th_just_cured_of_the_mist
				duration = 720
			}
		}
		
		if = {
			limit = {
				owner = { th_incident_is_investigator = yes }
			}
			custom_tooltip = th_incidents_scarletmists.21.a.tt
			th_incident_minor_victory_bonus = yes
		}
		
		ai_chance = { 
			factor = 75
			modifier = {
				factor = 0
				NOT = { owner = { years_of_income = 0.4 } }
			}
			modifier = {
				factor = 0
				owner = { years_of_income = 0.7 }
			}
		}
	}
	
	option = {		#Clean the province up!
		name = "th_incidents_scarletmists.24.b"
		owner = {
			add_years_of_income = -0.8
		}
		every_province_in_state = {
			limit = {
				any_province_in_state = {
					province_id = ROOT
				}
				owned_by = event_target:th_sdm_province_owner
			}
			if = {
				limit = {
					owner = { th_incident_is_investigator = yes }
				}
				th_incident_minor_victory_bonus = yes
			}
			remove_province_modifier = th_plagued_by_the_scarlet_mist
			add_province_modifier = {
				name = th_just_cured_of_the_mist
				duration = 1825
			}
		}
		
		if = {
			limit = {
				owner = { th_incident_is_investigator = yes }
			}
			th_incident_major_victory_bonus = yes
		}
		
		ai_chance = { 
			factor = 75
			modifier = {
				factor = 0
				NOT = { owner = { years_of_income = 0.7 } }
			}
		}
	}
	
	option = {		#Clean the province up!
		name = "th_incidents_scarletmists.24.c"

		every_province_in_state = {
			limit = {
				any_province_in_state = {
					province_id = ROOT
				}
				owned_by = event_target:th_sdm_province_owner
				has_province_modifier = th_plagued_by_the_scarlet_mist
			}
			add_local_autonomy = 10
		}
		
		ai_chance = { 
			factor = 25
			modifier = {
				factor = 100
				NOT = { owner = { years_of_income = 0.2 } }
			}
		}
	}
}

#Scarlet Mist Incident - Province cleans itself
province_event = {
	id = th_incidents_scarletmists.260
	title = "th_incidents_scarletmists.260.t"
	desc = "th_incidents_scarletmists.260.desc"
	picture = SHRINE_eventPicture
	
	trigger = {
		OR = {
			has_province_modifier = th_plagued_by_the_scarlet_mist
			has_province_modifier = th_just_cured_of_the_mist
		}
		OR = {
			owner = {
				tag = SCR
				tag = SCD
				AND = {
					tag = CRD
					overlord_of = SCR 
				}
			}
			NOT = { has_global_flag = th_current_incident_scarlet_mists }
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	hidden = yes
	
	option = {
		name = "th_incidents_scarletmists.260.a"
		remove_province_modifier = th_plagued_by_the_scarlet_mist
		remove_province_modifier = th_just_cured_of_the_mist		
		
		ai_chance = { 
			factor = 100
		}
	}		
}

#Scarlet Mist Incident - Dummy Flag Cleaner
province_event = {
	id = th_incidents_scarletmists.270
	title = "th_incidents_scarletmists.270.t"
	desc = "th_incidents_scarletmists.270.desc"
	picture = SHRINE_eventPicture
	
	trigger = {
		OR = {
			has_province_flag = th_first_clean_dummy
			has_province_flag = th_second_clean_dummy
		}
	}
	
	mean_time_to_happen = {
		days = 2
	}
	
	hidden = yes
	
	option = {
		name = "th_incidents_scarletmists.270.a"
		clr_province_flag = th_first_clean_dummy
		clr_province_flag = th_second_clean_dummy
		
		ai_chance = { 
			factor = 100
		}
	}		
}

#Scarlet Mist Incident - Forbid SCR, SCD and CIN to become investigators
country_event = {
	id = th_incidents_scarletmists.271
	title = th_incidents_scarletmists.271.t
	desc = th_incidents_scarletmists.271.desc
	picture = REMILIAVICTORY_eventPicture

	trigger = {
		has_global_flag = th_current_incident_scarlet_mists
		OR = {
			tag = SCR
			tag = SCD
			tag = CIN
			was_tag = SCR
			was_tag = SCD
			was_tag = CIN
		}
		NOT = { has_country_flag = th_is_not_valid_for_investiagtor_role }
	}

	mean_time_to_happen = {
		days = 1
	}

	hidden = yes

	option = {
		name = th_incidents_scarletmists.271.a
		set_country_flag = th_is_not_valid_for_investiagtor_role

		ai_chance = {
			factor = 100
		}
	}
}

#Scarlet Mist Incident - Special Case: nobody can become investigator
country_event = {
	id = th_incidents_scarletmists.26
	title = "th_incidents_scarletmists.26.t"
	desc = "th_incidents_scarletmists.26.desc"
	picture = SCARLETT_eventPicture
	
	trigger = {
		has_global_flag = th_current_incident_scarlet_mists		
		gensokyo_superregion = {
			OR = {
				owned_by = SCR
				owned_by = SCD
				owner = {
					is_subject_of = SCR
				}
				owner = {
					is_subject_of = SCD
				}
			}
		}
		OR = {
			tag = SCR
			tag = SCD
		}
		all_country = {
			th_incident_can_not_become_investigator = yes
		}
	}
	
	mean_time_to_happen = {
		days = 5
	}
	
	immediate = {
		hidden_effect = {
			th_incident_clr_terminate_flag = yes
			set_global_flag = th_scarlet_mists_incident_solved
			clr_global_flag = th_active_incident
		}
	}
	
	major = yes
	
	option = {		#Scarlet Realm triumphs!
		name = "th_incidents_scarletmists.26.a"
		custom_tooltip = th_incidents_scarletmists.26.a.tt					
		add_country_modifier = {
			name = "th_SDM_inci_mist_spreading"
			duration = 9125
		}		
	}
}

#Scarlet Mist Incident - Special Case: nobody can become investigator, but Gensokyo was NOT united by Remi
country_event = {
	id = th_incidents_scarletmists.27
	title = "th_incidents_scarletmists.27.t"
	desc = "th_incidents_scarletmists.27.desc"
	picture = SCARLETT_eventPicture
	
	trigger = {
		has_global_flag = th_current_incident_scarlet_mists	
		any_province = {
			superregion = gensokyo_superregion
			NOT = { owned_by = SCR }
			NOT = { owner = { is_subject_of = SCR } }
		}	
		any_province = {
			superregion = gensokyo_superregion
			NOT = { owned_by = SCD }
			NOT = { owner = { is_subject_of = SCD } }
		}
		owns = 4968
		all_country = {
			th_incident_can_not_become_investigator = yes
		}
	}
	
	mean_time_to_happen = {
		days = 5
	}
	
	immediate = {
		hidden_effect = {
			th_incident_clr_terminate_flag = yes
			set_global_flag = th_scarlet_mists_incident_solved
			clr_global_flag = th_active_incident
		}
	}
	
	major = yes
	
	option = {		#Scarlet Realm triumphs!--Not really
		name = "th_incidents_scarletmists.27.a"
		trigger = {
			OR = {
				tag = SCR
				was_tag = SCR
			}
		}
		custom_tooltip = th_incidents_scarletmists.27.a.tt					
		add_country_modifier = {
			name = "th_SDM_inci_mist_spreading"
			duration = 3650
		}		
		custom_tooltip = th_incidents_scarletmists_scarlet_mist
		hidden_effect = {
			gensokyo_superregion = {
				limit = {
					NOT = { owned_by = SCR }
					NOT = { owned_by = SCD }
					NOT = { owned_by = FLR }
				}
				add_province_modifier = {
					name = th_the_scarlet_mist
					duration = 1825
				}
			}
		}
	}
	option = {		#Nobody is investigating. We can only pray for mist`s gone
		name = "th_incidents_scarletmists.27.b"
		trigger = {
			NOT = { tag = SCR }
			NOT = { was_tag = SCR }
		}
		custom_tooltip = th_incidents_scarletmists.27.b.tt
		custom_tooltip = th_incidents_scarletmists_scarlet_mist
		hidden_effect = {
			gensokyo_superregion = {
				limit = {
					NOT = { owned_by = SCR }
					NOT = { owned_by = SCD }
					NOT = { owned_by = FLR }
				}
				add_province_modifier = {
					name = th_the_scarlet_mist
					duration = 1825
				}
			}
		}
	}
}

############################TERMINATION############################
#Scarlet Mist Incident - Bad Outcome
country_event = { #Nothing changes and Scarlett Realm Mists grow
	id = th_incidents_scarletmists.100
	title = "th_incidents_scarletmists.9.t"
	desc = "th_incidents_scarletmists.9.desc"
	picture = REMILIAVICTORY_eventPicture

	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			th_incident_clr_terminate_flag = yes
			set_global_flag = th_scarlet_mists_incident_solved
			clr_global_flag = th_active_incident
			clr_country_flag = th_SDM_inci_about_to_get_final
		}
	}
	major = yes
	
	option = {		#Well, I've done what I could.
		name = "th_incidents_scarletmists.9.a"
		custom_tooltip = th_incidents_scarletmists.9.a.tt
		if = {
			limit = {
				exists = SCD
			}
			SCD = {				
				add_country_modifier = {
					name = "th_SDM_inci_mist_spreading"
					duration = 1825
				}
			}
		}
		else_if = {
			limit = {
				exists = SCR
			}
			SCR = {				
				add_country_modifier = {
					name = "th_SDM_inci_mist_spreading"
					duration = 1825
				}
			}
		}
		add_adm_power = 100
		add_prestige = -10
		add_devotion = -10
		custom_tooltip = th_incidents_scarletmists_scarlet_mist
		hidden_effect = {
			gensokyo_superregion = {
				limit = {
					NOT = { owned_by = SCR }
					NOT = { owned_by = SCD }
					NOT = { owned_by = FLR }
				}
				add_province_modifier = {
					name = th_the_scarlet_mist
					duration = 1825
				}
			}
		}
	}
}