########################################
# Flavor Events for Sangetsusei
########################################

namespace = flavor_tfr

#Forest of Fairies
country_event = {
	id = flavor_tfr.1
	title = "flavor_tfr.1.t"
	desc = "flavor_tfr.1.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	#Settle the forest!
	option = {
		name = flavor_tfr.1.a
		4942 = {
			change_province_name = "Forest of Fairies"
			rename_capital = "Forest of Fairies"
			add_core = ROOT
			add_base_tax = 4
			add_base_production = 4
			add_base_manpower = 3
			change_culture = ROOT
			center_of_trade = 2
		}
		set_capital = 4942

		ai_chance = {
			factor = 100
		}
	}

	#We will stay in [Root.Capital.Getname]
	option = {
		name = flavor_tfr.1.b
		capital_scope = {
			add_base_tax = 4
			add_base_production = 4
			add_base_manpower = 3
			if = {
				limit = {
					province_has_center_of_trade_of_level = 1
				}
				add_center_of_trade_level = 1
			}
		}

		ai_chance = {
			factor = 0
		}
	}
}

#Ask Cirno if she wants support
country_event = {
	id = flavor_tfr.2
	title = "flavor_tfr.2.t"
	desc = "flavor_tfr.2.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	#Declare now war against SCR
	option = {
		name = flavor_tfr.2.a
		custom_tooltip = flavor_tfr.2.a.tt
		CIN = {
			country_event = {
				id = flavor_tfr.3
			}
		}

		ai_chance = {
			factor = 100
		}
	}

	#Support CIN's independence
	option = {
		name = flavor_tfr.2.b
		custom_tooltip = flavor_tfr.2.b.tt
		trigger = {
			custom_trigger_tooltip = {
				tooltip = flavor_cin.20.a.ct
				OR = {
					has_dlc = "Conquest of Paradise"
					has_dlc = "El Dorado"
				}
			}
		}
		CIN = {
			country_event = {
				id = flavor_tfr.4
			}
		}

		ai_chance = {
			factor = 0
		}
	}

	#BY MAGIC AND FLOWERS WE WILL CONQUER CIN BY OUR OWN
	option = {
		name = flavor_tfr.2.c
		custom_tooltip = flavor_tfr.2.c.tt

		ai_chance = {
			factor = 0
		}
	}
}

#TFR offers war against Overlord
country_event = {
	id = flavor_tfr.3
	title = "flavor_tfr.3.t"
	desc = "flavor_tfr.3.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			overlord = {
				save_event_target_as = cin_overlord
			}
		}
	}

	#TO ARMS! TODAY THE SCARLET DEVIL WILL FALL
	option = {
		name = flavor_tfr.3.a
		hidden_effect = {
			set_country_flag = tfr_cin_will_join
			FROM = {
				set_country_flag = tfr_tfr_will_get_cin
			}
		}
		grant_independence = yes
		create_alliance = FROM
		FROM = {
			declare_war_with_cb = {
				casus_belli = cb_touhou_fairy_war
				who = event_target:cin_overlord
			}
		}
		join_all_offensive_wars_of = FROM

		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:cin_overlord = {
					OR = {
						ai = no
						was_player = yes
					}
				}
			}
		}
	}
	
	option = {
		name = flavor_tfr.3.b
		custom_tooltip = flavor_tfr.3.b.tt
		FROM = {
			country_event = {
				id = flavor_tfr.5
			}
		}

		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:cin_overlord = {
					ai = yes
					was_player = no
				}
			}
		}
	}
}

#TFR offers independence support
country_event = {
	id = flavor_tfr.4
	title = "flavor_tfr.4.t"
	desc = "flavor_tfr.4.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			overlord = {
				save_event_target_as = cin_overlord
			}
		}
	}

	#TO ARMS! TODAY THE SCARLET DEVIL WILL FALL
	option = {
		name = flavor_tfr.4.a
		FROM = {
			support_independence_of = ROOT
		}
		hidden_effect = {
			set_country_flag = tfr_cin_will_join
			FROM = {
				set_country_flag = tfr_tfr_will_get_cin
			}
		}

		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:cin_overlord = {
					OR = {
						ai = no
						was_player = yes
					}
				}
			}
		}
	}
	
	option = {
		name = flavor_tfr.4.b

		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:cin_overlord = {
					ai = yes
					was_player = no
				}
			}
		}
	}
}

#Cirno refuses help
country_event = {
	id = flavor_tfr.5
	title = "flavor_tfr.5.t"
	desc = "flavor_tfr.5.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	#Her funeral
	option = {
		name = flavor_tfr.5.a

		ai_chance = {
			factor = 100
		}
	}
}

#Cirno joins TFR
country_event = {
	id = flavor_tfr.6
	title = "flavor_tfr.6.t"
	desc = "flavor_tfr.6.desc"
	picture = FAIRYFOREST_eventPicture
	
	trigger = {
		has_country_flag = tfr_cin_will_join
		any_country = {
			has_country_flag = tfr_tfr_will_get_cin
		}
		is_at_war = no
		is_subject = no
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		hidden_effect = {
			clr_country_flag = tfr_cin_will_join
			random_country = {
				limit = {
					has_country_flag = tfr_tfr_will_get_cin
				}
				clr_country_flag = tfr_tfr_will_get_cin
				save_event_target_as = cin_new_overlord
			}
		}
	}

	#TFR is strong, we should join them!
	option = {
		name = flavor_tfr.6.a
		event_target:cin_new_overlord = {
			country_event = {
				id = flavor_tfr.7
			}
		}

		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				was_player = yes
			}
		}
	}

	#CIN remains independent!
	option = {
		name = flavor_tfr.6.b
		custom_tooltip = flavor_tfr.6.b.tt
		event_target:cin_new_overlord = {
			country_event = {
				id = flavor_tfr.8
			}
		}

		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				was_player = no
			}
		}
	}
}

#Cirno joins us!
country_event = {
	id = flavor_tfr.7
	title = "flavor_tfr.7.t"
	desc = "flavor_tfr.7.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	#Nice
	option = {
		name = flavor_tfr.7.a
		create_subject = {
			subject_type = vassal
			subject = FROM
		}
		add_trust = {
			who = FROM
			value = 15
			mutual = yes
		}

		ai_chance = {
			factor = 100
		}
	}
}

#Cirno refuses to join us!
country_event = {
	id = flavor_tfr.8
	title = "flavor_tfr.8.t"
	desc = "flavor_tfr.8.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	#Her funeral
	option = {
		name = flavor_tfr.8.a
		add_casus_belli = {
			type = cb_vassalize_mission
			target = FROM
		}
		FROM = {
			every_owned_province = {
				limit = {
					culture = Fairy
				}
				add_permanent_claim = ROOT
			}
		}

		ai_chance = {
			factor = 100
		}
	}
}

#Cirno and the Three Fairies
country_event = {
	id = flavor_tfr.9
	title = "flavor_tfr.9.t"
	desc = "flavor_tfr.9.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	option = {
		name = flavor_tfr.9.a
		if = {
			limit = {
				exists = CIN
			}
			CIN = {
				add_trust = {
					who = ROOT
					value = 20
					mutual = yes
				}
				add_opinion = {
					who = ROOT
					modifier = th_united_fairies
				}
				reverse_add_opinion = {
					who = ROOT
					modifier = th_united_fairies
				}
			}
		}
		add_country_modifier = {
			name = tfr_strength_in_unity
			duration = 9125
		}

		ai_chance = {
			factor = 100
		}
	}
}

#The Mother of all Bombs
country_event = {
	id = flavor_tfr.10
	title = "flavor_tfr.10.t"
	desc = {
		trigger = {
			NOT = { owns_or_non_sovereign_subject_of = 4803 }
		}
		desc = "flavor_tfr.10.desc.1"
	}
	desc = {
		trigger = {
			owns_or_non_sovereign_subject_of = 4803
		}
		desc = "flavor_tfr.10.desc.2"
	}
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_tfr.10.a
		if = {
			limit = {
				NOT = { owns_or_non_sovereign_subject_of = 4803 }
			}
			4803 = {

			}
		}
		4803 = {
			if = {
				limit = {
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
				}
				add_devastation = 100
				add_base_tax = -2
				add_base_production = -2
				add_base_manpower = -1
				remove_loot = {
					who = ROOT
					amount = 100
				}
				owner = {
					add_war_exhaustion = 5
				}
			}
			else = {
				add_base_tax = 2
				add_base_production = 2
				add_base_manpower = 1
			}
		}
		add_country_modifier = {
			name = tfr_studying_of_technology
			duration = -1
		}

		ai_chance = {
			factor = 100
		}
	}
}

#Kaguya approves of mini Kaguya
country_event = {
	id = flavor_tfr.11
	title = "flavor_tfr.11.t"
	desc = "flavor_tfr.11.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_tfr.11.a
		add_country_modifier = {
			name = tfr_kaguyas_approval
			duration = -1
		}

		ai_chance = {
			factor = 100
		}
	}
}

#Declare an official Fairy Pirate Republic
country_event = {
	id = flavor_tfr.12
	title = "flavor_tfr.12.t"
	desc = "flavor_tfr.12.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	#We are all pirates now!
	option = {
		name = flavor_tfr.12.a
		hidden_effect = {
			if = {
				limit = {
					has_ruler = "Sunny"
					dynasty = "Milk"
				}
				set_ruler_flag = th_fairy_repub_sunny
			}
			if = {
				limit = {
					has_ruler = "Luna"
					dynasty = "Child"
				}
				set_ruler_flag = th_fairy_repub_luna
			}
		}
		if = {
			limit = {
				NOT = { government = republic }
			}
			change_government = republic
		}
		add_government_reform = Gensokyan_tfr_pirate_government

		ai_chance = {
			factor = 100
		}
	}
}

#Clean Fairy Pirate Crownland up
country_event = {
	id = flavor_tfr.13
	title = "flavor_tfr.13.t"
	desc = "flavor_tfr.13.desc"
	picture = FAIRYFOREST_eventPicture

	hidden = yes
	
	trigger = {
		estate_territory = {
			estate = estate_fairy_pirates
			territory = 0.1
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = flavor_tfr.13.a
		change_estate_land_share = {
			estate = estate_fairy_pirates
			share = -100
		}

		ai_chance = {
			factor = 100
		}
	}
}

#TREASURE FOR TFR
country_event = {
	id = flavor_tfr.14
	title = "flavor_tfr.14.t"
	desc = "flavor_tfr.14.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	option = {
		name = flavor_tfr.14.a
		add_treasury = 5000
		capital_scope = {
			change_trade_goods = coffee
			add_base_tax = 2
			add_base_production = 4
			add_province_modifier = {
				name = tfr_alcoholic_coffee_makers
				duration = -1
			}
		}

		ai_chance = {
			factor = 100
		}
	}
}

#Confrontation with Clownpiece
country_event = {
	id = flavor_tfr.15
	title = "flavor_tfr.15.t"
	desc = "flavor_tfr.15.desc"
	picture = FAIRYFOREST_eventPicture
	
	is_triggered_only = yes

	option = {
		name = flavor_tfr.15.a
		add_yearly_manpower = 1
		add_yearly_sailors = 1
		capital_scope = {
			th_add_manufactory = yes
			add_base_tax = 3
			add_base_production = 3
			add_base_manpower = 2
		}

		ai_chance = {
			factor = 100
		}
	}
}