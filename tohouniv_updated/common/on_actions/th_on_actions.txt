#When adding effects directly in on_actions always consider if it would be best to do so through a scripted effect. on_actions with a lot of script in them are harder to get an overview of.

# country
on_startup = {
	set_global_flag = touhou_universalis_is_active #Global flag. Needed for mod support
	if = {
		limit = {
			current_age = age_of_discovery
		}
		LXA = {
			if = {
				limit = {
					NOT = { has_country_flag = lxa_loyalty_flag }
				}
				add_estate_loyalty = {
					estate = estate_church
					loyalty = -10
				}
				set_country_flag = lxa_loyalty_flag
			}
		}
	}
	emperor = {
		save_global_event_target_as = Emperor
	}
	if = {
		limit = {
			is_emperor_of_china = yes
		}
		save_global_event_target_as = EmperorOfChina
	}
	if = {
		limit = {
			has_government_attribute = enables_yama_authority
		}
		save_global_event_target_as = YamaOfGensokyo
	}
	if = {
		limit = {
			has_government_attribute = th_increased_power_from_own_deity
		}
		th_ds_set_deity_buff_up = yes
	}
	events = {
		muslim_school_events.20 #Pick School
		flavor_got.1 #Event for Gotland to select their mission tree
		#flavor_fra.15000 #Make the French Revolution happen if starting in 1789
	}
	if = {
		limit = {
			has_dlc = "Cradle of Civilization"
			has_country_modifier = tur_janissary
		}
		remove_country_modifier = tur_janissary
	}
	initialize_schools_effect = yes #This is only used here but is used for readability of on_action file.

	if = {
		limit = {
			NOT = { has_country_flag = new_flavour_bav_13_has_been_triggered }
			OR = {
				tag = UBV
				tag = LBV
				tag = ING
			}
		}
		set_country_flag = new_flavour_bav_13_has_been_triggered
		country_event = { id = new_flavour_bav.13 days = 90 } #better not to allow almost instant DOWs
	}
	if = {
		limit = {
			tag = FRA
			started_in = 1789.7.14
			NOT = { is_year = 1790 }
			NOT = { has_disaster = french_revolution }
		}
		add_disaster_progress = {
			value = 100
			disaster = french_revolution
		}
	}
	if = {
		limit = {
			exists = SUK
		}
		SUK = {
			set_ruler_flag = suk_monarch_flag
		}
		AYU = {
			set_country_flag = ayu_monarch_flag
		}
	}
	#TOUHOU
	if = {
		limit = { ai = no NOT = { has_country_flag = th_had_newspaper_event } capital_scope = { continent = gensokyo_continent } }
		country_event = { id = touhou_news.1 }
	}
	if = {
		limit = {
			has_government_attribute = uses_purified_land
		}
		every_owned_province = {
			if = {
				limit = { has_province_modifier = th_pure_land }
				remove_province_modifier = th_pure_land
			}
			if = {
				limit = { has_province_modifier = th_impure_land }
				remove_province_modifier = th_impure_land
			}
			if = {
				limit = { has_owner_culture = yes }
				add_province_modifier = {
					name = th_pure_land
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_owner_culture = no
					has_owner_accepted_culture = no
				}
				add_province_modifier = {
					name = th_impure_land
					duration = -1
				}
			}
		}
	}
}

# country
on_religion_change = {
	on_religion_change_estate_privileges_effect = yes
	judaism_on_religion_change_effect = yes
	###removes catholic modifiers
		remove_country_modifier = counter_reformation
		remove_country_modifier = the_statue_in_restraint_of_appeals
		remove_country_modifier = revocation_of_restraint_of_appeals
		remove_country_modifier = bavarian_jesuits
		remove_country_modifier = the_societas_jesu
		remove_country_modifier = the_declaration_of_indulgence
		remove_country_modifier = de_heretico_comburendo
		remove_country_modifier = the_conventicle_act
	if = {
		limit = {
			has_reform = indian_sultanate_reform
			NOT = { religion_group = muslim }
		}
		remove_government_reform = indian_sultanate_reform
	}

	if = {
		limit = {
			has_reform = feudal_theocracy
			NOT = { religion_group = muslim }
			NOT = { religion_group = zoroastrian_group }
		}
		remove_government_reform = feudal_theocracy
	}

	if = {
		limit = {
			government = native
			OR = {
				religion = nahuatl
				religion = mesoamerican_religion
				religion = inti
			}
		}
		change_government = monarchy
		add_government_reform = autocracy_reform
	}


	if = {
		limit = {
			has_heir = yes
		}
		set_heir_religion = ROOT
	}
	if = {
		limit = {
			has_regency = no
		}
		set_ruler_religion = ROOT
	}
	if = {
		limit = {
			has_dlc = "Rights of Man"
			has_consort = yes
		}
		set_consort_religion = ROOT
	}
	if = {
		limit = {
			NOT = { religion = orthodox }
		}
		every_known_country = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = closed_down_the_patriarchate
				}
			}
			reverse_remove_opinion = {
				who = ROOT
				modifier = closed_down_the_patriarchate
			}
		}
	}
	if = {
		limit = {
			religion = catholic
			has_ruler_flag = personal_catholic_sympathies
		}
		country_event = { id = protestantism_events.19 }
	}
	if = {
		limit = {
			religion = protestant
		}
		set_country_flag = converted_to_protestantism
	}
	if = {
		limit = {
			religion = hussite
		}
		remove_country_modifier = hussite_persecution
	}
	if = {
		limit = { has_country_modifier = bav_religious_mandate_mod }
		remove_country_modifier = bav_religious_mandate_mod
	}
	add_country_modifier = {
		name = recently_changed_religion_dummy
		duration = 10
		hidden = yes
	}
	if = {
		limit = {
			NOT = { religion_group = muslim }
			any_owned_province = { has_province_modifier = sufi_shrine }
		}
		every_owned_province = {
			limit = { has_province_modifier = sufi_shrine }
			remove_province_modifier = sufi_shrine
		}
	}
	if = {
		limit = {
			religion = shamanism
			has_country_modifier = son_fetishism_as_secondary_religion
		}
		remove_country_modifier = son_fetishism_as_secondary_religion
		every_owned_province = {
			limit = {
				has_province_modifier = son_fetishism_as_secondary_religion_province
			}
			remove_province_modifier = son_fetishism_as_secondary_religion_province
		}
	}
	if = {
		limit = {
			has_government_attribute = th_divine_legitimacy_mechanic
		}
		if = {
			limit = {
				has_country_flag = th_is_excused_to_change_religion
			}
			clr_country_flag = th_is_excused_to_change_religion
		}
		else = {
			country_event = {
				id = th_divine_state.9
			}
		}
	}
	if = {
		limit = {
			has_country_flag = th_pledged_religious_loyalty
		}
		random_known_country = {
			limit = {
				has_country_flag = th_has_gotten_pledged_to_religion_from_@ROOT
			}
			country_event = {
				id = th_diplo_events.10
			}
            clr_country_flag = th_has_gotten_pledged_to_religion_from_@ROOT
		}
	}
	events = {
		muslim_school_events.20 #Pick School
		propagate_religion_events.7 #Propagated Country is now Muslim
	}
}

# country
# root = winning country, from = loser country
on_war_won = {
	FROM = { country_event = { id = flavor_cri.6 } }
	ROOT = { country_event = { id = tributary_events.32 } }
	if = {
		limit = {
			has_country_flag = can_gain_legendary_pirates_flag
			NOT = { has_ruler_flag = historical_pirate }
			has_government_attribute = is_pirate_republic_reform
			FROM = { total_development = ROOT }
		}
		random = {
			chance = 5
			country_event = {
				id = pirates.25
			}
		}
	}
	
	if = {
		limit = {
			is_part_of_hre = yes
			FROM  = { is_part_of_hre = yes }
		}
		ROOT = { save_global_event_target_as = hre_winner }
		FROM = { save_global_event_target_as = hre_loser }
		random_known_country = {
			limit = {
				has_reform = free_city
				NOT = {
					prestige = 40
				}
				NOT = {
					has_country_modifier = fc_treatyconference_timer
				}
			}
			add_country_modifier = {
				name = fc_treatyconference_timer
				duration = 3650
				hidden = yes
			}
			country_event = {
				id = free_cities.7
				days = 7
			}
		}
	}

	if = {
		limit = {
			tag = MLO
			NOT = { has_country_flag = emp_mlo_won_war_with_swiss_mercs }
			any_hired_mercenary_company = {
				home_province = {
					OR = {
						area = switzerland_area
						area = romandie_area
					}
				}
			}
		}
		set_country_flag = emp_mlo_won_war_with_swiss_mercs
	}
	
	if = {
		limit = {
			is_hiring_condottiere_from = SWI
		}
		SWI = { set_country_flag = won_condottiere_war }
		if = {
			limit = {
				tag = PAP
			}
			SWI = {
				set_country_flag = hired_to_pope
			}
		}
	}
	
	if = {
		limit = {
			primary_culture = melanesian
			NOT = { has_country_modifier = warlord_mod }
		}
		FROM = {
			country_event = {
				id = polynesian.17
			}
		}
	}
	if = {
		limit = {
			ROOT = { 
				tag = SWE
				has_country_modifier = swe_vasa_leads_the_rebellion
				is_subject = no
			}
			FROM = { tag = DAN }
		}
		country_event = {
			id = flavor_swe.111
		}
	}
	if = {
		limit = {
			ROOT = { 
				tag = SWE
				has_country_modifier = swe_any_vasa_leads_the_rebellion
				is_subject = no
			}
			FROM = { tag = DAN }
		}
		country_event = {
			id = flavor_swe.105
		}
	}
	if = {
		limit = {
			ROOT = { 
				tag = SWE
				has_country_flag = swe_declared_independence_war
				is_subject = no
			}
			FROM = { tag = DAN }
		}
		country_event = {
			id = flavor_swe.121
		}
	}
	if = {
		limit = {
			has_country_flag = th_lended_weapons_and_war
		}
		clr_country_flag = th_lended_weapons_and_war
		every_known_country = {
			limit = {
				has_country_flag = th_lcu_replace_them_with_lunarians
			}
			if = {
				limit = {
					ROOT = { has_country_flag = th_lended_lunarian_weapons_from_@PREV }
				}
				ROOT = { clr_country_flag = th_lended_lunarian_weapons_from_@PREV }
				country_event = {
					id = th_diplo_events.56
				}
			}
		}
	}
	th_yama_on_war_won_effect = yes
}

# country
# root = winning country, from = loser country
on_battle_won_country = {
	if = {
		limit = {
			ROOT = {
				tag = ALB
				NOT = { has_country_flag = albanian_victory }
			}
			FROM = {
				tag = TUR
			}
		}
		ROOT = { set_country_flag = albanian_victory }
	}
	if = {
		limit = {
			ROOT = {
				religion = jewish
				has_church_aspect = judaism_purim_teachings_aspect
			}
		}
		ROOT = {
			add_war_exhaustion = -0.05
		}
	}
	count_won_battles_and_reward_at_end = {
		counting_flag = teu_crusader_battle_counter
		max_value = 20
		effect = "
			country_event = {
				id = flavor_teu.12
			}
		"
	}
	th_count_won_battles_and_reward_at_end = {
		counting_flag = scr_battle_counter_ready
		variable = scr_battle_counter
		max_value = 30
		country_event = flavor_scr.24	#SCR gets their government reform
	}
	th_count_won_battles_and_reward_at_end = {
		counting_flag = crd_is_counting_battles
		variable = crd_oni_battle_counter
		max_value = 10
		country_event = th_empty_event.1	#No event for CRD
	}
	th_count_won_battles_and_reward_at_end = {
		counting_flag = lcu_counts_battles
		variable = lcu_battle_counter
		max_value = 15
		country_event = th_empty_event.1	#No event for LCU
	}
	if = {
		limit = {
			has_country_modifier = oni_german_beer
		}
		th_add_battle_passion = {
			value = 15
		}
	}
	else = {
		th_add_battle_passion = {
			value = 10
		}
	}
}

# country
# root = loser country, from = winner country
on_battle_lost_country = {
	battle_cult_spreading_effect = yes #Scripted effect for fetishist cult mechanics.
	th_reduce_battle_passion = {
		value = 5
	}
	random_events = {
		90 = 0
		10 = friendship_events.1 #Historical Friendship Broken
	}
}

#Unit Scope OnAction for Battle Won
on_battle_won_unit = {
	if = {
		limit = {
			unit_owner = { ai = no } #Scopes to Unit Owner from Unit Scope
			general_with_steam_name = yes #Unit Scope Trigger
		}
		unit_owner = { set_country_flag = general_with_steam_name_won_battle }
	}
	if = {
		limit = {
			general_with_name = "Damarwulan"
		}
		unit_owner = {
			change_variable = {
				which = DamarwulanWinVariable 
				value = 1
			}
		}
	}
	if = {
		limit = {
			general_with_name = "Damarwulan"
			unit_owner = {
				check_variable = {
					which = DamarwulanWinVariable
					value = 5
				}
			}
		}
		unit_owner = {
			country_event = { id = majapahit.2 days = 2 }
		}
	}
	if = {
		limit = {
			unit_owner = {
				mission_completed = son_military_expertise
				NOT = { mission_completed = son_win_battles }
			}
		}
		unit_owner = {
			change_variable = {
				which = son_fight_counter
				value = 1
			}
		}
		if = {
			limit = {
				is_ruler_commanding_unit = yes
			}
			unit_owner = {
				change_variable = {
					which = son_fight_counter
					value = 1
				}
			}
		}
	}
	if = {
		limit = {
			unit_owner = {
				has_government_attribute = winning_battles_increases_legitimacy
			}
			is_ruler_commanding_unit = yes
		}
		unit_owner = {
			add_legitimacy = 0.5
			add_devotion = 0.5
			add_republican_tradition = 0.1
			add_revolutionary_zeal = 0.1
			add_absolutism = 0.1
		}
	}
	if = {
		limit = {
			unit_owner = {
				th_is_or_was_tag = {
					tag = NET
				}
			}
		}
		if = {
			limit = {
				general_with_name = "Youmu Konpaku"
			}
			unit_owner = {
				change_variable = {
					which = net_battle_counter 
					value = 2
				}
			}
		}
		if = {
			limit = {
				NOT = { general_with_name = "Youmu Konpaku" }
			}
			unit_owner = {
				change_variable = {
					which = net_battle_counter 
					value = 1
				}
			}
		}
	}
	if = {
		limit = {
			unit_owner = {
				has_country_flag = fuj_has_leveling_mokou
			}
			is_ruler_commanding_unit = yes
		}
		unit_owner = {
			change_variable = {
				which = fuj_won_battles_counter
				value = 1
			}
			change_variable = {
				which = fuj_mokou_exp
				value = 10
			}
		}
	}
	if = {
		limit = {
			unit_owner = {
				NOT = { mission_completed = ONI_ruler_honor }
			}
			is_ruler_commanding_unit = yes
		}
		unit_owner = {
			change_variable = {
				which = oni_won_battles_counter
				value = 1
			}
		}
	}
	if = {
		limit = {
			unit_owner = {
				has_government_attribute = th_legitimacy_through_battles
			}
			is_ruler_commanding_unit = yes
		}
		unit_owner = { add_legitimacy = 2 }
	}
}

# #Unit Scope OnAction for Battle Lost
on_battle_lost_unit = {
    if = {
        limit = {
            unit_owner = {
                tag = MNG
                has_ruler_flag = mng_militry_incompetence
            }
            is_ruler_commanding_unit = yes
			enemy_unit = {
				unit_owner = {
					tag = OIR
				}
			}
        }
        OIR = {
            country_event = { id = flavor_oir.2 }
        }
    }
    if = {
        limit = {
            unit_owner = {
				th_is_or_was_tag = {
					tag = FUJ
				}
            }
            is_ruler_commanding_unit = yes
			enemy_unit = {
				unit_owner = {
					th_is_or_was_tag = {
						tag = CIN
					}
					NOT = { has_country_flag = cin_has_won_battle_against_mokou }
				}
			}
		}
		random_country = {
			limit = {
				th_is_or_was_tag = {
					tag = CIN
				}
			}
			set_country_flag = cin_has_won_battle_against_mokou
		}
    }
    if = {
        limit = {
            unit_owner = {
				th_is_or_was_tag = {
					tag = OKR
				}
            }
            is_ruler_commanding_unit = yes
			enemy_unit = {
				unit_owner = {
					th_is_or_was_tag = {
						tag = NET
					}
					NOT = { has_country_flag = net_won_battle_against_meira_in_person }
				}
			}
		}
		random_country = {
			limit = {
				th_is_or_was_tag = {
					tag = NET
				}
			}
			set_country_flag = net_won_battle_against_meira_in_person
		}
    }
}

# country
# root = winning country, from = location
on_siege_won_country = {
	if = {
		limit = {
			from = { owned_by = SAX }
			OR = {
				is_in_war = {
					defenders = root
					defenders = THU
					defenders = emperor
					attackers = SAX
				}
				is_in_war = {
					attackers = root
					attackers = THU
					attackers = emperor
					defenders = SAX
				}
			}
			THU = {
				dynasty = "von Wettin"
				is_elector = no
				is_emperor = no
				alliance_with = emperor
			}
			SAX = {
				is_elector = yes
				all_owned_province = {
					NOT = { controlled_by = SAX }
					OR = {
						controlled_by = THU
						controller = {
							OR = {
								is_in_war = {
									defenders = this
									defenders = THU
									defenders = emperor
									attackers = SAX
								}
								is_in_war = {
									attackers = this
									attackers = THU
									attackers = emperor
									defenders = SAX
								}
							}
						}
					}
				}
			}
		}
		THU = { country_event = { id = flavor_sax.10 } } # Ask Emperor for Saxon Electorate
	}
	if = {
		limit = {
			ROOT = {
				religion = jewish
				has_church_aspect = judaism_remember_passover_aspect
			}
			FROM = {
				owner = {
					war_with = ROOT
				}
				fort_level = 1
			}
		}
		ROOT = {
			add_church_power = 5
		}
	}
	if = {
		limit = { ROOT = { has_government_attribute = th_gains_mp_from_occupations } }
		if = { limit = { FROM = { fort_level = 9 } } ROOT = { add_yearly_manpower = 0.10 } }
		else_if = { limit = { FROM = { fort_level = 8 } } ROOT = { add_yearly_manpower = 0.09 } }
		else_if = { limit = { FROM = { fort_level = 7 } } ROOT = { add_yearly_manpower = 0.08 } }
		else_if = { limit = { FROM = { fort_level = 6 } } ROOT = { add_yearly_manpower = 0.07 } }
		else_if = { limit = { FROM = { fort_level = 5 } } ROOT = { add_yearly_manpower = 0.06 } }
		else_if = { limit = { FROM = { fort_level = 4 } } ROOT = { add_yearly_manpower = 0.05 } }
		else_if = { limit = { FROM = { fort_level = 3 } } ROOT = { add_yearly_manpower = 0.04 } }
		else_if = { limit = { FROM = { fort_level = 2 } } ROOT = { add_yearly_manpower = 0.03 } }
		else_if = { limit = { FROM = { fort_level = 1 } } ROOT = { add_yearly_manpower = 0.02 } }
		else = { ROOT = { add_yearly_manpower = 0.01 } }
	}
	grant_manpower_from_capital_slave_raid = yes
	events = {
		tyw_events.14 # Fall of Prague in Religious War
		flavor_oir.5 # Oirats capture Beijing
		flavor_lna.1 # Emerald Buddha
		flavor_son.14 # Djenne surrenders to Songhai Trigger
		flavor_teu.25 # Payback for the Hussite Wars
	}
	random_events = {
		10 = army_professionalism_events.1 #City Sacked
		10 = flavor_tfr.16 #TFR sacks fort
		100 = 0
	}
}

# OBS: Consider that the following on_actions can be called for Personal Union juniors as well.
# country
on_new_monarch = {
	crimean_succession_effect = yes #Scripted effect
	slesvig_question_effect = yes #Scripted effect
	if = {
		limit = {
			has_consort_regency = no
			any_owned_province = {
				has_province_modifier = domain_of_spouses_family
			}
		}
		every_owned_province = {
			limit = { has_province_modifier = domain_of_spouses_family }
			remove_province_modifier = domain_of_spouses_family
		}
	}
	if = {
		limit = {
			has_consort_regency = no
			any_owned_province = {
				has_province_modifier = home_of_consort
			}
		}
		every_owned_province = {
			limit = { has_province_modifier = home_of_consort }
			remove_province_modifier = home_of_consort
		}
	}
	if = {
		limit = {
			NOT = { has_dlc = "Mandate of Heaven" }
			has_country_modifier = the_mandate_of_heaven
			NOT = { legitimacy = 80 }
		}
		country_event = { id = china_events.32 }	# History of last ruler
	}
	if = {
		limit = {
			religion = jewish
		}
		clr_country_flag = ruler_is_messiah
	}
	if = {
		limit = {
			has_government_attribute = th_can_convert_general_to_ruler
			is_lesser_in_union = no
		}
		if = {
			limit = { is_female = yes } 
			convert_female_ruler_to_general = 50
		}
		else = { convert_ruler_to_general = 50 }
	}
	# ambrosian_republic_effect = yes
	succession_culture_religion_effect = yes
	sheik_ul_islam_effect = yes
	hab_remove_mission_mods_if_not_emperor_effect = yes
	if = {
		limit = {
			is_or_was_tag = {
				tag = TEU
			}
			is_emperor = no
			NOT = { tag = HLR }
			has_country_modifier = teu_pru_imperial_crown
		}
		remove_country_modifier = teu_pru_imperial_crown
	}
	thu_remain_von_wettin_effect = yes
	ladislaus_postumus_union_effect = yes
	if = {
		limit = { has_any_heir_cult_active = yes }
		remove_heir_cult = yes
	}
	if = {
		limit = { 
			has_government_attribute = kalmar_union_succession
			has_regency = no
			has_consort_regency = no
		}
		if = {
			limit = { has_country_flag = dan_new_elected_ruler }
			clr_country_flag = dan_new_elected_ruler
		}
		else = {
			country_event = {
				id = kalmar_union_events.1	# A new king of the Kalmar Union
			}
		}
	}
	if = {
		limit = { has_government_attribute = absolutism_reduction_on_ruler_death }
		add_absolutism = -60
		set_variable = {
			which = election_term
			value = 1
		}
	}
	if = {
		limit = {
			has_government_attribute = th_has_questioned_legitimacy
			legitimacy = 50
		}
		add_legitimacy = -100
		add_legitimacy = 50
	}
	if = {
		limit = {
			has_government_attribute = th_legitimacy_through_battles
			NOT = { has_government_attribute = th_has_oni_succession }
			NOT = { is_monarch_leader = yes }
		}
		if = {
			limit = { is_female = yes } 
			convert_female_ruler_to_general = 50
		}
		else = { convert_ruler_to_general = 50 }
	}
	if = {
		limit = { has_government_attribute = th_has_kappa_elections }
		set_variable = {
			which = election_term
			value = 1
		}
	}
	events = {
		tribal_succession.1		# Harsh anti-tribals.
		9492 					# Remove some event modifiers
		flavor_boh.8			# Winter King in Prague
		flavor_kol.1			# Bavarian Archbishop
		war_of_the_roses.101	# WotR - House of Lancaster wins
		war_of_the_roses.102	# WotR - House of York wins
		war_of_the_roses.106	# WotR - Another dynasty has seized the throne
		flavor_tur.102			# Janissary Reward
		flavor_ori.7			# Hamvira Victorious
		flavor_kbo.1			# The two branches of the Sayfawa dynasty
		flavor_kbo.8			# Sayfawa pretenders
		flavor_zan.5			# Coup of Coup of Suleiman and Muhammad al-Mazlum.
		purple_phoenix.1		# BYZ pretenders
		flavor_pol.3480			# The Pacta Conventa
		protestantism_events.15	# Catholic Leaning Monarch
		tengri_events.17		# Keep the Khojas in Power?
		flavor_tus.15			# Savonarola Dies
		flavor_brapru.22		# Succession of Albrecht Achilles
		flavor_brapru.25		# Dispositio Achillea (can also trigger from flavor_brapru.22)
		flavor_nor.27			# Proclamation in Hamar
		china_events.43			# Picking new Capital for China
		celestial_empire_events.3 #Resistance to Sinicization
		flavor_boh.2			#Heretic Kings
		flavor_hun.17			#Maintaining the Black Army
		flavor_tim.1			#Death of Shah Rukh
		muslim_school_events.20 #No Religious School
		flavor_daimyo.4			#Shiba Yoshikado
		flavor_fra.9000			# Fran√ßois Villon
		flavor_fuj.106			# Ruler becomes immediately a leveling general
		flavor_sca.2			# Education Focus of the new Ruler
		th_oni_succession.1		# Oni Succession mechanic
	}
	random_events = {
		1000 = 0
		100 = flavor_kol.1		# Bavarian Archbishop
		100 = flavor_hsa.3		# Hansa: Tagfahrt
		100 = inti_events.1		# Birth of a Panaca
		50 = dynastic_events.4
		50 = dynastic_events.5
		25 = harem_events.7		#Failed Policy of Fratricide
	}
}

# country
on_monarch_death = {
	if = {
		limit = {
			tag = ANS
			BRA = {
				has_country_flag = albrecht_achilles_flag
			}
		}
		BRA = {
			clr_country_flag = albrecht_achilles_flag #Just to be sure
			kill_heir = {} #If Albrecht Achilles dies in Ansbach he will also be dead in Brandenburg, will appear as normal death of heir to BRA.
		}
	}
	if = {
		limit = { has_country_modifier = sought_after_bachelor }
		remove_country_modifier = sought_after_bachelor
	}
	if = {
		limit = {
			tag = SAX
			has_country_flag = sax_thuringen_split_to_happen
			OR = {
				NOT = { dynasty = "von Wettin" }
				NOT = { senior_union_with = THU }
				has_regency = yes
			}
		}
		clr_country_flag = sax_thuringen_split_to_happen
	}
	if = {
		limit = { tag = SAM }
		country_event = { id = polynesian.35 }
	}
	if = {
		limit = { tag = TOG }
		country_event = { id = polynesian.36 }
	}
	if = {	# Ascension of Trailokanat	
		limit = { tag = AYU }
		country_event = { id = flavor_suk.1 }		 			
	}
	if = {
		limit = { tag = GOT }
		country_event = { id = flavor_got.37 }
	}
	if = {
		limit = { has_government_attribute = no_stability_loss_on_monarch_death }
		add_stability = 1
	}
	burgundian_inheritance_start_effect = yes
	ladislaus_postumus_king_died_effect = yes
	joan_de_trastamara_king_died_effect = yes
	events = {
		flavor_wal.1 # Vlad the Impaler. So that he doesn't try to usurp his father.
		flavor_nav.4 # Navarra succession event
		flavor_sax.8 # Treaty of Leipzig
		flavor_pap.16 # Borgia Pope
		flavor_pap.19 # death of borgia pope
		flavor_tus.22 # Medici Pope
		flavor_tus.24 # death of the Medici Pope
		majapahit.8 # Majapahit pretenders
		flavor_mal.11 # Mali pretenders
		flavor_mal.47 # Pilgrimage ends prematurely
		th_samurai_succession.1 # Special samurai succession
	}
}

# country
on_new_term_election = {
	events = {
		700		# Election event
		elections.720		# Dutch Republic
		elections.800	# Lottery election
		pirates.1
		fairy_elections.1
		flavor_kpp.1
		flavor_kpp.61
	}
}

# country
on_death_election = {
	if = {
		limit = { has_reform = presidential_despot_reform }
		remove_government_reform = presidential_despot_reform
	}
	if = {
		limit = {
			has_government_attribute = is_pirate_republic_reform
		}
		set_country_flag = pirate_death_election
		country_event = { id = pirates.1 }
	}
	events = {
		701		# Election event
		elections.721		# Dutch Republic
		elections.800	# Lottery election
		flavor_tus.16 #Savonarola Leaves This World
		fairy_elections.2
		flavor_kpp.2
		flavor_kpp.62
	}
}

# country : no heir in theocracy
on_heir_needed_theocracy = {
	events = {
		flavor_sca.2
		theocracy.1
		touhou_theocracy.1
	}
}

# province
on_adm_development = {
	if = {
		limit = { owner = { has_country_flag = enable_supplemental_development_flag } }
		random_list = {
			20 = { add_base_tax = 1 }
			80 = { }
		}
	}
	if = {
		limit = { 
			owner = { has_country_modifier = lit_increased_dev_modifier }
		}
		add_base_tax = 1 
	}
	if = {
		limit = {
			owner = {
				OR = {
					AND = {
						has_government_attribute = th_can_overload_provinces
						has_country_modifier = th_hellfairy_provinces_to_overload
					}
					AND = {
						is_subject = yes
						overlord = {
							has_government_attribute = th_can_overload_provinces
							has_country_modifier = th_hellfairy_provinces_to_overload
						}
					}
				}
			}
		}
		add_base_tax = -1
		if = {
			limit = {
				NOT = { NOT = { has_province_modifier = th_province_overloaded } }
			}
			add_province_modifier = {
				name = th_province_overload
				duration = 1825
			}
			add_province_modifier = {
				name = th_province_overloaded
				duration = 5475
			}
		}
	}
	if = {
		limit = {
			has_province_modifier = th_province_to_mark
		}
		owner = {
			clr_country_flag = th_activated_province_drain
		}
		every_province = {
			limit = {
				has_province_modifier = th_province_to_drain
				owned_by = FROM
			}
			remove_province_modifier = th_province_to_drain
		}
		every_province = {
			limit = {
				has_province_modifier = th_province_to_mark
				owned_by = FROM
			}
			remove_province_modifier = th_province_to_mark
		}
		add_base_tax = -1
		area = {
			limit = {
				owned_by = FROM
				is_territory = yes
				development = 4
			}
			add_province_modifier = {
				name = th_province_to_drain
				duration = -1
			}
		}
		owner = {
			add_adm_power = 5
		}
	}
	if = {
		limit = {
			owner = { has_country_modifier = th_hunt_for_the_impure }
		}
		add_base_tax = -1
		if = {
			limit = { 
				has_owner_culture = no 
				nationalism = 1 
				owner = { is_at_war = no }
			}
			add_nationalism = -5
			create_revolt = 1
		}
	}
	th_wandering_state_on_development = { base_type = base_tax }
}

# province
on_dip_development = {
	if = {
		limit = { owner = { has_country_flag = enable_supplemental_development_flag } }
		random_list = {
			20 = { add_base_production = 1 }
			80 = { }
		}
	}
	if = {
		limit = { 
			owner = { has_country_modifier = lit_increased_dev_modifier }
		}
		add_base_production = 1 
	}
	if = {
		limit = {
			owner = {
				OR = {
					AND = {
						has_government_attribute = th_can_overload_provinces
						has_country_modifier = th_hellfairy_provinces_to_overload
					}
					AND = {
						is_subject = yes
						overlord = {
							has_government_attribute = th_can_overload_provinces
							has_country_modifier = th_hellfairy_provinces_to_overload
						}
					}
				}
			}
		}
		add_base_production = -1
		if = {
			limit = {
				NOT = { NOT = { has_province_modifier = th_province_overloaded } }
			}
			add_province_modifier = {
				name = th_province_overload
				duration = 1825
			}
			add_province_modifier = {
				name = th_province_overloaded
				duration = 5475
			}
		}
	}
	if = {
		limit = {
			has_province_modifier = th_province_to_mark
		}
		owner = {
			clr_country_flag = th_activated_province_drain
		}
		every_province = {
			limit = {
				has_province_modifier = th_province_to_drain
				owned_by = FROM
			}
			remove_province_modifier = th_province_to_drain
		}
		every_province = {
			limit = {
				has_province_modifier = th_province_to_mark
				owned_by = FROM
			}
			remove_province_modifier = th_province_to_mark
		}
		add_base_production = -1
		area = {
			limit = {
				owned_by = FROM
				is_territory = yes
				development = 4
			}
			add_province_modifier = {
				name = th_province_to_drain
				duration = -1
			}
		}
		owner = {
			add_dip_power = 5
		}
	}
	if = {
		limit = {
			owner = { has_country_modifier = th_hunt_for_the_impure }
		}
		add_base_production = -1
		if = {
			limit = { 
				has_owner_culture = no 
				nationalism = 1 
				owner = { is_at_war = no }
			}
			add_nationalism = -5
			create_revolt = 1
		}
	}
	th_wandering_state_on_development = { base_type = base_production }
}

# province
on_mil_development = {
	if = {
		limit = { owner = { has_country_flag = enable_supplemental_development_flag } }
		random_list = {
			20 = { add_base_manpower = 1 }
			80 = { }
		}
	}
	if = {
		limit = { 
			owner = { has_country_modifier = lit_increased_dev_modifier }
		}
		add_base_manpower = 1 
	}
	if = {
		limit = {
			owner = {
				OR = {
					AND = {
						has_government_attribute = th_can_overload_provinces
						has_country_modifier = th_hellfairy_provinces_to_overload
					}
					AND = {
						is_subject = yes
						overlord = {
							has_government_attribute = th_can_overload_provinces
							has_country_modifier = th_hellfairy_provinces_to_overload
						}
					}
				}
			}
		}
		add_base_manpower = -1
		if = {
			limit = {
				NOT = { NOT = { has_province_modifier = th_province_overloaded } }
			}
			add_province_modifier = {
				name = th_province_overload
				duration = 1825
			}
			add_province_modifier = {
				name = th_province_overloaded
				duration = 5475
			}
		}
	}
	if = {
		limit = {
			has_province_modifier = th_province_to_mark
		}
		owner = {
			clr_country_flag = th_activated_province_drain
		}
		every_province = {
			limit = {
				has_province_modifier = th_province_to_drain
				owned_by = FROM
			}
			remove_province_modifier = th_province_to_drain
		}
		every_province = {
			limit = {
				has_province_modifier = th_province_to_mark
				owned_by = FROM
			}
			remove_province_modifier = th_province_to_mark
		}
		add_base_manpower = -1
		area = {
			limit = {
				owned_by = FROM
				is_territory = yes
				development = 4
			}
			add_province_modifier = {
				name = th_province_to_drain
				duration = -1
			}
		}
		owner = {
			add_mil_power = 5
		}
	}
	if = {
		limit = {
			owner = { has_country_modifier = th_hunt_for_the_impure }
		}
		add_base_manpower = -1
		if = {
			limit = { 
				has_owner_culture = no 
				nationalism = 1 
				owner = { is_at_war = no }
			}
			add_nationalism = -5
			create_revolt = 1
		}
	}
	th_wandering_state_on_development = { base_type = base_manpower }
}


on_monthly_pulse = {
}
on_yearly_pulse = {
}

on_thri_yearly_pulse_4 = {
	random_events = {
		#Low Mandate Events
		10 = china_events.45
		10 = china_events.46
		50 = china_events.47
		10 = china_events.48
		10 = china_events.49
		10 = china_events.50
		50 = china_events.51
		10 = china_events.52
		10 = china_events.53
		50 = china_events.54
		#10 = china_events.55 (triggers via neighbors)
		10 = china_events.56
		75 = china_events.57
		50 = china_events.58
		10 = china_events.59
		50 = china_events.60
	}	

	events = {
		th_sixty_year_cycle_incident_events.2
	}
}

on_four_year_pulse_4 = {
	random_events = {
		100 = touhou_events.3
		1000 = 0
	}
}

on_five_year_pulse = {
	random_events = {

		# Innovativeness Events

		100 = innovativeness_events.1

		# Aristocracy 		13  (8g 5b)
		100 = ideagroups.100
		100 = ideagroups.101
		100 = ideagroups.102
		100 = ideagroups.103
		100 = ideagroups.104
		100 = ideagroups.105
		100 = ideagroups.106
		100 = ideagroups.107
		100 = ideagroups.108
		100 = ideagroups.109
		100 = ideagroups.110
		100 = ideagroups.111
		100 = ideagroups.112


		# Plutocracy 		19 (12g 7b)
		100 = ideagroups.200
		100 = ideagroups.201
		100 = ideagroups.202
		100 = ideagroups.203
		100 = ideagroups.204
		100 = ideagroups.205
		100 = ideagroups.206
		100 = ideagroups.207
		100 = ideagroups.208
		100 = ideagroups.209
		100 = ideagroups.210
		100 = ideagroups.211
		100 = ideagroups.212
		100 = ideagroups.213
		100 = ideagroups.214
		100 = ideagroups.215
		100 = ideagroups.216
		100 = ideagroups.217
		100 = ideagroups.218

		# Innovativenes		11 (7g 4b)
		100 = ideagroups.300
		100 = ideagroups.301
		100 = ideagroups.302
		100 = ideagroups.303
		100 = ideagroups.304
		100 = ideagroups.305
		100 = ideagroups.306
		100 = ideagroups.307
		100 = ideagroups.308
		100 = ideagroups.309
		100 = ideagroups.310

		# Religious		18 (11g 7b)
		100 = ideagroups.400
		100 = ideagroups.401
		100 = ideagroups.402
		100 = ideagroups.403
		100 = ideagroups.404
		100 = ideagroups.405
		100 = ideagroups.406
		100 = ideagroups.407
		100 = ideagroups.408
		100 = ideagroups.409
		100 = ideagroups.410
		100 = ideagroups.411
		100 = ideagroups.412
		100 = ideagroups.413
		100 = ideagroups.414
		100 = ideagroups.415
		100 = ideagroups.416
		100 = ideagroups.417


		# Spy			9 (6g 3b)
		100 = ideagroups.500
		100 = ideagroups.501
		100 = ideagroups.502
		100 = ideagroups.503
		100 = ideagroups.504
		100 = ideagroups.505
		100 = ideagroups.506
		100 = ideagroups.507
		100 = ideagroups.508


		# Diplomatic		9 (6g 3b)
		100 = ideagroups.600
		100 = ideagroups.601
		100 = ideagroups.602
		100 = ideagroups.603
		100 = ideagroups.604
		100 = ideagroups.605
		100 = ideagroups.606
		100 = ideagroups.607
		100 = ideagroups.608


		# Offensive 		14 (9g 5b)
		100 = ideagroups.700
		100 = ideagroups.701
		100 = ideagroups.702
		100 = ideagroups.703
		100 = ideagroups.704
		100 = ideagroups.705
		100 = ideagroups.706
		100 = ideagroups.707
		100 = ideagroups.708
		100 = ideagroups.709
		100 = ideagroups.710
		100 = ideagroups.711
		100 = ideagroups.712
		100 = ideagroups.713


		# Defensive		11 (5g 6b)
		100 = ideagroups.800
		100 = ideagroups.801
		100 = ideagroups.802
		100 = ideagroups.803
		100 = ideagroups.804
		100 = ideagroups.805
		100 = ideagroups.806
		100 = ideagroups.807
		100 = ideagroups.808
		100 = ideagroups.809
		100 = ideagroups.810
		100 = ideagroups.811
		100 = ideagroups.812
		100 = ideagroups.813
		100 = ideagroups.814
		100 = ideagroups.815


		# Trade			6 (7g 4b)
		100 = ideagroups.900
		100 = ideagroups.901
		100 = ideagroups.902
		100 = ideagroups.903
		100 = ideagroups.904
		100 = ideagroups.905
		100 = ideagroups.906
		100 = ideagroups.907
		100 = ideagroups.908
		100 = ideagroups.909
		100 = ideagroups.910

		# Maritime			22 (14g 8b)
		100 = ideagroups.1000
		100 = ideagroups.1001
		100 = ideagroups.1002
		100 = ideagroups.1003
		100 = ideagroups.1004
		100 = ideagroups.1005
		100 = ideagroups.1006
		100 = ideagroups.1007
		100 = ideagroups.1008
		100 = ideagroups.1009
		100 = ideagroups.1010
		100 = ideagroups.1011
		100 = ideagroups.1012
		100 = ideagroups.1013
		100 = ideagroups.1014
		100 = ideagroups.1015
		100 = ideagroups.1016
		100 = ideagroups.1017
		100 = ideagroups.1018
		100 = ideagroups.1019
		100 = ideagroups.1020
		100 = ideagroups.1021

		# Economic		11 (7g 4b)
		100 = ideagroups.1100
		100 = ideagroups.1101
		100 = ideagroups.1102
		100 = ideagroups.1103
		100 = ideagroups.1104
		100 = ideagroups.1105
		100 = ideagroups.1106
		100 = ideagroups.1107
		100 = ideagroups.1108
		100 = ideagroups.1109
		100 = ideagroups.1110

		# Exploration		11 (7g 4b)
		100 = ideagroups.1200
		100 = ideagroups.1201
		100 = ideagroups.1202
		100 = ideagroups.1203
		100 = ideagroups.1204
		100 = ideagroups.1205
		100 = ideagroups.1206
		100 = ideagroups.1207
		100 = ideagroups.1208
		100 = ideagroups.1209
		100 = ideagroups.1210

		# Quality		11 (7g 4b)
		100 = ideagroups.1300
		100 = ideagroups.1301
		100 = ideagroups.1302
		100 = ideagroups.1303
		100 = ideagroups.1304
		100 = ideagroups.1305
		100 = ideagroups.1306
		100 = ideagroups.1307
		100 = ideagroups.1308
		100 = ideagroups.1309
		100 = ideagroups.1310

		# Quantity		11 (7g 4b)
		100 = ideagroups.1400
		100 = ideagroups.1401
		100 = ideagroups.1402
		100 = ideagroups.1403
		100 = ideagroups.1404
		100 = ideagroups.1405
		100 = ideagroups.1406
		100 = ideagroups.1407
		100 = ideagroups.1408
		100 = ideagroups.1409
		100 = ideagroups.1410


		# Expansion		11 (7g 4b)
		100 = ideagroups.1500
		100 = ideagroups.1501
		100 = ideagroups.1502
		100 = ideagroups.1503
		100 = ideagroups.1504
		100 = ideagroups.1505
		100 = ideagroups.1506
		100 = ideagroups.1507
		100 = ideagroups.1508
		100 = ideagroups.1509
		100 = ideagroups.1510

		# Administrative	3 (1g 2b)
		100 = ideagroups.1600
		100 = ideagroups.1601
		100 = ideagroups.1602
		100 = ideagroups.1603
		100 = ideagroups.1604
		100 = ideagroups.1605
		100 = ideagroups.1606
		100 = ideagroups.1607
		100 = ideagroups.1608
		100 = ideagroups.1609
		100 = ideagroups.1610

		# Naval		11 (7g 4b)
		100 = ideagroups.1700
		100 = ideagroups.1701
		100 = ideagroups.1702
		100 = ideagroups.1703
		100 = ideagroups.1704
		100 = ideagroups.1705
		100 = ideagroups.1706
		100 = ideagroups.1707
		100 = ideagroups.1708
		100 = ideagroups.1709
		100 = ideagroups.1710

		# Influence		11 (7g 4b)
		100 = ideagroups.1800
		100 = ideagroups.1801
		100 = ideagroups.1802
		100 = ideagroups.1803
		100 = ideagroups.1804
		100 = ideagroups.1805
		100 = ideagroups.1806
		100 = ideagroups.1807
		100 = ideagroups.1808
		100 = ideagroups.1809
		100 = ideagroups.1810

		# Humanist		11 (7g 4b)
		100 = ideagroups.1900
		100 = ideagroups.1901
		100 = ideagroups.1902
		100 = ideagroups.1903
		100 = ideagroups.1904
		100 = ideagroups.1905
		100 = ideagroups.1906
		100 = ideagroups.1907
		100 = ideagroups.1908
		100 = ideagroups.1909
		100 = ideagroups.1910

		# Horde Ideas		10 (8g 2b)
		100 = ideagroups.1922
		100 = ideagroups.1923
		100 = ideagroups.1924
		100 = ideagroups.1925
		100 = ideagroups.1926
		100 = ideagroups.1927
		100 = ideagroups.1928
		100 = ideagroups.1929
		100 = ideagroups.1930
		100 = ideagroups.1931
		
		#Theocracy Ideas		11 (9g 2b)
		100 = ideagroups.1911
		100 = ideagroups.1912
		100 = ideagroups.1913
		100 = ideagroups.1914
		100 = ideagroups.1915
		100 = ideagroups.1916
		100 = ideagroups.1917
		100 = ideagroups.1918
		100 = ideagroups.1919
		100 = ideagroups.1920
		100 = ideagroups.1921

		# Indigenous		10 (6g 4b)
		100 = ideagroups.1932
		100 = ideagroups.1933
		100 = ideagroups.1934
		100 = ideagroups.1935
		100 = ideagroups.1936
		100 = ideagroups.1937
		100 = ideagroups.1938
		100 = ideagroups.1939
		100 = ideagroups.1940
		100 = ideagroups.1941

		# Kappa events
		100 = flavor_kpp.20
		100 = flavor_kpp.21
		100 = flavor_kpp.22
		100 = flavor_kpp.23
		
		1000 = 0
	}

	events = {
		seven_cities_events.1000 #Clearing of Seven Cities Hunt when goal is no longer possible
	}
}

on_five_year_pulse_3 = {
	random_events = {
		100 = estate_regency_events.2
		100 = estate_regency_events.3
		100 = estate_regency_events.4
		100 = estate_regency_events.5
		100 = estate_regency_events.6
		100 = estate_regency_events.7
		100 = estate_regency_events.9
		100 = propagate_religion_events.1
		100 = propagate_religion_events.2
		100 = propagate_religion_events.3
		100 = propagate_religion_events.4
		100 = propagate_religion_events.5
		100 = propagate_religion_events.6
		100 = propagate_religion_events.8
		100 = propagate_religion_events.9
		100 = propagate_religion_events.10
		#100 = propagate_religion_events.11 #Province event
		1000 = 0
	}
	events = {
		th_diplo_events.17
	}
}

# province
on_province_religion_converted = {
	on_province_religion_converted_estate_privileges_effect = yes
	th_on_province_religion_converted_effect = yes
	if = {
		limit = {
			owner = {
				has_country_modifier = son_fetishism_as_secondary_religion
			}
			religion = shamanism
			NOT = { has_province_modifier = son_fetishism_as_secondary_religion_province }
		}
		add_province_modifier = {
			name = son_fetishism_as_secondary_religion_province
			duration = -1
			desc = son_fetishism_as_secondary_religion_province_desc
		}
	}
	else_if = {
		limit = {
			OR = {
				owner = {
					NOT = { has_country_modifier = son_fetishism_as_secondary_religion }
				}
				NOT = { religion = shamanism }
			}
			has_province_modifier = son_fetishism_as_secondary_religion_province
		}
		remove_province_modifier = son_fetishism_as_secondary_religion_province
	}
	judaism_on_province_change_religion_or_change_owner_effect = yes
	if = {
		limit = {
			religion = th_moriyashinto
		}
		mry_add_scaled_province_conversion_faith_power = {
			value = 1
			development_factor = 0.25
		}
	}
}

# province
on_province_culture_converted = {
	on_province_culture_converted_estate_privilges_effect = yes
	judaism_on_province_culture_converted_effect = yes
	imperial_modifiers_on_province_change_culture_or_change_owner_effect = yes
	th_on_province_culture_change_effect = yes
}

# province
# FROM = old owner
on_province_owner_change = {
	events = {
		japan.1
	}
	on_province_owner_change_government_effect = yes

	if = {
		limit = {
			owned_by = SRU
			exists = ARA
		}
		ARA = {
			set_country_flag = ARA_defeat_saruhan
		}
	}
	if = {
		limit = {
			NOT = { owner = { religion_group = muslim } }
			has_province_modifier = sufi_shrine
		}
		remove_province_modifier = sufi_shrine
	}
	on_province_owner_change_estate_privileges_effect = yes
	judaism_on_province_change_religion_or_change_owner_effect = yes
	imperial_modifiers_on_province_change_culture_or_change_owner_effect = yes
	th_on_province_owner_change_effect = yes
	th_on_province_owner_change_estate_privileges_effect = yes
	
	if = {
		limit = {
			region = indo_china_region
			has_building = farm_estate
			trade_goods = grain
			owner = {
				has_mission = mnd_khm_irrigation 
				NOT = {
					OR = {
						has_estate = estate_vaisyas
						has_estate = estate_burghers
					}
				}
			}
		}
		add_province_modifier = {
			name = grain_production_improved
			duration = 7300
		}
	}

	if = {
		limit = {
			trade_goods = gold
			NOT = { has_province_modifier = estate_burghers_control_over_gold_mine }
			owner = {
				has_estate_privilege = estate_burghers_control_over_the_mint
			}
		}
		add_province_modifier = {
			name = estate_burghers_control_over_gold_mine
			duration = -1
		}
	}
	if = {
		limit = {
			owner = {
				has_country_modifier = son_fetishism_as_secondary_religion
			}
			religion = shamanism
			NOT = { has_province_modifier = son_fetishism_as_secondary_religion_province }
		}
		add_province_modifier = {
			name = son_fetishism_as_secondary_religion_province
			duration = -1
			desc = son_fetishism_as_secondary_religion_province_desc
		}
	}
	
	if = {
		limit = {
			province_id = 379
			owner = {
				NOT = { religion = jewish }
			}
		}
		remove_country_modifier = third_temple_country_modifier
	}
	if = {
		limit = {
			owner = {
				has_country_modifier = son_fetishism_as_secondary_religion
			}
			religion = shamanism
			NOT = { has_province_modifier = son_fetishism_as_secondary_religion_province }
		}
		add_province_modifier = {
			name = son_fetishism_as_secondary_religion_province
			duration = -1
			desc = son_fetishism_as_secondary_religion_province_desc
		}
	}
	else_if = {
		limit = {
			OR = {
				owner = {
					NOT = { has_country_modifier = son_fetishism_as_secondary_religion }
				}
				NOT = { religion = shamanism }
			}
			has_province_modifier = son_fetishism_as_secondary_religion_province
		}
		remove_province_modifier = son_fetishism_as_secondary_religion_province
	}
	mki_apply_all_tolerance_on_province_effect = yes
	mki_apply_all_religion_on_province_effect = yes
}

# country
on_harmonized_Touhou = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.1
	}
}
on_harmonized_th_hakureishinto = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.2
	}
}
on_harmonized_th_moriyashinto = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.3
	}
}
on_harmonized_th_taoist = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.4
	}
}
on_harmonized_eastern = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.5
	}
}
on_harmonized_th_oldhakurei = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.6
	}
}
on_harmonized_th_shinkism = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.7
	}
}
on_harmonized_th_christian = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.8
	}
}
on_harmonized_th_lunarian_religion = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.9
	}
}
on_harmonized_lunarian_religion_g = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		th_confucian_events.10
	}
}

# THIS = Province, FROM = Country, ROOT = Merc Unit
on_mercenary_recruited = {
	if = {
		limit = {
			FROM = { has_not_free_mercs_trait = yes }
			is_not_free_merc_company = yes
			OR = {
				FROM = { NOT = { has_country_flag = oyo_cavalry_do_not_consume_ap } }
				ROOT = { NOT = { mercenary_company = merc_oyo_cavalry } }
			}
		}
		if = {
			limit = {
				FROM = { has_country_flag = th_pay_mil_instead_of_prof }
			}
			FROM = {
				add_mil_power = -150
			}
		}
		else_if = {
			limit = {
				FROM = { 
					OR = {
						has_country_flag = fifty_percent_merc_army_professionalism_cost 
						has_country_modifier = pol_cheap_ap_mercs_modifier
					}
				}
			}
			FROM = {
				add_army_professionalism = -0.025
			}
		}
		else_if = {
			limit = {
				FROM = { has_country_flag = th_merc_eighty_percent_professionalism_cost }
			}
			FROM = {
				add_army_professionalism = -0.04
			}
		}
		else = {
			FROM = {
				add_army_professionalism = -0.05
			}
		}
	}
	
	if = {
		limit = {
			FROM = {
				has_country_flag = th_merc_suppress_revolt
			}
		}
		THIS = {
			add_province_modifier = {
				name = th_suppresed_revolters
				duration = 1825
			}
		}
	}
	if = {
		limit = {
			FROM = {
				has_country_flag = th_enabled_instant_loot_on_merc_recruitment
			}
			THIS = {
				controlled_by = FROM
				NOT = { owned_by = FROM }
			}
		}
		THIS = {
			remove_loot = {
				who = FROM
				amount = 250
			}
		}
	}
}

# THIS = One province in the state
on_add_pasha = {
	if = {
		limit = {
			owner = {
				has_government_attribute = pashas_purify_land
			}
		}
		hidden_effect = {
			owner = {
				save_event_target_as = province_owner
			}
		}
		area = {
			limit = { owned_by = event_target:province_owner }
			add_province_modifier = { name = th_purifying_pasha duration = -1 }
		}
	}
}

# THIS = One province in the state
on_remove_pasha = {
	hidden_effect = {
		owner = {
			save_event_target_as = province_owner
		}
	}

	area = {
		limit = { owned_by = event_target:province_owner }
		add_or_extend_province_modifier_effect = { MODIFIER = pasha_removed_modifier DURATION = 3650 }
		remove_province_modifier = th_purifying_pasha
	}
}

on_culture_promoted = {
	on_culture_promoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_culture_country_effect = yes
	if = {
		limit = {
			has_government_attribute = uses_purified_land
		}
		every_owned_province = {
			if = {
				limit = { has_province_modifier = th_pure_land }
				remove_province_modifier = th_pure_land
			}
			if = {
				limit = { has_province_modifier = th_impure_land }
				remove_province_modifier = th_impure_land
			}
			if = {
				limit = { has_owner_culture = yes }
				add_province_modifier = {
					name = th_pure_land
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_owner_culture = no
					has_owner_accepted_culture = no
				}
				add_province_modifier = {
					name = th_impure_land
					duration = -1
				}
			}
		}
	}
}

on_culture_demoted = {
	on_culture_demoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_culture_country_effect = yes
	on_culture_demoted_effect = yes
	if = {
		limit = {
			has_government_attribute = uses_purified_land
		}
		every_owned_province = {
			if = {
				limit = { has_province_modifier = th_pure_land }
				remove_province_modifier = th_pure_land
			}
			if = {
				limit = { has_province_modifier = th_impure_land }
				remove_province_modifier = th_impure_land
			}
			if = {
				limit = { has_owner_culture = yes }
				add_province_modifier = {
					name = th_pure_land
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_owner_culture = no
					has_owner_accepted_culture = no
				}
				add_province_modifier = {
					name = th_impure_land
					duration = -1
				}
			}
		}
	}
}

on_primary_culture_changed = {
	on_primary_culture_changed_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_primary_culture_change_effect = yes
	if = {
		limit = {
			has_government_attribute = uses_purified_land
		}
		every_owned_province = {
			if = {
				limit = { has_province_modifier = th_pure_land }
				remove_province_modifier = th_pure_land
			}
			if = {
				limit = { has_province_modifier = th_impure_land }
				remove_province_modifier = th_impure_land
			}
			if = {
				limit = { has_owner_culture = yes }
				add_province_modifier = {
					name = th_pure_land
					duration = -1
				}
			}
			else_if = {
				limit = {
					has_owner_culture = no
					has_owner_accepted_culture = no
				}
				add_province_modifier = {
					name = th_impure_land
					duration = -1
				}
			}
		}
	}
}

# ROOT = Overlord, FROM = Minor
on_dependency_gained = {
	if = {
		limit = {
			FROM = {
				has_reform = dutch_republic
			}
		}
		ROOT = {
			country_event = {
				id = dutch_republic.31
			}# States General falls under a PU
		}
	}
	if = {
		limit = {
			FROM = {
				OR = {
					is_subject_of_type = th_yukari_daimyo
					is_subject_of_type = th_yukari_puppet_state
					is_subject_of_type = th_yukari_march
					is_subject_of_type = th_special_march
					is_subject_of_type = th_satori_vassal
					is_subject_of_type = th_mokou_daimyo
					is_subject_of_type = th_trade_union
					is_subject_of_type = th_yuuka_gatekeeper
					is_subject_of_type = th_pet_state
					is_subject_of_type = th_sister_state
					is_subject_of_type = th_yama_subject_to_law
					is_subject_of_type = th_yama_executor
					is_subject_of_type = th_shinigami_subject
				}
			}
		}
		FROM = {
			set_country_flag = th_has_been_special_subject
		}
	}
}

# ROOT = Overlord, FROM = Minor
on_dependency_lost = {
	if = {
		limit = {
			FROM = {
				has_country_flag = th_has_been_special_subject
			}
		}
		clr_country_flag = th_has_been_special_subject
	}
}

# ROOT = New vassal, FROM = Overlord
on_create_vassal = {
	on_religion_change_estate_privileges_effect = yes
	if = {
		limit = {
			FROM = {
				OR = {
					has_reform = Gensokyan_fairy_government
					has_reform = Gensokyan_clownpiece_tribal_government
				}
				is_revolutionary = no
			}
			NOT = { tag = PAP }
			NOT = { culture = Fairy }
			th_ds_is_not_divine_state_nation = yes
		}
		change_government = monarchy
	}
	if = {
		limit = {
			FROM = {
				OR = {
					has_reform = Gensokyan_fairy_government
					has_reform = Gensokyan_clownpiece_tribal_government
				}
				is_revolutionary = no
			}
			NOT = { tag = PAP }
			culture = Fairy
			th_ds_is_not_divine_state_nation = yes
		}
		change_government = tribal
		add_government_reform = Gensokyan_fairy_government
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			th_ds_is_divine_state_nation = yes
		}
		change_government = monarchy
		add_government_reform = Gensokyan_divine_state
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			has_dlc = "Emperor"
			FROM = {
				is_revolutionary = yes
			}
		}
		change_government = republic
		add_government_reform = junior_revolutionary_republic_reform
		set_country_flag = had_revolution
	}
	if = {
		limit = {
			tag = PAP
		}
		change_government = theocracy
		change_religion = catholic
		add_government_reform = papacy_reform
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			tag = HIG
		}
		change_government = monarchy
		add_government_reform = Gensokyan_hig_yama_government
		adopt_reform_progress = FROM
		save_global_event_target_as = YamaOfGensokyo
	}
}

# THIS = Raiding country, FROM = Sea province
on_raid_coast = {
	if = {
		limit = {
			has_faction = pr_buccaneers
		}
		add_faction_influence = {
			faction = pr_buccaneers
			influence = 1
		}
	}
	if = {
		limit = {
			has_government_attribute = raiding_increases_pp
		}
		add_power_projection = {
			type = high_sea_power_projection
			amount = 1
		}
	}
	if = {
		limit = {
			has_mission = dan_raid_the_north_sea
			NOT = { mission_completed = dan_raid_the_north_sea } 
		}
		change_variable = {
			which = num_of_raided_coasts
			value = 1
		}
	}
	if = {
		limit = {
			has_estate = estate_fairy_pirates
		}
		add_estate_loyalty = {
			estate = estate_fairy_pirates
			loyalty = 5
		}
		th_pirate_add_raid_fame = yes
	}
}

# this = Released country, FROM = Releasing country
on_country_released = {
	if = {
		limit = {
			FROM = {
				OR = {
					has_reform = Gensokyan_fairy_government
					has_reform = Gensokyan_clownpiece_tribal_government
				}
			}
			NOT = { tag = PAP }
			NOT = { culture = Fairy }
			th_ds_is_not_divine_state_nation = yes
		}
		change_government = monarchy
	}
	if = {
		limit = {
			FROM = {
				OR = {
					has_reform = Gensokyan_fairy_government
					has_reform = Gensokyan_clownpiece_tribal_government
				}
			}
			NOT = { tag = PAP }
			culture = Fairy
			th_ds_is_not_divine_state_nation = yes
		}
		change_government = tribal
		add_government_reform = Gensokyan_fairy_government
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			th_ds_is_divine_state_nation = yes
		}
		change_government = monarchy
		add_government_reform = Gensokyan_divine_state
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			tag = PAP
		}
		change_government = theocracy
		change_religion = catholic
		add_government_reform = papacy_reform
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			FROM = { has_reform = religious_permanent_revolution_reform }
			NOT = { tag = PAP }
		}
		change_religion = FROM
		adopt_reform_progress = FROM
		add_country_modifier = {
			name = global_holy_war_released_modifier
			duration = 3650
			hidden = yes
		}
		capital_scope = {
			change_religion = FROM
		}
	}
	if = {
		limit = { NOT = { is_year = 1445 } }
		set_country_flag = released_in_1444
	}
	if = {
		limit = {
			tag = HIG
		}
		change_government = monarchy
		add_government_reform = Gensokyan_hig_yama_government
		adopt_reform_progress = FROM
		if = {
			limit = {
				NOT = { has_saved_event_target = YamaOfGensokyo }
			}
			save_global_event_target_as = YamaOfGensokyo
		}
	}
}

# province:  spawned whenever a new owner takes over the province
# FROM = The previous owner.
on_conquest = {
	remove_named_unrest = estate_land_seized
	clr_province_flag = has_estate_unrest_flag
	th_wandering_state_on_conquest_effect = yes
	if = {
		limit = {
			owner = {
				has_estate = estate_fairy_pirates
			}
			development = 10
			has_port = yes
		}
		owner = {
			th_pirate_add_conquer_fame = yes
		}
	}
}

on_country_creation = {
	if = {
		limit = {
			tag = PAP
			OR = {
				NOT = {
					religion = catholic
				}
				NOT = {
					has_reform = papacy_reform
				}
				NOT = {
					government = theocracy
				}
			}
		}
		change_religion = catholic
		change_government = theocracy
		add_government_reform = papacy_reform
	}
	if = {
		limit = {
			tag = HIG
			OR = {
				NOT = {
					has_reform = Gensokyan_hig_yama_government
				}
				NOT = {
					government = monarchy
				}
			}
		}
		change_government = monarchy
		add_government_reform = Gensokyan_hig_yama_government
		save_global_event_target_as = YamaOfGensokyo
	}
}

##scope = colony province, FROM = owner country or province if there's a minority expulsion source
on_colonist_boosting_colony = {
	hidden_effect = {
		if = {
			limit = {
				OR = {
					religion = noreligion
					#test if colonists outnumber natives
					variable_arithmetic_trigger = {
						custom_tooltip = colonysize_is_larger_than_nativesize_tt
						export_to_variable = {
							which = vab_colonysize
							value = trigger_value:colonysize
						}
						export_to_variable = {
							which = vab_nativesize
							value = trigger_value:native_size
						}
						multiply_variable = {
							which = vab_nativesize
							value = 100
						}
						check_variable = {
							which = vab_colonysize
							which = vab_nativesize
						}
					}
					is_in_capital_area = yes
					continent = north_america
					continent = south_america
					continent = new_world
					NOT = {
						OR = {
							has_dlc = "Dharma"
							has_dlc = "Wealth of Nations"
						}
					}
					FROM = { th_can_convert_on_colonization = yes }
				}
			}
			change_religion = FROM
		}
		if = {
			limit = {
				OR = {
					culture = noculture
					#test if colonists outnumber natives
					variable_arithmetic_trigger = {
						custom_tooltip = colonysize_is_larger_than_nativesize_tt
						export_to_variable = {
							which = vab_colonysize
							value = trigger_value:colonysize
						}
						export_to_variable = {
							which = vab_nativesize
							value = trigger_value:native_size
						}
						multiply_variable = {
							which = vab_nativesize
							value = 100
						}
						check_variable = {
							which = vab_colonysize
							which = vab_nativesize
						}
					}
					is_in_capital_area = yes
					continent = north_america
					continent = south_america
					continent = new_world
					NOT = {
						OR = {
							has_dlc = "Dharma"
							has_dlc = "Wealth of Nations"
						}
					}
				}
			}
			change_culture = FROM
			change_original_culture = FROM
		}
	}
}

on_institution_embracement = {
	if = {
		limit = {
			has_government_attribute = monarch_power_on_institutions
		}
		add_adm_power = 100
		add_dip_power = 100
		add_mil_power = 100
	}
	if = {
		limit = { has_government_attribute = th_innovativeness_from_embracing_institutions }
		change_innovativeness = 10
	}
}

on_new_age = {
}