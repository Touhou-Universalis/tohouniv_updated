###GENERAL STUFF WITH VARIABLES###

th_export_root_variable_into_foreign = {
	#This function counts your own variable, which is made for counting, down while increasing the counter variable of $who$
	#Useful if you need to convert variables from a province scope into a country's variable
	while = {
		limit = {
			check_variable = {
				which = $root_variable$
				value = 1
			}
		}
		$who$ = {
			change_variable = {
				which = $foreign_variable$
				value = 1
			}
		}
		subtract_variable = {
			which = $root_variable$
			value = 1
		}
	}
}

th_import_foreign_variable_into_root = {
	while = {
		limit = {
			$who$ = {
				check_variable = {
					which = $foreign_variable$
					value = 1
				}
			}
		}
		$who$ = {
			subtract_variable = {
				which = $foreign_variable$
				value = 1
			}
		}
		change_variable = {
			which = $root_variable$
			value = 1
		}
	}
}

###EIT variable###
th_eit_increment_aggresssor_counter = {
	if = {
		limit = {
			th_eit_has_max_aggressors = no
		}
		change_variable = {
			which = th_eit_aggressor_counter
			value = 1
		}
	}
}

th_eit_decrement_aggressor_counter = {
	if = {
		limit = {
			th_eit_has_at_least_one_aggressor = yes
		}
		subtract_variable = {
			which = th_eit_aggressor_counter
			value = 1
		}
	}
}

###EDUCATION INCREASE EVENT FREQUENCY###
th_increase_education_frequency = {
	custom_tooltip = th_increase_education_frequency_tt
	hidden_effect = {
		if = {
			limit = {
				NOT = { has_country_flag = th_education_setup }
			}
			set_country_flag = th_education_setup
			set_variable = {
				which = th_education_accelerator_variable
				value = 0
			}
		}
		change_variable = {
			which = th_education_accelerator_variable
			value = $value$
		}
	}
}

###MONARCH variable###
# Originally, only fairies were able to maintain their stats when respawning
# This changed, however, and now all Touhou rulers are able to respawn with increased stats
# Fairies are the only rulers, who are limited in how much their stats can grow though
th_set_ruler_max_stats = {
	set_variable = {
		which = th_ruler_max_adm_stat
		value = $max_possible_adm$
	}
	set_variable = {
		which = th_ruler_max_dip_stat
		value = $max_possible_dip$
	}
	set_variable = {
		which = th_ruler_max_mil_stat
		value = $max_possible_mil$
	}
}

th_increase_ruler_adm_stat = {
	if = {
		limit = {
			OR = {
				NOT = { has_government_attribute = fairy_respawn_mechanic }
				NOT = {
					check_variable = {
						which = th_ruler_adm_stat
						which = th_ruler_max_adm_stat
					}
				}
			}
		}
		change_adm = $adm$
		custom_tooltip = th_stat_remains_after_respawn_ruler_tt
		hidden_effect = {
			change_variable = {
				which = th_ruler_adm_stat
				value = $adm$
			}
			change_variable = {
				which = th_ruler_total_power
				value = $adm$
			}
		}
	}
	else = {
		custom_tooltip = th_increase_ruler_adm_stat_tt
		add_adm_power = 75
	}
}

th_increase_ruler_dip_stat = {
	if = {
		limit = {
			OR = {
				NOT = { has_government_attribute = fairy_respawn_mechanic }
				NOT = {
					check_variable = {
						which = th_ruler_dip_stat
						which = th_ruler_max_dip_stat
					}
				}
			}
		}
		change_dip = $dip$
		custom_tooltip = th_stat_remains_after_respawn_ruler_tt
		hidden_effect = {
			change_variable = {
				which = th_ruler_dip_stat
				value = $dip$
			}
			change_variable = {
				which = th_ruler_total_power
				value = $dip$
			}
		}
	}
	else = {
		custom_tooltip = th_increase_ruler_dip_stat_tt
		add_dip_power = 75
	}
}

th_increase_ruler_mil_stat = {
	if = {
		limit = {
			OR = {
				NOT = { has_government_attribute = fairy_respawn_mechanic }
				NOT = {
					check_variable = {
						which = th_ruler_mil_stat
						which = th_ruler_max_mil_stat
					}
				}
			}
		}
		change_mil = $mil$
		custom_tooltip = th_stat_remains_after_respawn_ruler_tt
		hidden_effect = {
			change_variable = {
				which = th_ruler_mil_stat
				value = $mil$
			}
			change_variable = {
				which = th_ruler_total_power
				value = $mil$
			}
		}
	}
	else = {
		custom_tooltip = th_increase_ruler_mil_stat_tt
		add_mil_power = 75
	}
}

th_set_heir_max_stats = {
	set_variable = {
		which = th_heir_max_adm_stat
		value = $max_possible_adm$
	}
	set_variable = {
		which = th_heir_max_dip_stat
		value = $max_possible_dip$
	}
	set_variable = {
		which = th_heir_max_mil_stat
		value = $max_possible_mil$
	}
}

th_increase_heir_adm_stat = {
	if = {
		limit = {
			OR = {
				NOT = { has_government_attribute = fairy_respawn_mechanic }
				NOT = {
					check_variable = {
						which = th_heir_adm_stat
						which = th_heir_max_adm_stat
					}
				}
			}
		}
		change_heir_adm = $adm$
		custom_tooltip = th_stat_remains_after_respawn_heir_tt
		hidden_effect = {
			change_variable = {
				which = th_heir_adm_stat
				value = $adm$
			}
			change_variable = {
				which = th_heir_total_power
				value = $adm$
			}
		}
	}
	else = {
		add_adm_power = 50
	}
}

th_increase_heir_dip_stat = {
	if = {
		limit = {
			OR = {
				NOT = { has_government_attribute = fairy_respawn_mechanic }
				NOT = {
					check_variable = {
						which = th_heir_dip_stat
						which = th_heir_max_dip_stat
					}
				}
			}
		}
		change_heir_dip = $dip$
		custom_tooltip = th_stat_remains_after_respawn_heir_tt
		hidden_effect = {
			change_variable = {
				which = th_heir_dip_stat
				value = $dip$
			}
			change_variable = {
				which = th_heir_total_power
				value = $dip$
			}
		}
	}
	else = {
		add_dip_power = 50
	}
}

th_increase_heir_mil_stat = {
	if = {
		limit = {
			OR = {
				NOT = { has_government_attribute = fairy_respawn_mechanic }
				NOT = {
					check_variable = {
						which = th_heir_mil_stat
						which = th_heir_max_mil_stat
					}
				}
			}
		}
		change_heir_mil = $mil$
		custom_tooltip = th_stat_remains_after_respawn_heir_tt
		hidden_effect = {
			change_variable = {
				which = th_heir_mil_stat
				value = $mil$
			}
			change_variable = {
				which = th_heir_total_power
				value = $mil$
			}
		}
	}
	else = {
		add_mil_power = 50
	}
}

#Use this scripted in the on_actions file, on_battle_won_country
th_count_won_battles_and_reward_at_end = {
	if = {
		limit = {
			ROOT = {
				has_country_flag = $counting_flag$
			}
		}
		ROOT = {
			change_variable = {
				which = $variable$
				value = 1
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				has_country_flag = $counting_flag$
				check_variable = {
					which = $variable$
					value = $max_value$
				}
			}
		}
		ROOT = {
			clr_country_flag = $counting_flag$
			country_event = {
				id = $country_event$
			}
		}
	}
}

###FAIRY PIRATE VARIABLES###
th_pirate_initialize_variables = {
	set_variable = {
		which = th_pirate_fame_points
		value = 0
	}
}

th_pirate_increase_fame_by_10 = {
	custom_tooltip = th_pirate_increase_fame_by_10_tt
	if = {
		limit = {
			has_country_flag = th_initiated_pirate_influence_variable
		}
		hidden_effect = {
			change_variable = {
				which = th_pirate_fame_points
				value = 10
			}
		}
	}
	else = {
		hidden_effect = {
			set_country_flag = th_initiated_pirate_influence_variable
			set_variable = {
				which = th_pirate_fame_points
				value = 10
			}
		}
	}
}

th_pirate_add_prank_fame = {
	if = {
		limit = {
			has_country_flag = th_initiated_pirate_influence_variable
			NOT = {
				check_variable = {
					which = th_pirate_fame_points
					value = 100
				}
			}
		}
		change_variable = {
			which = th_pirate_fame_points
			value = 0.5
		}
	}
}

th_pirate_add_raid_fame = {
	if = {
		limit = {
			has_country_flag = th_initiated_pirate_influence_variable
			NOT = {
				check_variable = {
					which = th_pirate_fame_points
					value = 100
				}
			}
		}
		change_variable = {
			which = th_pirate_fame_points
			value = 0.25
		}
	}
}

th_pirate_add_conquer_fame = {
	if = {
		limit = {
			has_country_flag = th_initiated_pirate_influence_variable
			NOT = {
				check_variable = {
					which = th_pirate_fame_points
					value = 100
				}
			}
		}
		change_variable = {
			which = th_pirate_fame_points
			value = 0.25
		}
	}
}

###SFF VARIABLES###

th_sff_initiate_flower_counter = {
	set_variable = {
		which = sff_flower_counter
		value = 0
	}
}

th_sff_initiate_sun_garden_counter = {
	set_variable = {
		which = sff_sun_garden_counter
		value = 1
	}
}

th_sff_increment_flower_counter = {
	change_variable = {
		which = sff_flower_counter
		value = 1
	}
}

th_sff_increment_sun_garden_counter = {
	custom_tooltip = th_sff_increment_sun_garden_counter_tt
	hidden_effect = {
		change_variable = {
			which = sff_sun_garden_counter
			value = 1
		}
	}
}

###ONI VARIABLES###
th_add_battle_passion = {
	if = {
		limit = {
			has_government_attribute = th_has_battle_passion
			has_country_flag = th_initialized_battle_passion
		}
		change_variable = {
			which = th_battle_passion
			value = $value$
		}
		hidden_effect = {
			if = {
				limit = {
					check_variable = {
						which = th_battle_passion
						value = 501
					}
				}
				set_variable = {
					which = th_battle_passion
					value = 500
				}
			}
		}
	}
}

th_reduce_battle_passion = {
	if = {
		limit = {
			has_government_attribute = th_has_battle_passion
			has_country_flag = th_initialized_battle_passion
		}
		subtract_variable = {
			which = th_battle_passion
			value = $value$
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = th_battle_passion
						value = 0
					}
				}
			}
			set_variable = {
				which = th_battle_passion
				value = 0
			}
		}
	}
}

th_add_monthly_battle_passion = {
	hidden_effect = {
		export_to_variable = {
			which = battle_passion_per_regiment_variable
			value = modifier:battle_passion_per_regiment
		}
		export_to_variable = {
			which = monthly_battle_passion_variable
			value = modifier:monthly_battle_passion
		}
		export_to_variable = {
			which = battle_passion_amount_of_troops
			value = trigger_value:army_size
		}
		multiply_variable = {
			which = monthly_battle_passion_variable
			value = 100
		}
		multiply_variable = {
			which = battle_passion_amount_of_troops
			which = battle_passion_per_regiment_variable
		}
		change_variable = {
			which = th_battle_passion
			which = monthly_battle_passion_variable
		}
		change_variable = {
			which = th_battle_passion
			which = battle_passion_amount_of_troops
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = th_battle_passion
						value = 0
					}
				}
			}
			set_variable = {
				which = th_battle_passion
				value = 0
			}
		}
		if = {
			limit = {
				check_variable = {
					which = th_battle_passion
					value = 500
				}
			}
			set_variable = {
				which = th_battle_passion
				value = 500
			}
		}
	}
}